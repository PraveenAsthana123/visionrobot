<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15 C4 Model Diagrams - AR/VR Documentation</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        #overlay {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 30px;
            border-radius: 15px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        #overlay h1 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        #overlay h2 {
            color: #764ba2;
            margin-top: 30px;
            font-size: 1.8em;
        }

        #overlay code {
            background: rgba(102, 126, 234, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            color: #a5b4fc;
        }

        #overlay pre {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 4px solid #667eea;
        }

        #overlay pre code {
            background: transparent;
        }

        #overlay table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        #overlay th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 12px;
            text-align: left;
        }

        #overlay td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 1001;
        }

        .control-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            max-width: 300px;
        }

        .info-panel h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-panel p {
            margin: 5px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div id="overlay" style="display: none;">
        <div id="content"></div>
    </div>

    <div class="info-panel">
        <h3>ğŸ¥½ VR Documentation</h3>
        <p><strong>15 C4 Model Diagrams</strong></p>
        <p>Use WASD to move</p>
        <p>Mouse to look around</p>
        <p>Click 'Toggle Doc' to read</p>
    </div>

    <div id="controls">
        <button class="control-btn" onclick="toggleOverlay()">ğŸ“„ Toggle Doc</button>
        <button class="control-btn" onclick="enterVR()">ğŸ¥½ Enter VR</button>
        <button class="control-btn" onclick="resetView()">ğŸ”„ Reset View</button>
    </div>

    <a-scene background="color: #000">
        <!-- Sky with gradient -->
        <a-sky color="#1a1a2e"></a-sky>

        <!-- Ambient lighting -->
        <a-light type="ambient" color="#667eea" intensity="0.5"></a-light>
        <a-light type="directional" color="#FFF" intensity="0.8" position="2 4 -3"></a-light>
        <a-light type="point" color="#764ba2" intensity="1" position="0 3 0"></a-light>

        <!-- Floor grid -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20"
                 color="#0f0f23" roughness="0.8" metalness="0.2"
                 shader="flat" repeat="10 10"></a-plane>

        <!-- Documentation panels floating in 3D space -->
        <a-entity id="doc-environment" position="0 1.6 -3">
            <!-- Main title panel -->
            <a-plane position="0 2 0" rotation="0 0 0" width="8" height="1.5"
                     color="#667eea" opacity="0.9">
                <a-text value="15 C4 Model Diagrams" align="center" color="#FFF"
                        position="0 0 0.01" width="8" font="roboto"></a-text>
            </a-plane>

            <!-- Floating data panels in circular arrangement -->
            <a-entity id="panel-1" position="-3 0 0">
                <a-box color="#667eea" opacity="0.7" width="1.5" height="2" depth="0.1"
                       roughness="0.3" metalness="0.6"
                       animation="property: rotation; to: 0 360 0; loop: true; dur: 20000">
                    <a-text value="PDF\nFormat" align="center" color="#FFF"
                            position="0 0.5 0.06" width="2"></a-text>
                    <a-text value="Complete\nDocumentation" align="center" color="#CCC"
                            position="0 -0.3 0.06" width="1.5"></a-text>
                </a-box>
            </a-entity>

            <a-entity id="panel-2" position="3 0 0">
                <a-box color="#764ba2" opacity="0.7" width="1.5" height="2" depth="0.1"
                       roughness="0.3" metalness="0.6"
                       animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; dir: reverse">
                    <a-text value="Interactive\n3D View" align="center" color="#FFF"
                            position="0 0.5 0.06" width="2"></a-text>
                    <a-text value="Immersive\nExperience" align="center" color="#CCC"
                            position="0 -0.3 0.06" width="1.5"></a-text>
                </a-box>
            </a-entity>

            <a-entity id="panel-3" position="0 0 -2">
                <a-cylinder color="#f093fb" opacity="0.7" radius="0.75" height="2"
                           roughness="0.3" metalness="0.6"
                           animation="property: position; to: 0 0.5 -2; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine">
                    <a-text value="VisionBot\nProject" align="center" color="#FFF"
                            position="0 0.5 0.76" width="2"></a-text>
                </a-cylinder>
            </a-entity>

            <!-- Floating stats spheres -->
            <a-sphere position="-1.5 1.5 -1" radius="0.3" color="#10b981" opacity="0.8"
                     animation="property: position; to: -1.5 2 -1; loop: true; dur: 2000; dir: alternate">
                <a-text value="99.2%\nSuccess" align="center" color="#FFF"
                        position="0 0 0.31" width="1.2"></a-text>
            </a-sphere>

            <a-sphere position="1.5 1.5 -1" radius="0.3" color="#f59e0b" opacity="0.8"
                     animation="property: position; to: 1.5 2 -1; loop: true; dur: 2500; dir: alternate">
                <a-text value="93.5%\nOEE" align="center" color="#FFF"
                        position="0 0 0.31" width="1.2"></a-text>
            </a-sphere>
        </a-entity>

        <!-- Camera with controls -->
        <a-entity id="camera-rig" position="0 0 0">
            <a-camera id="main-camera" wasd-controls look-controls>
                <a-cursor color="#667eea" fuse="true" fuse-timeout="1500"></a-cursor>
            </a-camera>
        </a-entity>

        <!-- Particle effect -->
        <a-entity position="0 2.5 -5">
            <a-entity geometry="primitive: sphere; radius: 0.05"
                     material="color: #667eea; emissive: #667eea; emissiveIntensity: 0.5"
                     animation="property: position; to: 0 4 -5; loop: true; dur: 4000; easing: linear"></a-entity>
        </a-entity>
    </a-scene>

    <script>
        // Convert markdown to HTML
        const markdown = `# C4 Model Diagrams
## Vision-Based Pick and Place Robotic System

**Document Version:** 1.0
**Last Updated:** 2025-10-18
**Status:** âœ… Complete

---

## Table of Contents

1. [Introduction](#1-introduction)
2. [C4 Model Overview](#2-c4-model-overview)
3. [Level 1: System Context Diagram](#3-level-1-system-context-diagram)
4. [Level 2: Container Diagram](#4-level-2-container-diagram)
5. [Level 3: Component Diagrams](#5-level-3-component-diagrams)
6. [Level 4: Code Diagrams](#6-level-4-code-diagrams)
7. [Cross-Cutting Concerns](#7-cross-cutting-concerns)
8. [Deployment View](#8-deployment-view)
9. [Dynamic Views](#9-dynamic-views)

---

## 1. Introduction

### 1.1 Purpose

This document presents the system architecture of the Vision-Based Pick and Place Robotic System using the **C4 model** (Context, Containers, Components, Code). The C4 model provides a hierarchical way to visualize software architecture at different levels of abstraction.

### 1.2 C4 Model Benefits

- **Hierarchical abstraction:** Zoom in/out from system context to code details
- **Audience-appropriate:** Different stakeholders focus on different levels
- **Communication:** Clear, unambiguous diagrams for technical and non-technical audiences
- **Documentation:** Living documentation that evolves with the system

### 1.3 Notation Legend

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Person/System     â”‚  â† External entity (users, external systems)
â”‚   [Type]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Container         â”‚  â† Application/data store
â”‚   [Technology]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Component         â”‚  â† Logical grouping of functionality
â”‚   [Details]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€>  Relationship (synchronous)
- - - >  Relationship (asynchronous)
\`\`\`

---

## 2. C4 Model Overview

### 2.1 The Four C's

| **Level** | **Name** | **Audience** | **Abstraction** | **Purpose** |
|-----------|----------|--------------|-----------------|-------------|
| **C1** | **Context** | All stakeholders | Highest | System scope and external dependencies |
| **C2** | **Container** | Technical leaders, architects | High | Runtime applications and data stores |
| **C3** | **Component** | Developers, architects | Medium | Logical components within containers |
| **C4** | **Code** | Developers | Lowest | Classes, interfaces, data structures |

### 2.2 Our C4 Documentation Structure

\`\`\`
C1: System Context
    â””â”€> Robot System interacts with Operator, Manager, Engineer, MES, ERP

C2: Containers
    â”œâ”€> Vision Pipeline (Docker container)
    â”œâ”€> Motion Planning (Docker container)
    â”œâ”€> Control System (Docker container)
    â”œâ”€> Orchestrator (Docker container)
    â”œâ”€> Web Backend (FastAPI container)
    â”œâ”€> Web Frontend (React container)
    â”œâ”€> Database (PostgreSQL container)
    â”œâ”€> Monitoring (Grafana/Prometheus containers)
    â””â”€> Message Bus (ROS2 DDS)

C3: Components (per container)
    â”œâ”€> Vision Pipeline: Camera Driver, Object Detector, Pose Estimator
    â”œâ”€> Motion Planning: MoveIt2 Planner, Collision Checker, Trajectory Generator
    â”œâ”€> Control: ros2_control Manager, Joint Controllers, Gripper Controller
    â””â”€> Orchestrator: Task Manager, Behavior Tree, State Machine

C4: Code (selected critical components)
    â”œâ”€> YoloDetector class
    â”œâ”€> GraspSynthesizer class
    â””â”€> PickPlaceServer class
\`\`\`

---

## 3. Level 1: System Context Diagram

### 3.1 Context Diagram

\`\`\`
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚   Operator       â”‚
                                â”‚   [Person]       â”‚
                                â”‚ Runs system,     â”‚
                                â”‚ monitors status  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚ Uses web UI
                                         â”‚ monitors
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Manager    â”‚              â”‚                              â”‚
â”‚   [Person]   â”‚â”€â”€Reviews â”€â”€â–¶ â”‚   Vision Pick & Place       â”‚
â”‚ Views KPIs,  â”‚   metrics    â”‚   Robot System              â”‚
â”‚ ROI          â”‚              â”‚   [Software System]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                              â”‚
                              â”‚  Automated pick-and-place    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  using AI vision             â”‚
â”‚   Engineer   â”‚â”€â”€Developsâ”€â”€â–¶ â”‚  30 picks/min, 99% accuracy â”‚
â”‚   [Person]   â”‚   & debugs   â”‚                              â”‚
â”‚ Maintains,   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ optimizes    â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚ Controls
                                      â”‚ reads sensors
                                      â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   UR5e Robot     â”‚
                              â”‚   [Hardware]     â”‚
                              â”‚  6-DOF arm,      â”‚
                              â”‚  gripper, camera â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â–²
â”‚   MES        â”‚                      â”‚
â”‚   [External  â”‚ â—€â”€â”€â”€â”€Sends statusâ”€â”€â”€â”€â”¤
â”‚   System]    â”‚      pick data       â”‚
â”‚ Manufacturingâ”‚                      â”‚
â”‚ Execution    â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   ERP        â”‚                      â”‚
â”‚   [External  â”‚ â—€â”€â”€â”€â”€Sends metricsâ”€â”€â”€â”¤
â”‚   System]    â”‚      inventory       â”‚
â”‚ Enterprise   â”‚                      â”‚
â”‚ Resource     â”‚                      â”‚
â”‚ Planning     â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   Safety PLC â”‚ â—€â”€â”€â”€â”€E-stop signalâ”€â”€â”€â”˜
â”‚   [External  â”‚      safety status
â”‚   System]    â”‚
â”‚ Emergency    â”‚
â”‚ stop         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 3.2 Context Description

#### 3.2.1 People

| **Person** | **Role** | **Interaction** |
|------------|----------|-----------------|
| **Operator** | Runs daily operations | Uses web UI to start/stop system, monitor status, handle errors |
| **Manager** | Oversees performance | Reviews KPIs, ROI metrics via dashboard |
| **Engineer** | Develops & maintains | Deploys code, debugs issues, optimizes performance via ROS2 tools |
| **Maintenance Technician** | Repairs & services | Diagnoses faults, performs preventive maintenance |
| **Data Scientist** | Trains AI models | Collects training data, updates object detection models |

#### 3.2.2 External Systems

| **System** | **Purpose** | **Integration** |
|------------|-------------|-----------------|
| **MES (Manufacturing Execution System)** | Work orders, production tracking | REST API (bidirectional) |
| **ERP (Enterprise Resource Planning)** | Inventory, analytics | REST API (robot â†’ ERP) |
| **Safety PLC** | Emergency stop, safety zones | Digital I/O, Modbus TCP |
| **Robot Hardware (UR5e)** | Physical manipulation | EtherCAT, URScript |
| **Camera (RealSense D435i)** | Vision sensing | USB 3.0, librealsense2 SDK |
| **Gripper (Robotiq 2F-85)** | Grasping | Modbus RTU over RS-485 |

---

## 4. Level 2: Container Diagram

### 4.1 Container Diagram

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Robot System                                     â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  Vision Pipeline â”‚         â”‚ Motion Planning  â”‚                    â”‚
â”‚  â”‚  [Docker/GPU]    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  [Docker/CPU]    â”‚                    â”‚
â”‚  â”‚                  â”‚ Object  â”‚                  â”‚                    â”‚
â”‚  â”‚ - Camera Driver  â”‚ poses   â”‚ - MoveIt2        â”‚                    â”‚
â”‚  â”‚ - YOLOv8         â”‚         â”‚ - OMPL Planner   â”‚                    â”‚
â”‚  â”‚ - Pose Estimator â”‚         â”‚ - Collision Checkâ”‚                    â”‚
â”‚  â”‚ - TensorRT       â”‚         â”‚                  â”‚                    â”‚
â”‚  â”‚                  â”‚         â”‚  ROS2 C++/Python â”‚                    â”‚
â”‚  â”‚  Python/C++      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                              â”‚
â”‚           â”‚                            â”‚ Trajectory                   â”‚
â”‚           â”‚ ROS2 topics                â”‚                              â”‚
â”‚           â”‚                            â–¼                              â”‚
â”‚           â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚           â”‚                  â”‚  Control System  â”‚                     â”‚
â”‚           â”‚                  â”‚  [RT Docker]     â”‚                     â”‚
â”‚           â”‚                  â”‚                  â”‚                     â”‚
â”‚           â”‚                  â”‚ - ros2_control   â”‚                     â”‚
â”‚           â”‚                  â”‚ - Joint Ctrl     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚           â”‚                  â”‚ - HW Interface   â”‚           â”‚         â”‚
â”‚           â”‚                  â”‚                  â”‚           â”‚         â”‚
â”‚           â”‚                  â”‚  C++/RT-Linux    â”‚           â”‚         â”‚
â”‚           â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚         â”‚
â”‚           â”‚                           â”‚                     â”‚         â”‚
â”‚           â”‚                           â”‚ EtherCAT            â”‚         â”‚
â”‚           â”‚                           â”‚                     â”‚         â”‚
â”‚           â–¼                           â–¼                     â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚         â”‚
â”‚  â”‚  Task            â”‚       â”‚  Gripper Control â”‚           â”‚         â”‚
â”‚  â”‚  Orchestrator    â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  [Docker]        â”‚           â”‚         â”‚
â”‚  â”‚  [Docker]        â”‚ Grasp â”‚                  â”‚           â”‚         â”‚
â”‚  â”‚                  â”‚ cmd   â”‚ - Robotiq Driver â”‚           â”‚         â”‚
â”‚  â”‚ - Behavior Tree  â”‚       â”‚ - Force Control  â”‚           â”‚         â”‚
â”‚  â”‚ - State Machine  â”‚       â”‚                  â”‚           â”‚         â”‚
â”‚  â”‚ - Task Manager   â”‚       â”‚  Python          â”‚           â”‚         â”‚
â”‚  â”‚                  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚         â”‚
â”‚  â”‚  C++/Python      â”‚                â”‚                     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚ Modbus RTU          â”‚         â”‚
â”‚           â”‚                          â”‚                     â”‚         â”‚
â”‚           â”‚ ROS2 actions             â–¼                     â”‚         â”‚
â”‚           â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                  â”‚                                       â”‚
â”‚           â”‚                  â”‚                                       â”‚
â”‚  â”€ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€             â”‚
â”‚           â”‚  ROS2 DDS        â”‚  (CycloneDDS message bus)             â”‚
â”‚  â”€ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€             â”‚
â”‚           â”‚                  â”‚                                       â”‚
â”‚           â”‚                  â”‚                                       â”‚
â”‚           â–¼                  â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                                       â”‚
â”‚  â”‚  Web Backend     â”‚        â”‚                                       â”‚
â”‚  â”‚  [Docker]        â”‚        â”‚                                       â”‚
â”‚  â”‚                  â”‚        â”‚                                       â”‚
â”‚  â”‚ - FastAPI        â”‚        â”‚                                       â”‚
â”‚  â”‚ - REST/gRPC API  â”‚        â”‚                                       â”‚
â”‚  â”‚ - SQLAlchemy     â”‚        â”‚                                       â”‚
â”‚  â”‚                  â”‚        â”‚                                       â”‚
â”‚  â”‚  Python 3.11     â”‚        â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                                       â”‚
â”‚           â”‚ HTTPS/WS         â”‚                                       â”‚
â”‚           â–¼                  â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                                       â”‚
â”‚  â”‚  Web Frontend    â”‚        â”‚                                       â”‚
â”‚  â”‚  [Docker/Nginx]  â”‚        â”‚                                       â”‚
â”‚  â”‚                  â”‚        â”‚                                       â”‚
â”‚  â”‚ - React 18       â”‚        â”‚                                       â”‚
â”‚  â”‚ - Next.js        â”‚        â”‚                                       â”‚
â”‚  â”‚ - Chart.js       â”‚        â”‚                                       â”‚
â”‚  â”‚                  â”‚        â”‚                                       â”‚
â”‚  â”‚  TypeScript/JS   â”‚        â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                                       â”‚
â”‚           â–²                  â”‚                                       â”‚
â”‚           â”‚ HTTPS            â”‚                                       â”‚
â”‚           â”‚                  â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                  â”‚
            â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Operator      â”‚    â”‚  PostgreSQL   â”‚
   â”‚   [Browser]     â”‚    â”‚  [Container]  â”‚
   â”‚                 â”‚    â”‚               â”‚
   â”‚ Chrome/Firefox  â”‚    â”‚ Operational   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ data (picks,  â”‚
                          â”‚ configs)      â”‚
                          â”‚               â”‚
                          â”‚ v15.3         â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚  Grafana         â”‚
   â”‚  [Container]     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                  â”‚   â”‚  InfluxDB     â”‚
   â”‚ - Dashboards     â”‚â—€â”€â”€â”‚  [Container]  â”‚
   â”‚ - Alerts         â”‚   â”‚               â”‚
   â”‚                  â”‚   â”‚ Time-series   â”‚
   â”‚ v10.0            â”‚   â”‚ metrics       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚
            â–²              â”‚ v2.7          â”‚
            â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                      â–²
            â”‚                      â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
   â”‚  Prometheus     â”‚    â”‚  Metrics      â”‚
   â”‚  [Container]    â”‚â—€â”€â”€â”€â”‚  Collector    â”‚
   â”‚                 â”‚    â”‚  [Container]  â”‚
   â”‚ Scrapes metrics â”‚    â”‚               â”‚
   â”‚ from all nodes  â”‚    â”‚ Publishes to  â”‚
   â”‚                 â”‚    â”‚ Influx/Prom   â”‚
   â”‚ v2.45           â”‚    â”‚               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Python        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 4.2 Container Descriptions

#### 4.2.1 Vision Pipeline Container

| **Attribute** | **Details** |
|---------------|-------------|
| **Technology** | Python 3.10, C++17, ROS2 Humble, PyTorch 2.0, TensorRT 8.5 |
| **Runtime** | Docker with NVIDIA GPU support |
| **Responsibilities** | - Capture RGB-D images<br>- Detect objects (YOLOv8)<br>- Estimate 6DoF poses (PCA/PVNet)<br>- Publish object poses via ROS2 |
| **Data In** | Raw camera frames (USB 3.0) |
| **Data Out** | \`/vision/object_poses\` (ROS2 topic) |
| **Dependencies** | RealSense D435i camera, CUDA runtime |
| **Scaling** | Single instance (stateless, can scale horizontally with multiple cameras) |

#### 4.2.2 Motion Planning Container

| **Attribute** | **Details** |
|---------------|-------------|
| **Technology** | C++17, ROS2 Humble, MoveIt2 2.5, OMPL 1.6 |
| **Runtime** | Docker (CPU-only) |
| **Responsibilities** | - Plan collision-free trajectories<br>- Inverse kinematics<br>- Cartesian path planning<br>- Collision checking |
| **Data In** | Target poses (grasp/place) via ROS2 actions |
| **Data Out** | Joint trajectories |
| **Dependencies** | Robot URDF, collision meshes |
| **Scaling** | Single instance (stateful due to planning scene) |

#### 4.2.3 Control System Container

| **Attribute** | **Details** |
|---------------|-------------|
| **Technology** | C++17, ROS2 Humble, ros2_control 2.27, RT-Linux kernel (PREEMPT_RT) |
| **Runtime** | Docker with real-time capabilities (--cap-add=SYS_NICE, --ulimit rtprio=99) |
| **Responsibilities** | - 1kHz control loop<br>- Execute joint trajectories<br>- Low-level robot communication (EtherCAT)<br>- Safety monitoring |
| **Data In** | Joint trajectories from motion planner |
| **Data Out** | Joint states (positions, velocities, efforts) |
| **Dependencies** | UR5e robot (EtherCAT interface) |
| **Scaling** | Single instance per robot (not scalable) |

#### 4.2.4 Task Orchestrator Container

| **Attribute** | **Details** |
|---------------|-------------|
| **Technology** | C++/Python, ROS2 Humble, BehaviorTree.CPP 4.0 |
| **Runtime** | Docker |
| **Responsibilities** | - High-level task sequencing<br>- State machine management<br>- Error recovery logic<br>- Workflow coordination |
| **Data In** | System triggers, sensor data |
| **Data Out** | ROS2 actions to subsystems (vision, motion, gripper) |
| **Dependencies** | All subsystem ROS2 action servers |
| **Scaling** | Single instance (stateful orchestration) |

#### 4.2.5 Web Backend Container

| **Attribute** | **Details** |
|---------------|-------------|
| **Technology** | Python 3.11, FastAPI 0.104, SQLAlchemy 2.0, gRPC |
| **Runtime** | Docker with Gunicorn (4 workers) |
| **Responsibilities** | - REST/gRPC API for UI<br>- Database CRUD operations<br>- Authentication (OAuth2/JWT)<br>- ROS2 bridge (rclpy client) |
| **Data In** | HTTP requests from frontend |
| **Data Out** | JSON responses, ROS2 messages |
| **Dependencies** | PostgreSQL, ROS2 nodes |
| **Scaling** | Horizontal (stateless, load balanced) |

#### 4.2.6 Web Frontend Container

| **Attribute** | **Details** |
|---------------|-------------|
| **Technology** | TypeScript, React 18, Next.js 14, Chart.js, WebSockets |
| **Runtime** | Docker with Nginx (static file serving) |
| **Responsibilities** | - User interface<br>- Real-time dashboard<br>- System configuration forms<br>- Live video feed |
| **Data In** | REST API responses, WebSocket streams |
| **Data Out** | HTTP requests to backend |
| **Dependencies** | Web Backend API |
| **Scaling** | Horizontal (CDN-ready static files) |

#### 4.2.7 PostgreSQL Container

| **Attribute** | **Details** |
|---------------|-------------|
| **Technology** | PostgreSQL 15.3 |
| **Runtime** | Docker with persistent volume |
| **Responsibilities** | - Store operational data (picks, configs, calibrations)<br>- Transactional guarantees<br>- Query analytics |
| **Data In** | SQL queries from Web Backend |
| **Data Out** | Query results |
| **Dependencies** | None (standalone) |
| **Scaling** | Vertical (read replicas for scaling reads) |

#### 4.2.8 InfluxDB Container

| **Attribute** | **Details** |
|---------------|-------------|
| **Technology** | InfluxDB 2.7 (time-series database) |
| **Runtime** | Docker with persistent volume |
| **Responsibilities** | - Store time-series metrics (cycle time, latency, joint states)<br>- High-write throughput<br>- Retention policies |
| **Data In** | Metrics from Metrics Collector |
| **Data Out** | Query results for Grafana |
| **Dependencies** | None |
| **Scaling** | Horizontal (InfluxDB Enterprise clustering) |

---

## 5. Level 3: Component Diagrams

### 5.1 Vision Pipeline Components

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Vision Pipeline Container                      â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚  Camera Driver     â”‚  /camera/color/image_raw            â”‚
â”‚  â”‚  [ROS2 Node]       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚                    â”‚         â”‚                          â”‚
â”‚  â”‚ - realsense_node   â”‚         â”‚ sensor_msgs/Image        â”‚
â”‚  â”‚ - USB streaming    â”‚         â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                          â”‚
â”‚                                 â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Image Processor   â”‚â—€â”€â”‚  Image Buffer    â”‚              â”‚
â”‚  â”‚  [ROS2 Node]       â”‚  â”‚  [Shared Memory] â”‚              â”‚
â”‚  â”‚                    â”‚  â”‚                  â”‚              â”‚
â”‚  â”‚ - Denoise (OpenCV) â”‚  â”‚ Ring buffer (10) â”‚              â”‚
â”‚  â”‚ - Color correction â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚          â”‚ /vision/preprocessed/image                       â”‚
â”‚          â”‚                                                  â”‚
â”‚          â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚  Object Detector   â”‚  /vision/detections                â”‚
â”‚  â”‚  [ROS2 Node]       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚                    â”‚         â”‚                          â”‚
â”‚  â”‚ - YOLOv8 inference â”‚         â”‚ vision_msgs/Detection2D  â”‚
â”‚  â”‚ - TensorRT engine  â”‚         â”‚                          â”‚
â”‚  â”‚ - GPU acceleration â”‚         â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                          â”‚
â”‚                                 â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Pose Estimator    â”‚â—€â”€â”‚ Detection Sync   â”‚              â”‚
â”‚  â”‚  [ROS2 Node]       â”‚  â”‚ [ApproxTimeSynch]â”‚              â”‚
â”‚  â”‚                    â”‚  â”‚                  â”‚              â”‚
â”‚  â”‚ - PCA-based pose   â”‚  â”‚ Sync depth +     â”‚              â”‚
â”‚  â”‚ - Point cloud proc â”‚  â”‚ detections       â”‚              â”‚
â”‚  â”‚ - TF2 broadcaster  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚          â”‚ /vision/object_poses                             â”‚
â”‚          â”‚ /tf (object frames)                              â”‚
â”‚          â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚  Visualization     â”‚  /vision/debug/detections           â”‚
â”‚  â”‚  [ROS2 Node]       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                          â”‚
â”‚  â”‚                    â”‚                                     â”‚
â”‚  â”‚ - Draw bboxes      â”‚  For debugging in RViz2            â”‚
â”‚  â”‚ - Overlay poses    â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 5.2 Motion Planning Components

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Motion Planning Container                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚  Pick Place Server â”‚  /pick_place (action server)        â”‚
â”‚  â”‚  [ROS2 Action]     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚                    â”‚                      â”‚             â”‚
â”‚  â”‚ - Sequence pick/   â”‚                      â”‚             â”‚
â”‚  â”‚   place motions    â”‚                      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚          â”‚                                   â”‚             â”‚
â”‚          â”‚ Calls                             â”‚             â”‚
â”‚          â–¼                                   â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚             â”‚
â”‚  â”‚  MoveGroup         â”‚                      â”‚             â”‚
â”‚  â”‚  Interface         â”‚                      â”‚             â”‚
â”‚  â”‚  [MoveIt2 API]     â”‚                      â”‚             â”‚
â”‚  â”‚                    â”‚                      â”‚             â”‚
â”‚  â”‚ - setPoseTarget()  â”‚                      â”‚             â”‚
â”‚  â”‚ - plan()           â”‚                      â”‚             â”‚
â”‚  â”‚ - execute()        â”‚                      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚          â”‚                                   â”‚             â”‚
â”‚          â”‚ Uses                              â”‚             â”‚
â”‚          â–¼                                   â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  OMPL Planner      â”‚  â”‚  IK Solver       â”‚             â”‚
â”‚  â”‚  [Plugin]          â”‚  â”‚  [KDL Plugin]    â”‚             â”‚
â”‚  â”‚                    â”‚  â”‚                  â”‚             â”‚
â”‚  â”‚ - RRTConnect       â”‚  â”‚ - Analytical IK  â”‚             â”‚
â”‚  â”‚ - RRT*             â”‚  â”‚ - Numerical IK   â”‚             â”‚
â”‚  â”‚ - PRM              â”‚  â”‚ - Multiple sols  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚          â”‚                        â”‚                       â”‚
â”‚          â”‚ Queries                â”‚                       â”‚
â”‚          â–¼                        â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                       â”‚
â”‚  â”‚  Planning Scene    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚  â”‚  [Shared State]    â”‚                                   â”‚
â”‚  â”‚                    â”‚                                   â”‚
â”‚  â”‚ - Robot state      â”‚                                   â”‚
â”‚  â”‚ - Collision objectsâ”‚                                   â”‚
â”‚  â”‚ - Allowed collis.  â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚          â”‚                                                â”‚
â”‚          â”‚ Checks                                         â”‚
â”‚          â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  Collision Checker â”‚                                   â”‚
â”‚  â”‚  [FCL Library]     â”‚                                   â”‚
â”‚  â”‚                    â”‚                                   â”‚
â”‚  â”‚ - Self collision   â”‚                                   â”‚
â”‚  â”‚ - Env collision    â”‚                                   â”‚
â”‚  â”‚ - Continuous check â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  Trajectory        â”‚  Publishes smoothed trajectory    â”‚
â”‚  â”‚  Processor         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶        â”‚
â”‚  â”‚  [Time-optimal]    â”‚                                   â”‚
â”‚  â”‚                    â”‚  /joint_trajectory (topic)        â”‚
â”‚  â”‚ - Velocity limits  â”‚                                   â”‚
â”‚  â”‚ - Accel limits     â”‚                                   â”‚
â”‚  â”‚ - Jerk limits      â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 5.3 Control System Components

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Control System Container                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚  Controller        â”‚  Main control loop (1 kHz)          â”‚
â”‚  â”‚  Manager           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  [ros2_control]    â”‚                      â”‚             â”‚
â”‚  â”‚                    â”‚                      â”‚             â”‚
â”‚  â”‚ - Load controllers â”‚                      â”‚             â”‚
â”‚  â”‚ - Update loop      â”‚                      â”‚             â”‚
â”‚  â”‚ - State publishing â”‚                      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚          â”‚                                   â”‚             â”‚
â”‚          â”‚ Updates (1 kHz)                   â”‚             â”‚
â”‚          â–¼                                   â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚             â”‚
â”‚  â”‚  Joint Trajectory  â”‚                      â”‚             â”‚
â”‚  â”‚  Controller        â”‚                      â”‚             â”‚
â”‚  â”‚  [Plugin]          â”‚                      â”‚             â”‚
â”‚  â”‚                    â”‚                      â”‚             â”‚
â”‚  â”‚ - Interpolate traj â”‚                      â”‚             â”‚
â”‚  â”‚ - PID control      â”‚                      â”‚             â”‚
â”‚  â”‚ - Feedforward      â”‚                      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚          â”‚                                   â”‚             â”‚
â”‚          â”‚ Commands                          â”‚             â”‚
â”‚          â–¼                                   â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚             â”‚
â”‚  â”‚  Hardware          â”‚                      â”‚             â”‚
â”‚  â”‚  Interface         â”‚                      â”‚             â”‚
â”‚  â”‚  [Custom Plugin]   â”‚                      â”‚             â”‚
â”‚  â”‚                    â”‚                      â”‚             â”‚
â”‚  â”‚ - read()  (state)  â”‚                      â”‚             â”‚
â”‚  â”‚ - write() (cmd)    â”‚                      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚          â”‚                                   â”‚             â”‚
â”‚          â”‚ EtherCAT                          â”‚             â”‚
â”‚          â–¼                                   â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚             â”‚
â”‚  â”‚  UR Driver         â”‚                      â”‚             â”‚
â”‚  â”‚  [Library]         â”‚                      â”‚             â”‚
â”‚  â”‚                    â”‚                      â”‚             â”‚
â”‚  â”‚ - TCP/IP socket    â”‚                      â”‚             â”‚
â”‚  â”‚ - URScript         â”‚                      â”‚             â”‚
â”‚  â”‚ - Real-time client â”‚                      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚                                              â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚             â”‚
â”‚  â”‚  Joint State       â”‚  Publishes current joint states    â”‚
â”‚  â”‚  Broadcaster       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶         â”‚
â”‚  â”‚  [ros2_control]    â”‚                                    â”‚
â”‚  â”‚                    â”‚  /joint_states (topic, 100 Hz)     â”‚
â”‚  â”‚ - Position         â”‚                                    â”‚
â”‚  â”‚ - Velocity         â”‚                                    â”‚
â”‚  â”‚ - Effort           â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚  Safety Monitor    â”‚  Monitors limits, publishes alerts â”‚
â”‚  â”‚  [ROS2 Node]       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶         â”‚
â”‚  â”‚                    â”‚                                    â”‚
â”‚  â”‚ - Joint limits     â”‚  /safety/alerts (topic)            â”‚
â”‚  â”‚ - Velocity limits  â”‚                                    â”‚
â”‚  â”‚ - Force limits     â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 5.4 Task Orchestrator Components

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Task Orchestrator Container                      â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚  Task Manager      â”‚  Main entry point                   â”‚
â”‚  â”‚  [ROS2 Node]       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚                    â”‚                      â”‚             â”‚
â”‚  â”‚ - Start/stop tasks â”‚                      â”‚             â”‚
â”‚  â”‚ - Error recovery   â”‚                      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚          â”‚                                   â”‚             â”‚
â”‚          â”‚ Executes                          â”‚             â”‚
â”‚          â–¼                                   â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚             â”‚
â”‚  â”‚  Behavior Tree     â”‚                      â”‚             â”‚
â”‚  â”‚  Engine            â”‚                      â”‚             â”‚
â”‚  â”‚  [BT.CPP]          â”‚                      â”‚             â”‚
â”‚  â”‚                    â”‚                      â”‚             â”‚
â”‚  â”‚ - Load XML tree    â”‚                      â”‚             â”‚
â”‚  â”‚ - Tick nodes       â”‚                      â”‚             â”‚
â”‚  â”‚ - Blackboard       â”‚                      â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚             â”‚
â”‚          â”‚                                   â”‚             â”‚
â”‚          â”‚ Ticks                             â”‚             â”‚
â”‚          â–¼                                   â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Action Nodes      â”‚  â”‚  Condition Nodes â”‚             â”‚
â”‚  â”‚  [Plugins]         â”‚  â”‚  [Plugins]       â”‚             â”‚
â”‚  â”‚                    â”‚  â”‚                  â”‚             â”‚
â”‚  â”‚ - CaptureImage     â”‚  â”‚ - ObjectDetected â”‚             â”‚
â”‚  â”‚ - DetectObjects    â”‚  â”‚ - GraspValid     â”‚             â”‚
â”‚  â”‚ - PlanGrasp        â”‚  â”‚ - WaitForTrigger â”‚             â”‚
â”‚  â”‚ - ExecutePick      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚  â”‚ - ExecutePlace     â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚          â”‚                                                â”‚
â”‚          â”‚ Calls ROS2 services/actions                   â”‚
â”‚          â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  Service Clients   â”‚                                   â”‚
â”‚  â”‚  [ROS2 Clients]    â”‚                                   â”‚
â”‚  â”‚                    â”‚                                   â”‚
â”‚  â”‚ - /vision/detect   â”‚                                   â”‚
â”‚  â”‚ - /grasp/compute   â”‚                                   â”‚
â”‚  â”‚ - /pick_place      â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  Blackboard        â”‚  Shared state between BT nodes    â”‚
â”‚  â”‚  [Memory Store]    â”‚                                   â”‚
â”‚  â”‚                    â”‚                                   â”‚
â”‚  â”‚ - detections       â”‚                                   â”‚
â”‚  â”‚ - target_object    â”‚                                   â”‚
â”‚  â”‚ - grasp_pose       â”‚                                   â”‚
â”‚  â”‚ - error_count      â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  State Publisher   â”‚  Publishes orchestrator state     â”‚
â”‚  â”‚  [ROS2 Publisher]  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶        â”‚
â”‚  â”‚                    â”‚                                   â”‚
â”‚  â”‚  /task/status      â”‚  TaskStatus msg (10 Hz)           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

## 6. Level 4: Code Diagrams

### 6.1 YoloDetector Class Diagram

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    YoloDetector                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - model: torch.nn.Module                                 â”‚
â”‚ - device: torch.device                                   â”‚
â”‚ - bridge: CvBridge                                       â”‚
â”‚ - confidence_threshold: float                            â”‚
â”‚ - iou_threshold: float                                   â”‚
â”‚ - image_sub: Subscriber<Image>                           â”‚
â”‚ - detections_pub: Publisher<Detection2DArray>            â”‚
â”‚ - debug_image_pub: Publisher<Image>                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + __init__()                                             â”‚
â”‚ + load_model() -> None                                   â”‚
â”‚ + image_callback(msg: Image) -> None                     â”‚
â”‚ + run_inference(image: np.ndarray) -> List[Detection]    â”‚
â”‚ + parse_detections(results) -> Detection2DArray          â”‚
â”‚ + draw_detections(image, detections) -> np.ndarray       â”‚
â”‚ - preprocess_image(image: np.ndarray) -> torch.Tensor    â”‚
â”‚ - postprocess_results(outputs) -> List[BBox]             â”‚
â”‚ - apply_nms(boxes, scores) -> List[int]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ uses
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TensorRTEngine                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - engine: trt.ICudaEngine                                â”‚
â”‚ - context: trt.IExecutionContext                         â”‚
â”‚ - input_shape: Tuple[int, int, int]                      â”‚
â”‚ - bindings: List[int]                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + __init__(engine_path: str)                             â”‚
â”‚ + infer(input_tensor: torch.Tensor) -> torch.Tensor      â”‚
â”‚ - allocate_buffers() -> None                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 6.2 GraspSynthesizer Class Diagram

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 GraspSynthesizer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - service: Service<ComputeGrasps>                        â”‚
â”‚ - num_candidates: int                                    â”‚
â”‚ - gripper_max_width: float                               â”‚
â”‚ - friction_coeff: float                                  â”‚
â”‚ - quality_evaluator: GraspQualityEvaluator               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + __init__()                                             â”‚
â”‚ + compute_grasps_callback(req, res) -> Response          â”‚
â”‚ + generate_box_grasps(req) -> List[Grasp]                â”‚
â”‚ + generate_cylinder_grasps(req) -> List[Grasp]           â”‚
â”‚ + generate_generic_grasps(req) -> List[Grasp]            â”‚
â”‚ - compute_grasp_pose(obj_pose, approach, rot) -> Pose    â”‚
â”‚ - check_force_closure(grasp) -> bool                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ uses
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             GraspQualityEvaluator                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - metric_type: str  # "ferrari_canny" | "volume"         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + evaluate(grasp: Grasp, object: Object) -> float        â”‚
â”‚ - compute_ferrari_canny(contact_pts) -> float            â”‚
â”‚ - compute_grasp_wrench_space(contacts) -> np.ndarray     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 6.3 PickPlaceServer Class Diagram

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PickPlaceServer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - action_server: ActionServer<PickPlace>                 â”‚
â”‚ - move_group: MoveGroupInterface                         â”‚
â”‚ - gripper_client: ActionClient<GripperCommand>           â”‚
â”‚ - planning_scene: PlanningScene                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + __init__(node_options)                                 â”‚
â”‚ + handle_goal(uuid, goal) -> GoalResponse                â”‚
â”‚ + handle_cancel(goal_handle) -> CancelResponse           â”‚
â”‚ + handle_accepted(goal_handle) -> None                   â”‚
â”‚ - execute(goal_handle) -> None                           â”‚
â”‚ - plan_pick(target, approach_dist) -> Plan               â”‚
â”‚ - plan_place(target) -> Plan                             â”‚
â”‚ - execute_trajectory(plan) -> bool                       â”‚
â”‚ - close_gripper(width, force) -> bool                    â”‚
â”‚ - open_gripper() -> bool                                 â”‚
â”‚ - retreat(distance) -> bool                              â”‚
â”‚ - publish_feedback(handle, status, progress) -> None     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ uses
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           MoveGroupInterface (MoveIt2)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - robot_model: RobotModel                                â”‚
â”‚ - planning_scene_monitor: PlanningSceneMonitor           â”‚
â”‚ - trajectory_execution_manager: TrajectoryExecutionMgr   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + setPoseTarget(pose: Pose) -> None                      â”‚
â”‚ + setJointValueTarget(joints: List[float]) -> None       â”‚
â”‚ + plan(plan: Plan&) -> MoveItErrorCode                   â”‚
â”‚ + execute(plan: Plan) -> MoveItErrorCode                 â”‚
â”‚ + computeCartesianPath(waypoints) -> double              â”‚
â”‚ + getCurrentPose() -> PoseStamped                        â”‚
â”‚ + getCurrentJointValues() -> List[float]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

## 7. Cross-Cutting Concerns

### 7.1 Logging Architecture

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               All ROS2 Nodes                             â”‚
â”‚  (Vision, Motion, Control, Orchestrator, etc.)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ rclcpp::Logger
            â”‚ (stdout/stderr)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Docker Log Driver                           â”‚
â”‚  (json-file or syslog)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ JSON logs
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Filebeat                                   â”‚
â”‚  (Log shipper)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Forwards
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Logstash                                    â”‚
â”‚  (Log parsing, enrichment)                               â”‚
â”‚  - Parse JSON                                            â”‚
â”‚  - Add metadata (hostname, container)                    â”‚
â”‚  - Filter by log level                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Indexes
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Elasticsearch                                â”‚
â”‚  (Log storage & search)                                  â”‚
â”‚  - Index: logs-robot-YYYY.MM.DD                          â”‚
â”‚  - Retention: 30 days                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Queries
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kibana                                      â”‚
â”‚  (Log visualization)                                     â”‚
â”‚  - Dashboards                                            â”‚
â”‚  - Alerts (error rate > 10/min)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 7.2 Monitoring & Metrics

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Metrics Collector (Python ROS2 Node)            â”‚
â”‚  - Subscribes to /task/status, /joint_states, etc.       â”‚
â”‚  - Publishes Prometheus metrics on :8000/metrics         â”‚
â”‚  - Writes to InfluxDB                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Scrapes (15s interval)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Prometheus                                  â”‚
â”‚  (Metrics storage & alerting)                            â”‚
â”‚  - Time-series DB                                        â”‚
â”‚  - Retention: 15 days                                    â”‚
â”‚  - Alert rules (uptime < 99%, cycle_time > 3s)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Queries (PromQL)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Grafana                                     â”‚
â”‚  (Dashboards & visualization)                            â”‚
â”‚  - Real-time dashboard (refresh 5s)                      â”‚
â”‚  - Historical trends                                     â”‚
â”‚  - Alerts to Slack/email                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 7.3 Security Architecture

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 User (Browser)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTPS (TLS 1.3)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Nginx Reverse Proxy                         â”‚
â”‚  - TLS termination                                       â”‚
â”‚  - Rate limiting (100 req/min per IP)                    â”‚
â”‚  - Firewall rules (deny all except 443)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTP (internal network)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Web Backend (FastAPI)                         â”‚
â”‚  - OAuth2/JWT authentication                             â”‚
â”‚  - RBAC (Operator, Engineer, Admin roles)                â”‚
â”‚  - API key for MES/ERP                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ SQL (prepared statements)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PostgreSQL                                  â”‚
â”‚  - TLS encryption                                        â”‚
â”‚  - User permissions (least privilege)                    â”‚
â”‚  - Audit logging enabled                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ROS2 Security:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ROS2 DDS (CycloneDDS)                       â”‚
â”‚  - DDS Security (SROS2)                                  â”‚
â”‚  - Encrypted topics (AES-256)                            â”‚
â”‚  - Authentication (X.509 certificates)                   â”‚
â”‚  - Access control lists (permissions.xml)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

## 8. Deployment View

### 8.1 Physical Deployment (Production)

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Intel NUC (Main Compute)                      â”‚
â”‚  CPU: Intel i7-12700H (12 cores)                            â”‚
â”‚  RAM: 32 GB DDR4                                            â”‚
â”‚  Disk: 1 TB NVMe SSD                                        â”‚
â”‚  OS: Ubuntu 22.04 LTS + Docker                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Motion Planning â”‚  â”‚ Orchestrator    â”‚                  â”‚
â”‚  â”‚ (Docker)        â”‚  â”‚ (Docker)        â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Control System  â”‚  â”‚ Web Backend     â”‚                  â”‚
â”‚  â”‚ (Docker RT)     â”‚  â”‚ (Docker)        â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ PostgreSQL      â”‚  â”‚ Prometheus      â”‚                  â”‚
â”‚  â”‚ (Docker)        â”‚  â”‚ (Docker)        â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Gigabit Ethernet
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Jetson Xavier NX (Edge Compute)                    â”‚
â”‚  GPU: 384-core NVIDIA Volta                                 â”‚
â”‚  CPU: 6-core NVIDIA Carmel ARM64                            â”‚
â”‚  RAM: 8 GB LPDDR4                                           â”‚
â”‚  OS: Jetson Linux (L4T) + Docker                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Vision Pipeline â”‚  â”‚ Metrics         â”‚                  â”‚
â”‚  â”‚ (Docker GPU)    â”‚  â”‚ Collector       â”‚                  â”‚
â”‚  â”‚                 â”‚  â”‚ (Docker)        â”‚                  â”‚
â”‚  â”‚ - YOLOv8 +      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â”‚   TensorRT      â”‚                                       â”‚
â”‚  â”‚ - Pose Estimatorâ”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ USB 3.0
               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ RealSense D435i   â”‚
       â”‚ (Camera)          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


         EtherCAT                  Modbus RTU
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UR5e Robot             â”‚   â”‚ Robotiq Gripper  â”‚
â”‚  (6-DOF Arm)            â”‚   â”‚ (2F-85)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### 8.2 Logical Deployment (Docker Network)

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              robot_net (Bridge Network)                     â”‚
â”‚              Subnet: 172.20.0.0/16                          â”‚
â”‚                                                             â”‚
â”‚  Vision Pipeline â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.10                       â”‚
â”‚  Motion Planning â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.20                       â”‚
â”‚  Control System â”€â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.30                       â”‚
â”‚  Orchestrator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.40                       â”‚
â”‚  Web Backend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.50                       â”‚
â”‚  Web Frontend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.60                       â”‚
â”‚  PostgreSQL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.70                       â”‚
â”‚  InfluxDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.71                       â”‚
â”‚  Prometheus â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.80                       â”‚
â”‚  Grafana â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 172.20.0.90                       â”‚
â”‚  Metrics Collector â”€â”€â”€â”€â”€â”€ 172.20.0.100                      â”‚
â”‚                                                             â”‚
â”‚  (All containers communicate via this internal network)     â”‚
â”‚  (No external access except Web Frontend on port 443)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Host Network Ports:
  - 443 (HTTPS) â†’ Nginx â†’ Web Frontend
  - 3000 (Grafana UI) â†’ Grafana
  - 5432 (PostgreSQL) â†’ Blocked externally
  - 9090 (Prometheus) â†’ Blocked externally
\`\`\`

---

## 9. Dynamic Views

### 9.1 Pick and Place Sequence (Simplified C4 Dynamic)

\`\`\`
Operator          Web UI        Backend       Orchestrator   Vision    Motion    Control
   â”‚                 â”‚             â”‚               â”‚            â”‚         â”‚         â”‚
   â”‚ Click "Start"   â”‚             â”‚               â”‚            â”‚         â”‚         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚               â”‚            â”‚         â”‚         â”‚
   â”‚                 â”‚ POST /start â”‚               â”‚            â”‚         â”‚         â”‚
   â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚            â”‚         â”‚         â”‚
   â”‚                 â”‚             â”‚ StartTask()   â”‚            â”‚         â”‚         â”‚
   â”‚                 â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”‚ Capture()  â”‚         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”‚ Objects    â”‚         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”‚ PlanGrasp()â”‚         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
   â”‚                 â”‚             â”‚               â”‚ GraspPose  â”‚         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
   â”‚                 â”‚             â”‚               â”‚ ExecutePick()         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚             â”‚               â”‚            â”‚         â”‚  Done   â”‚
   â”‚                 â”‚             â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                 â”‚ 200 OK      â”‚               â”‚            â”‚         â”‚         â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚            â”‚         â”‚         â”‚
   â”‚ Status update   â”‚             â”‚               â”‚            â”‚         â”‚         â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚               â”‚            â”‚         â”‚         â”‚
   â”‚                 â”‚             â”‚               â”‚            â”‚         â”‚         â”‚
\`\`\`

### 9.2 Error Recovery (Dynamic Behavior)

\`\`\`
Orchestrator      Vision       Grasp Planner    Motion       Control
     â”‚               â”‚               â”‚             â”‚            â”‚
     â”‚ DetectObjects â”‚               â”‚             â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚             â”‚            â”‚
     â”‚ Empty[]       â”‚               â”‚             â”‚            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚             â”‚            â”‚
     â”‚               â”‚               â”‚             â”‚            â”‚
     â”‚ [Retry 1/3]   â”‚               â”‚             â”‚            â”‚
     â”‚ DetectObjects â”‚               â”‚             â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚             â”‚            â”‚
     â”‚ [cube]        â”‚               â”‚             â”‚            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚             â”‚            â”‚
     â”‚               â”‚               â”‚             â”‚            â”‚
     â”‚ ComputeGrasps â”‚               â”‚             â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚            â”‚
     â”‚ Grasp         â”‚               â”‚             â”‚            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚            â”‚
     â”‚               â”‚               â”‚             â”‚            â”‚
     â”‚ ExecutePick   â”‚               â”‚             â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚
     â”‚ FAILED        â”‚               â”‚             â”‚            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
     â”‚               â”‚               â”‚             â”‚            â”‚
     â”‚ [Retry 1/3 with adjusted force]              â”‚            â”‚
     â”‚ ExecutePick(force=25N)        â”‚             â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚
     â”‚ SUCCESS       â”‚               â”‚             â”‚            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
     â”‚               â”‚               â”‚             â”‚            â”‚
\`\`\`

---

## 10. Summary

### 10.1 C4 Model Completeness

âœ… **Level 1 (Context):** System scope, external actors, external systems
âœ… **Level 2 (Containers):** 11 runtime containers (Docker) with technologies
âœ… **Level 3 (Components):** Detailed breakdown of Vision, Motion, Control, Orchestrator
âœ… **Level 4 (Code):** Class diagrams for critical components (YoloDetector, GraspSynthesizer, PickPlaceServer)

### 10.2 Key Architectural Patterns

| **Pattern** | **Application** |
|-------------|----------------|
| **Microservices** | Each subsystem is an independent Docker container |
| **Pub/Sub** | ROS2 DDS for asynchronous communication |
| **Request/Reply** | ROS2 services for synchronous operations |
| **Action Pattern** | Long-running tasks (motion planning, pick/place) |
| **Layered Architecture** | Clear separation: Hardware â†’ Firmware â†’ Middleware â†’ Application â†’ UI |
| **Repository Pattern** | Database access via SQLAlchemy ORM |
| **Dependency Injection** | Constructor injection for testability |

### 10.3 Technology Summary

| **C4 Level** | **Diagram Count** | **Technologies Visualized** |
|--------------|-------------------|-----------------------------|
| **C1: Context** | 1 | Operator, Manager, Engineer, MES, ERP, Safety PLC, UR5e, Camera, Gripper |
| **C2: Containers** | 1 | 11 Docker containers (Vision, Motion, Control, Orchestrator, Backend, Frontend, PostgreSQL, InfluxDB, Prometheus, Grafana, Metrics) |
| **C3: Components** | 4 | 20+ components (Camera Driver, YOLOv8, Pose Estimator, MoveIt2, ros2_control, Behavior Tree, etc.) |
| **C4: Code** | 3 | 3 critical classes (YoloDetector, GraspSynthesizer, PickPlaceServer) |
| **Cross-Cutting** | 3 | Logging (ELK), Monitoring (Prometheus/Grafana), Security (OAuth2/TLS) |
| **Deployment** | 2 | Physical (NUC + Jetson) and Logical (Docker network) |
| **Dynamic** | 2 | Pick-place sequence, Error recovery |

### 10.4 Next Steps

1. **Validation:** Review diagrams with stakeholders (operators, engineers, architects)
2. **Implementation:** Use C3/C4 diagrams as blueprints for coding
3. **Documentation:** Generate PlantUML or Structurizr DSL for automated rendering
4. **Updates:** Keep diagrams synchronized with code changes (living documentation)

---

**Document Status:** âœ… v1.0 Complete
**Next Document:** Building Block Diagrams (module decomposition, data flow)
**Dependencies:** High-Level Design (08), Low-Level Design (14), Technical Stack (05)

---
`;

        document.addEventListener('DOMContentLoaded', function() {
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = marked.parse(markdown);
        });

        function toggleOverlay() {
            const overlay = document.getElementById('overlay');
            overlay.style.display = overlay.style.display === 'none' ? 'block' : 'none';
        }

        function enterVR() {
            const scene = document.querySelector('a-scene');
            if (scene.is('vr-mode')) {
                scene.exitVR();
            } else {
                scene.enterVR();
            }
        }

        function resetView() {
            const cameraRig = document.getElementById('camera-rig');
            cameraRig.setAttribute('position', '0 0 0');
            const camera = document.getElementById('main-camera');
            camera.setAttribute('rotation', '0 0 0');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'd' || e.key === 'D') {
                toggleOverlay();
            } else if (e.key === 'r' || e.key === 'R') {
                resetView();
            }
        });
    </script>
</body>
</html>