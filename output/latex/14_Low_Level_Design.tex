% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={14 Low Level Design},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{14 Low Level Design}
\author{}
\date{}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\hypertarget{low-level-design-lld}{%
\section{Low-Level Design (LLD)}\label{low-level-design-lld}}

\hypertarget{vision-based-pick-and-place-robotic-system}{%
\subsection{Vision-Based Pick and Place Robotic
System}\label{vision-based-pick-and-place-robotic-system}}

\textbf{Document Version:} 1.0 \textbf{Last Updated:} 2025-10-18
\textbf{Status:} ✅ Complete

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{table-of-contents}{%
\subsection{Table of Contents}\label{table-of-contents}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \protect\hyperlink{1-introduction}{Introduction}
\item
  \protect\hyperlink{2-component-level-design}{Component-Level Design}
\item
  \protect\hyperlink{3-vision-subsystem}{Vision Subsystem}
\item
  \protect\hyperlink{4-grasp-planning-subsystem}{Grasp Planning
  Subsystem}
\item
  \protect\hyperlink{5-motion-planning-subsystem}{Motion Planning
  Subsystem}
\item
  \protect\hyperlink{6-control-subsystem}{Control Subsystem}
\item
  \protect\hyperlink{7-task-orchestration-subsystem}{Task Orchestration
  Subsystem}
\item
  \protect\hyperlink{8-monitoring-subsystem}{Monitoring Subsystem}
\item
  \protect\hyperlink{9-data-structures}{Data Structures}
\item
  \protect\hyperlink{10-algorithms}{Algorithms}
\item
  \protect\hyperlink{11-ros2-node-specifications}{ROS2 Node
  Specifications}
\item
  \protect\hyperlink{12-database-schema}{Database Schema}
\item
  \protect\hyperlink{13-api-specifications}{API Specifications}
\item
  \protect\hyperlink{14-state-machines}{State Machines}
\item
  \protect\hyperlink{15-error-handling}{Error Handling}
\item
  \protect\hyperlink{16-performance-optimization}{Performance
  Optimization}
\item
  \protect\hyperlink{17-testing-hooks}{Testing Hooks}
\item
  \protect\hyperlink{18-deployment-configuration}{Deployment
  Configuration}
\end{enumerate}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{introduction}{%
\subsection{1. Introduction}\label{introduction}}

\hypertarget{purpose}{%
\subsubsection{1.1 Purpose}\label{purpose}}

This Low-Level Design (LLD) document provides detailed technical
specifications for implementing the Vision-Based Pick and Place Robotic
System. It translates the High-Level Design (HLD) into concrete
component designs, data structures, algorithms, and interfaces suitable
for direct implementation.

\hypertarget{scope}{%
\subsubsection{1.2 Scope}\label{scope}}

This document covers: - Detailed class/component designs for all
subsystems - Data structures and algorithms - ROS2 node specifications
(topics, services, actions, parameters) - Database schemas - REST/gRPC
API specifications - State machine implementations - Error handling
strategies - Performance optimization techniques

\hypertarget{design-principles}{%
\subsubsection{1.3 Design Principles}\label{design-principles}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.4412}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.5588}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Principle}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Implementation}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\textbf{Modularity} & Each subsystem is a separate ROS2 package with
defined interfaces \\
\textbf{Reusability} & Common utilities in shared libraries (e.g.,
\texttt{robot\_utils}) \\
\textbf{Testability} & Dependency injection, mock interfaces, unit test
hooks \\
\textbf{Scalability} & Stateless services, horizontal scaling via
Docker/K8s \\
\textbf{Maintainability} & Clear naming, comprehensive logging,
configuration files \\
\textbf{Real-Time} & FIFO scheduling, memory pre-allocation, bounded
execution time \\
\end{longtable}

\hypertarget{notation-conventions}{%
\subsubsection{1.4 Notation Conventions}\label{notation-conventions}}

\begin{itemize}
\tightlist
\item
  \textbf{Class Diagrams:} Simplified UML notation (ASCII art)
\item
  \textbf{Sequence Diagrams:} Time flows top-to-bottom
\item
  \textbf{Data Types:} C++ types (e.g.,
  \texttt{std::vector\textless{}double\textgreater{}},
  \texttt{geometry\_msgs::msg::Pose})
\item
  \textbf{Units:} SI units (meters, radians, Newtons) unless specified
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{component-level-design}{%
\subsection{2. Component-Level Design}\label{component-level-design}}

\hypertarget{system-decomposition}{%
\subsubsection{2.1 System Decomposition}\label{system-decomposition}}

\begin{verbatim}
visionpickplace_ws/
├── src/
│   ├── vision_pipeline/          # Vision subsystem
│   │   ├── camera_driver/
│   │   ├── image_processor/
│   │   ├── object_detector/
│   │   └── pose_estimator/
│   ├── grasp_planning/           # Grasp planning subsystem
│   │   ├── grasp_synthesizer/
│   │   └── grasp_evaluator/
│   ├── motion_planning/          # Motion planning subsystem (MoveIt2 configs)
│   │   ├── moveit_config/
│   │   └── collision_objects/
│   ├── control/                  # Control subsystem
│   │   ├── controllers/
│   │   └── hardware_interface/
│   ├── gripper_control/          # Gripper subsystem
│   │   └── robotiq_driver/
│   ├── task_orchestration/       # Orchestration subsystem
│   │   ├── task_manager/
│   │   └── behavior_trees/
│   ├── monitoring/               # Monitoring subsystem
│   │   ├── metrics_collector/
│   │   └── alerting/
│   ├── common/                   # Shared libraries
│   │   ├── robot_msgs/          # Custom ROS2 messages
│   │   ├── robot_utils/         # Utility functions
│   │   └── robot_interfaces/    # Service/action definitions
│   └── web_dashboard/           # Web UI
│       ├── backend/             # FastAPI server
│       └── frontend/            # React app
\end{verbatim}

\hypertarget{technology-mapping}{%
\subsubsection{2.2 Technology Mapping}\label{technology-mapping}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2239}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2090}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.3284}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2388}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Component}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Language}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Framework/Library}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Deployment}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\textbf{Vision Pipeline} & C++ / Python & ROS2, OpenCV, PyTorch & Docker
(GPU) \\
\textbf{Grasp Planning} & Python & NumPy, SciPy, Open3D & Docker
(GPU) \\
\textbf{Motion Planning} & C++ & MoveIt2, OMPL & Docker \\
\textbf{Control} & C++ & ros2\_control, RT-Linux & Bare metal /
Docker \\
\textbf{Orchestration} & C++ / Python & BehaviorTree.CPP & Docker \\
\textbf{Monitoring} & Python & Prometheus, InfluxDB & Docker \\
\textbf{Web Backend} & Python & FastAPI, SQLAlchemy & Docker \\
\textbf{Web Frontend} & TypeScript & React, Next.js & Docker (Nginx) \\
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{vision-subsystem}{%
\subsection{3. Vision Subsystem}\label{vision-subsystem}}

\hypertarget{architecture}{%
\subsubsection{3.1 Architecture}\label{architecture}}

\begin{verbatim}
┌─────────────────┐
│ Camera Driver   │ ──> /camera/color/image_raw (sensor_msgs/Image)
└─────────────────┘     /camera/depth/image_rect (sensor_msgs/Image)
         │              /camera/color/camera_info (sensor_msgs/CameraInfo)
         ▼
┌─────────────────┐
│ Image Processor │ ──> /vision/preprocessed/image (sensor_msgs/Image)
└─────────────────┘
         │
         ▼
┌─────────────────┐
│ Object Detector │ ──> /vision/detections (vision_msgs/Detection2DArray)
└─────────────────┘
         │
         ▼
┌─────────────────┐
│ Pose Estimator  │ ──> /vision/object_poses (geometry_msgs/PoseArray)
└─────────────────┘
\end{verbatim}

\hypertarget{camera-driver-node}{%
\subsubsection{3.2 Camera Driver Node}\label{camera-driver-node}}

\textbf{Package:} \texttt{camera\_driver} \textbf{Node Name:}
\texttt{realsense\_driver\_node} \textbf{Executable:}
\texttt{realsense\_driver}

\hypertarget{class-design}{%
\paragraph{3.2.1 Class Design}\label{class-design}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ RealsenseDriver }\OperatorTok{:} \KeywordTok{public}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{Node }\OperatorTok{\{}
\KeywordTok{public}\OperatorTok{:}
\NormalTok{    RealsenseDriver}\OperatorTok{(}\AttributeTok{const}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{NodeOptions}\OperatorTok{\&}\NormalTok{ options}\OperatorTok{);}
    \OperatorTok{\textasciitilde{}}\NormalTok{RealsenseDriver}\OperatorTok{();}

\KeywordTok{private}\OperatorTok{:}
    \CommentTok{// Camera interface}
\NormalTok{    rs2}\OperatorTok{::}\NormalTok{pipeline }\VariableTok{pipeline\_}\OperatorTok{;}
\NormalTok{    rs2}\OperatorTok{::}\NormalTok{config }\VariableTok{config\_}\OperatorTok{;}

    \CommentTok{// Publishers}
\NormalTok{    image\_transport}\OperatorTok{::}\NormalTok{Publisher }\VariableTok{color\_pub\_}\OperatorTok{;}
\NormalTok{    image\_transport}\OperatorTok{::}\NormalTok{Publisher }\VariableTok{depth\_pub\_}\OperatorTok{;}
\NormalTok{    rclcpp}\OperatorTok{::}\NormalTok{Publisher}\OperatorTok{\textless{}}\NormalTok{sensor\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{CameraInfo}\OperatorTok{\textgreater{}::}\NormalTok{SharedPtr }\VariableTok{camera\_info\_pub\_}\OperatorTok{;}

    \CommentTok{// Timers}
\NormalTok{    rclcpp}\OperatorTok{::}\NormalTok{TimerBase}\OperatorTok{::}\NormalTok{SharedPtr }\VariableTok{capture\_timer\_}\OperatorTok{;}

    \CommentTok{// Parameters}
    \DataTypeTok{int} \VariableTok{width\_}\OperatorTok{;}          \CommentTok{// Default: 1280}
    \DataTypeTok{int} \VariableTok{height\_}\OperatorTok{;}         \CommentTok{// Default: 720}
    \DataTypeTok{int} \VariableTok{fps\_}\OperatorTok{;}            \CommentTok{// Default: 30}
    \BuiltInTok{std::}\NormalTok{string }\VariableTok{serial\_}\OperatorTok{;} \CommentTok{// Camera serial number}

    \CommentTok{// Methods}
    \DataTypeTok{void}\NormalTok{ captureAndPublish}\OperatorTok{();}
    \DataTypeTok{void}\NormalTok{ loadParameters}\OperatorTok{();}
\NormalTok{    sensor\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{Image convertToRosImage}\OperatorTok{(}\AttributeTok{const}\NormalTok{ rs2}\OperatorTok{::}\NormalTok{frame}\OperatorTok{\&}\NormalTok{ frame}\OperatorTok{);}
\NormalTok{    sensor\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{CameraInfo getCameraInfo}\OperatorTok{(}\AttributeTok{const}\NormalTok{ rs2}\OperatorTok{::}\NormalTok{stream\_profile}\OperatorTok{\&}\NormalTok{ profile}\OperatorTok{);}
\OperatorTok{\};}
\end{Highlighting}
\end{Shaded}

\hypertarget{configuration-parameters}{%
\paragraph{3.2.2 Configuration
Parameters}\label{configuration-parameters}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# camera\_driver/config/realsense.yaml}
\FunctionTok{realsense\_driver}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{ros\_\_parameters}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{width}\KeywordTok{:}\AttributeTok{ }\DecValTok{1280}
\AttributeTok{    }\FunctionTok{height}\KeywordTok{:}\AttributeTok{ }\DecValTok{720}
\AttributeTok{    }\FunctionTok{fps}\KeywordTok{:}\AttributeTok{ }\DecValTok{30}
\AttributeTok{    }\FunctionTok{enable\_color}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\AttributeTok{    }\FunctionTok{enable\_depth}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\AttributeTok{    }\FunctionTok{enable\_infra}\KeywordTok{:}\AttributeTok{ }\CharTok{false}
\AttributeTok{    }\FunctionTok{align\_to\_color}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\AttributeTok{    }\FunctionTok{depth\_min\_range}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.3}\CommentTok{  \# meters}
\AttributeTok{    }\FunctionTok{depth\_max\_range}\KeywordTok{:}\AttributeTok{ }\FloatTok{3.0}\CommentTok{  \# meters}
\AttributeTok{    }\FunctionTok{serial\_number}\KeywordTok{:}\AttributeTok{ }\StringTok{""}\CommentTok{     \# Auto{-}detect if empty}
\AttributeTok{    }\FunctionTok{frame\_id}\KeywordTok{:}\AttributeTok{ }\StringTok{"camera\_color\_optical\_frame"}
\AttributeTok{    }\FunctionTok{publish\_rate}\KeywordTok{:}\AttributeTok{ }\FloatTok{30.0}\CommentTok{    \# Hz}
\end{Highlighting}
\end{Shaded}

\hypertarget{published-topics}{%
\paragraph{3.2.3 Published Topics}\label{published-topics}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2444}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2222}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.3333}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2000}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Topic}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Type}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Frequency}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{QoS}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{/camera/color/image\_raw} & \texttt{sensor\_msgs/msg/Image} & 30
Hz & Best Effort \\
\texttt{/camera/depth/image\_rect\_raw} &
\texttt{sensor\_msgs/msg/Image} & 30 Hz & Best Effort \\
\texttt{/camera/color/camera\_info} &
\texttt{sensor\_msgs/msg/CameraInfo} & 30 Hz & Best Effort \\
\texttt{/camera/depth/camera\_info} &
\texttt{sensor\_msgs/msg/CameraInfo} & 30 Hz & Best Effort \\
\end{longtable}

\hypertarget{object-detector-node}{%
\subsubsection{3.3 Object Detector Node}\label{object-detector-node}}

\textbf{Package:} \texttt{object\_detector} \textbf{Node Name:}
\texttt{yolo\_detector\_node} \textbf{Executable:}
\texttt{yolo\_detector}

\hypertarget{class-design-1}{%
\paragraph{3.3.1 Class Design}\label{class-design-1}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ YoloDetector(Node):}
    \KeywordTok{def} \FunctionTok{\_\_init\_\_}\NormalTok{(}\VariableTok{self}\NormalTok{):}
        \BuiltInTok{super}\NormalTok{().}\FunctionTok{\_\_init\_\_}\NormalTok{(}\StringTok{\textquotesingle{}yolo\_detector\_node\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# Model}
        \VariableTok{self}\NormalTok{.model }\OperatorTok{=} \VariableTok{None}  \CommentTok{\# YOLO model (PyTorch)}
        \VariableTok{self}\NormalTok{.device }\OperatorTok{=}\NormalTok{ torch.device(}\StringTok{\textquotesingle{}cuda\textquotesingle{}} \ControlFlowTok{if}\NormalTok{ torch.cuda.is\_available() }\ControlFlowTok{else} \StringTok{\textquotesingle{}cpu\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# Subscribers}
        \VariableTok{self}\NormalTok{.image\_sub }\OperatorTok{=} \VariableTok{self}\NormalTok{.create\_subscription(}
\NormalTok{            Image, }\StringTok{\textquotesingle{}/vision/preprocessed/image\textquotesingle{}}\NormalTok{, }\VariableTok{self}\NormalTok{.image\_callback, }\DecValTok{10}\NormalTok{)}

        \CommentTok{\# Publishers}
        \VariableTok{self}\NormalTok{.detections\_pub }\OperatorTok{=} \VariableTok{self}\NormalTok{.create\_publisher(}
\NormalTok{            Detection2DArray, }\StringTok{\textquotesingle{}/vision/detections\textquotesingle{}}\NormalTok{, }\DecValTok{10}\NormalTok{)}
        \VariableTok{self}\NormalTok{.debug\_image\_pub }\OperatorTok{=} \VariableTok{self}\NormalTok{.create\_publisher(}
\NormalTok{            Image, }\StringTok{\textquotesingle{}/vision/debug/detections\textquotesingle{}}\NormalTok{, }\DecValTok{10}\NormalTok{)}

        \CommentTok{\# Parameters}
        \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}model\_path\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}/models/yolov8n.pt\textquotesingle{}}\NormalTok{)}
        \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}confidence\_threshold\textquotesingle{}}\NormalTok{, }\FloatTok{0.5}\NormalTok{)}
        \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}iou\_threshold\textquotesingle{}}\NormalTok{, }\FloatTok{0.45}\NormalTok{)}
        \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}max\_detections\textquotesingle{}}\NormalTok{, }\DecValTok{10}\NormalTok{)}

        \CommentTok{\# TensorRT engine (optional)}
        \VariableTok{self}\NormalTok{.use\_tensorrt }\OperatorTok{=} \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}use\_tensorrt\textquotesingle{}}\NormalTok{, }\VariableTok{False}\NormalTok{).value}

        \VariableTok{self}\NormalTok{.load\_model()}

    \KeywordTok{def}\NormalTok{ load\_model(}\VariableTok{self}\NormalTok{):}
        \CommentTok{"""Load YOLO model (PyTorch or TensorRT)."""}
\NormalTok{        model\_path }\OperatorTok{=} \VariableTok{self}\NormalTok{.get\_parameter(}\StringTok{\textquotesingle{}model\_path\textquotesingle{}}\NormalTok{).value}
        \ControlFlowTok{if} \VariableTok{self}\NormalTok{.use\_tensorrt:}
            \VariableTok{self}\NormalTok{.model }\OperatorTok{=} \VariableTok{self}\NormalTok{.load\_tensorrt\_model(model\_path)}
        \ControlFlowTok{else}\NormalTok{:}
            \VariableTok{self}\NormalTok{.model }\OperatorTok{=}\NormalTok{ torch.hub.load(}\StringTok{\textquotesingle{}ultralytics/yolov8\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}custom\textquotesingle{}}\NormalTok{, path}\OperatorTok{=}\NormalTok{model\_path)}
            \VariableTok{self}\NormalTok{.model.to(}\VariableTok{self}\NormalTok{.device)}
            \VariableTok{self}\NormalTok{.model.}\BuiltInTok{eval}\NormalTok{()}

    \KeywordTok{def}\NormalTok{ image\_callback(}\VariableTok{self}\NormalTok{, msg: Image):}
        \CommentTok{"""Process incoming image and detect objects."""}
        \CommentTok{\# Convert ROS Image to NumPy/Torch tensor}
\NormalTok{        cv\_image }\OperatorTok{=} \VariableTok{self}\NormalTok{.bridge.imgmsg\_to\_cv2(msg, desired\_encoding}\OperatorTok{=}\StringTok{\textquotesingle{}bgr8\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# Run inference}
        \ControlFlowTok{with}\NormalTok{ torch.no\_grad():}
\NormalTok{            results }\OperatorTok{=} \VariableTok{self}\NormalTok{.model(cv\_image)}

        \CommentTok{\# Parse results}
\NormalTok{        detections }\OperatorTok{=} \VariableTok{self}\NormalTok{.parse\_detections(results)}

        \CommentTok{\# Publish}
        \VariableTok{self}\NormalTok{.detections\_pub.publish(detections)}

        \CommentTok{\# Publish debug image}
        \ControlFlowTok{if} \VariableTok{self}\NormalTok{.debug\_image\_pub.get\_subscription\_count() }\OperatorTok{\textgreater{}} \DecValTok{0}\NormalTok{:}
\NormalTok{            debug\_img }\OperatorTok{=} \VariableTok{self}\NormalTok{.draw\_detections(cv\_image, detections)}
            \VariableTok{self}\NormalTok{.debug\_image\_pub.publish(}\VariableTok{self}\NormalTok{.bridge.cv2\_to\_imgmsg(debug\_img, }\StringTok{\textquotesingle{}bgr8\textquotesingle{}}\NormalTok{))}

    \KeywordTok{def}\NormalTok{ parse\_detections(}\VariableTok{self}\NormalTok{, results) }\OperatorTok{{-}\textgreater{}}\NormalTok{ Detection2DArray:}
        \CommentTok{"""Convert YOLO results to ROS Detection2DArray."""}
\NormalTok{        detections }\OperatorTok{=}\NormalTok{ Detection2DArray()}
\NormalTok{        detections.header.stamp }\OperatorTok{=} \VariableTok{self}\NormalTok{.get\_clock().now().to\_msg()}
\NormalTok{        detections.header.frame\_id }\OperatorTok{=} \StringTok{"camera\_color\_optical\_frame"}

\NormalTok{        conf\_thresh }\OperatorTok{=} \VariableTok{self}\NormalTok{.get\_parameter(}\StringTok{\textquotesingle{}confidence\_threshold\textquotesingle{}}\NormalTok{).value}

        \ControlFlowTok{for}\NormalTok{ detection }\KeywordTok{in}\NormalTok{ results.xyxy[}\DecValTok{0}\NormalTok{]:  }\CommentTok{\# [x1, y1, x2, y2, conf, class]}
            \ControlFlowTok{if}\NormalTok{ detection[}\DecValTok{4}\NormalTok{] }\OperatorTok{\textless{}}\NormalTok{ conf\_thresh:}
                \ControlFlowTok{continue}

\NormalTok{            det }\OperatorTok{=}\NormalTok{ Detection2D()}
\NormalTok{            det.bbox.center.x }\OperatorTok{=}\NormalTok{ (detection[}\DecValTok{0}\NormalTok{] }\OperatorTok{+}\NormalTok{ detection[}\DecValTok{2}\NormalTok{]) }\OperatorTok{/} \FloatTok{2.0}
\NormalTok{            det.bbox.center.y }\OperatorTok{=}\NormalTok{ (detection[}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\NormalTok{ detection[}\DecValTok{3}\NormalTok{]) }\OperatorTok{/} \FloatTok{2.0}
\NormalTok{            det.bbox.size\_x }\OperatorTok{=}\NormalTok{ detection[}\DecValTok{2}\NormalTok{] }\OperatorTok{{-}}\NormalTok{ detection[}\DecValTok{0}\NormalTok{]}
\NormalTok{            det.bbox.size\_y }\OperatorTok{=}\NormalTok{ detection[}\DecValTok{3}\NormalTok{] }\OperatorTok{{-}}\NormalTok{ detection[}\DecValTok{1}\NormalTok{]}

\NormalTok{            hypothesis }\OperatorTok{=}\NormalTok{ ObjectHypothesisWithPose()}
\NormalTok{            hypothesis.}\BuiltInTok{id} \OperatorTok{=} \BuiltInTok{str}\NormalTok{(}\BuiltInTok{int}\NormalTok{(detection[}\DecValTok{5}\NormalTok{]))}
\NormalTok{            hypothesis.score }\OperatorTok{=} \BuiltInTok{float}\NormalTok{(detection[}\DecValTok{4}\NormalTok{])}
\NormalTok{            det.results.append(hypothesis)}

\NormalTok{            detections.detections.append(det)}

        \ControlFlowTok{return}\NormalTok{ detections}
\end{Highlighting}
\end{Shaded}

\hypertarget{performance-optimization}{%
\paragraph{3.3.2 Performance
Optimization}\label{performance-optimization}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3600}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3800}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.2600}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Optimization}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Implementation}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Speedup}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\textbf{TensorRT} & Convert PyTorch model to TensorRT engine & 3-5x
faster \\
\textbf{FP16 Precision} & Use half-precision (16-bit) inference & 2x
faster \\
\textbf{Batch Processing} & Process multiple images in parallel & 1.5x
throughput \\
\textbf{NMS Optimization} & GPU-accelerated Non-Max Suppression & 1.2x
faster \\
\textbf{Input Resizing} & Resize to 640×640 (vs 1280×720) & 2x faster \\
\end{longtable}

\textbf{Target Latency:} \textless50ms per frame (on Jetson Xavier NX
with TensorRT FP16)

\hypertarget{pose-estimator-node}{%
\subsubsection{3.4 Pose Estimator Node}\label{pose-estimator-node}}

\textbf{Package:} \texttt{pose\_estimator} \textbf{Node Name:}
\texttt{pose\_estimator\_node} \textbf{Executable:}
\texttt{pose\_estimator}

\hypertarget{class-design-2}{%
\paragraph{3.4.1 Class Design}\label{class-design-2}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ PoseEstimator(Node):}
    \KeywordTok{def} \FunctionTok{\_\_init\_\_}\NormalTok{(}\VariableTok{self}\NormalTok{):}
        \BuiltInTok{super}\NormalTok{().}\FunctionTok{\_\_init\_\_}\NormalTok{(}\StringTok{\textquotesingle{}pose\_estimator\_node\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# Subscribers}
        \VariableTok{self}\NormalTok{.detections\_sub }\OperatorTok{=}\NormalTok{ message\_filters.Subscriber(}
            \VariableTok{self}\NormalTok{, Detection2DArray, }\StringTok{\textquotesingle{}/vision/detections\textquotesingle{}}\NormalTok{)}
        \VariableTok{self}\NormalTok{.depth\_sub }\OperatorTok{=}\NormalTok{ message\_filters.Subscriber(}
            \VariableTok{self}\NormalTok{, Image, }\StringTok{\textquotesingle{}/camera/depth/image\_rect\_raw\textquotesingle{}}\NormalTok{)}
        \VariableTok{self}\NormalTok{.camera\_info\_sub }\OperatorTok{=}\NormalTok{ message\_filters.Subscriber(}
            \VariableTok{self}\NormalTok{, CameraInfo, }\StringTok{\textquotesingle{}/camera/depth/camera\_info\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# Synchronizer}
        \VariableTok{self}\NormalTok{.sync }\OperatorTok{=}\NormalTok{ message\_filters.ApproximateTimeSynchronizer(}
\NormalTok{            [}\VariableTok{self}\NormalTok{.detections\_sub, }\VariableTok{self}\NormalTok{.depth\_sub, }\VariableTok{self}\NormalTok{.camera\_info\_sub],}
\NormalTok{            queue\_size}\OperatorTok{=}\DecValTok{10}\NormalTok{, slop}\OperatorTok{=}\FloatTok{0.1}\NormalTok{)}
        \VariableTok{self}\NormalTok{.sync.registerCallback(}\VariableTok{self}\NormalTok{.callback)}

        \CommentTok{\# Publishers}
        \VariableTok{self}\NormalTok{.poses\_pub }\OperatorTok{=} \VariableTok{self}\NormalTok{.create\_publisher(}
\NormalTok{            PoseArray, }\StringTok{\textquotesingle{}/vision/object\_poses\textquotesingle{}}\NormalTok{, }\DecValTok{10}\NormalTok{)}
        \VariableTok{self}\NormalTok{.pointcloud\_pub }\OperatorTok{=} \VariableTok{self}\NormalTok{.create\_publisher(}
\NormalTok{            PointCloud2, }\StringTok{\textquotesingle{}/vision/object\_pointclouds\textquotesingle{}}\NormalTok{, }\DecValTok{10}\NormalTok{)}

        \CommentTok{\# TF2 broadcaster}
        \VariableTok{self}\NormalTok{.tf\_broadcaster }\OperatorTok{=}\NormalTok{ tf2\_ros.TransformBroadcaster(}\VariableTok{self}\NormalTok{)}

        \CommentTok{\# Camera intrinsics}
        \VariableTok{self}\NormalTok{.K }\OperatorTok{=} \VariableTok{None}  \CommentTok{\# 3x3 intrinsic matrix}
        \VariableTok{self}\NormalTok{.D }\OperatorTok{=} \VariableTok{None}  \CommentTok{\# Distortion coefficients}

        \CommentTok{\# PCA{-}based pose estimator}
        \VariableTok{self}\NormalTok{.pca\_estimator }\OperatorTok{=}\NormalTok{ PCABasedPoseEstimator()}

    \KeywordTok{def}\NormalTok{ callback(}\VariableTok{self}\NormalTok{, detections\_msg, depth\_msg, camera\_info\_msg):}
        \CommentTok{"""Estimate 6DoF pose for each detected object."""}
        \CommentTok{\# Update camera intrinsics}
        \ControlFlowTok{if} \VariableTok{self}\NormalTok{.K }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
            \VariableTok{self}\NormalTok{.K }\OperatorTok{=}\NormalTok{ np.array(camera\_info\_msg.k).reshape(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{)}
            \VariableTok{self}\NormalTok{.D }\OperatorTok{=}\NormalTok{ np.array(camera\_info\_msg.d)}

        \CommentTok{\# Convert depth image}
\NormalTok{        depth\_image }\OperatorTok{=} \VariableTok{self}\NormalTok{.bridge.imgmsg\_to\_cv2(depth\_msg, desired\_encoding}\OperatorTok{=}\StringTok{\textquotesingle{}16UC1\textquotesingle{}}\NormalTok{)}
\NormalTok{        depth\_image }\OperatorTok{=}\NormalTok{ depth\_image.astype(np.float32) }\OperatorTok{/} \FloatTok{1000.0}  \CommentTok{\# mm to meters}

\NormalTok{        poses }\OperatorTok{=}\NormalTok{ PoseArray()}
\NormalTok{        poses.header }\OperatorTok{=}\NormalTok{ detections\_msg.header}

        \ControlFlowTok{for}\NormalTok{ det }\KeywordTok{in}\NormalTok{ detections\_msg.detections:}
            \CommentTok{\# Extract bounding box}
\NormalTok{            x\_min }\OperatorTok{=} \BuiltInTok{int}\NormalTok{(det.bbox.center.x }\OperatorTok{{-}}\NormalTok{ det.bbox.size\_x }\OperatorTok{/} \DecValTok{2}\NormalTok{)}
\NormalTok{            y\_min }\OperatorTok{=} \BuiltInTok{int}\NormalTok{(det.bbox.center.y }\OperatorTok{{-}}\NormalTok{ det.bbox.size\_y }\OperatorTok{/} \DecValTok{2}\NormalTok{)}
\NormalTok{            x\_max }\OperatorTok{=} \BuiltInTok{int}\NormalTok{(det.bbox.center.x }\OperatorTok{+}\NormalTok{ det.bbox.size\_x }\OperatorTok{/} \DecValTok{2}\NormalTok{)}
\NormalTok{            y\_max }\OperatorTok{=} \BuiltInTok{int}\NormalTok{(det.bbox.center.y }\OperatorTok{+}\NormalTok{ det.bbox.size\_y }\OperatorTok{/} \DecValTok{2}\NormalTok{)}

            \CommentTok{\# Extract point cloud for object}
\NormalTok{            obj\_cloud }\OperatorTok{=} \VariableTok{self}\NormalTok{.extract\_pointcloud(depth\_image, x\_min, y\_min, x\_max, y\_max)}

            \CommentTok{\# Estimate pose using PCA}
\NormalTok{            pose }\OperatorTok{=} \VariableTok{self}\NormalTok{.pca\_estimator.estimate(obj\_cloud)}

\NormalTok{            poses.poses.append(pose)}

            \CommentTok{\# Broadcast TF}
            \VariableTok{self}\NormalTok{.broadcast\_transform(pose, det.results[}\DecValTok{0}\NormalTok{].}\BuiltInTok{id}\NormalTok{)}

        \VariableTok{self}\NormalTok{.poses\_pub.publish(poses)}

    \KeywordTok{def}\NormalTok{ extract\_pointcloud(}\VariableTok{self}\NormalTok{, depth\_image, x\_min, y\_min, x\_max, y\_max):}
        \CommentTok{"""Convert depth ROI to 3D point cloud."""}
\NormalTok{        points }\OperatorTok{=}\NormalTok{ []}
        \ControlFlowTok{for}\NormalTok{ v }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(y\_min, y\_max):}
            \ControlFlowTok{for}\NormalTok{ u }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(x\_min, x\_max):}
\NormalTok{                z }\OperatorTok{=}\NormalTok{ depth\_image[v, u]}
                \ControlFlowTok{if}\NormalTok{ z }\OperatorTok{==} \DecValTok{0} \KeywordTok{or}\NormalTok{ np.isnan(z) }\KeywordTok{or}\NormalTok{ z }\OperatorTok{\textgreater{}} \FloatTok{3.0}\NormalTok{:  }\CommentTok{\# Invalid depth}
                    \ControlFlowTok{continue}
                \CommentTok{\# Backproject to 3D}
\NormalTok{                x }\OperatorTok{=}\NormalTok{ (u }\OperatorTok{{-}} \VariableTok{self}\NormalTok{.K[}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{]) }\OperatorTok{*}\NormalTok{ z }\OperatorTok{/} \VariableTok{self}\NormalTok{.K[}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{]}
\NormalTok{                y }\OperatorTok{=}\NormalTok{ (v }\OperatorTok{{-}} \VariableTok{self}\NormalTok{.K[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{]) }\OperatorTok{*}\NormalTok{ z }\OperatorTok{/} \VariableTok{self}\NormalTok{.K[}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{]}
\NormalTok{                points.append([x, y, z])}
        \ControlFlowTok{return}\NormalTok{ np.array(points)}

    \KeywordTok{def}\NormalTok{ broadcast\_transform(}\VariableTok{self}\NormalTok{, pose, object\_id):}
        \CommentTok{"""Broadcast TF for object."""}
\NormalTok{        t }\OperatorTok{=}\NormalTok{ TransformStamped()}
\NormalTok{        t.header.stamp }\OperatorTok{=} \VariableTok{self}\NormalTok{.get\_clock().now().to\_msg()}
\NormalTok{        t.header.frame\_id }\OperatorTok{=} \StringTok{"camera\_color\_optical\_frame"}
\NormalTok{        t.child\_frame\_id }\OperatorTok{=} \SpecialStringTok{f"object\_}\SpecialCharTok{\{}\NormalTok{object\_id}\SpecialCharTok{\}}\SpecialStringTok{"}
\NormalTok{        t.transform.translation.x }\OperatorTok{=}\NormalTok{ pose.position.x}
\NormalTok{        t.transform.translation.y }\OperatorTok{=}\NormalTok{ pose.position.y}
\NormalTok{        t.transform.translation.z }\OperatorTok{=}\NormalTok{ pose.position.z}
\NormalTok{        t.transform.rotation }\OperatorTok{=}\NormalTok{ pose.orientation}
        \VariableTok{self}\NormalTok{.tf\_broadcaster.sendTransform(t)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pca-based-pose-estimation-algorithm}{%
\paragraph{3.4.2 PCA-Based Pose Estimation
Algorithm}\label{pca-based-pose-estimation-algorithm}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ PCABasedPoseEstimator:}
    \CommentTok{"""Estimate object pose using Principal Component Analysis."""}

    \KeywordTok{def}\NormalTok{ estimate(}\VariableTok{self}\NormalTok{, points: np.ndarray) }\OperatorTok{{-}\textgreater{}}\NormalTok{ Pose:}
        \CommentTok{"""}
\CommentTok{        Estimate 6DoF pose from 3D point cloud.}

\CommentTok{        Args:}
\CommentTok{            points: Nx3 array of 3D points}

\CommentTok{        Returns:}
\CommentTok{            Pose with position (centroid) and orientation (PCA axes)}
\CommentTok{        """}
        \ControlFlowTok{if} \BuiltInTok{len}\NormalTok{(points) }\OperatorTok{\textless{}} \DecValTok{10}\NormalTok{:}
            \ControlFlowTok{raise} \PreprocessorTok{ValueError}\NormalTok{(}\StringTok{"Insufficient points for PCA"}\NormalTok{)}

        \CommentTok{\# Compute centroid}
\NormalTok{        centroid }\OperatorTok{=}\NormalTok{ np.mean(points, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}

        \CommentTok{\# Center points}
\NormalTok{        centered }\OperatorTok{=}\NormalTok{ points }\OperatorTok{{-}}\NormalTok{ centroid}

        \CommentTok{\# Compute covariance matrix}
\NormalTok{        cov }\OperatorTok{=}\NormalTok{ np.cov(centered.T)}

        \CommentTok{\# Eigen decomposition}
\NormalTok{        eigenvalues, eigenvectors }\OperatorTok{=}\NormalTok{ np.linalg.eig(cov)}

        \CommentTok{\# Sort by eigenvalues (descending)}
\NormalTok{        idx }\OperatorTok{=}\NormalTok{ eigenvalues.argsort()[::}\OperatorTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{        eigenvectors }\OperatorTok{=}\NormalTok{ eigenvectors[:, idx]}

        \CommentTok{\# Ensure right{-}handed coordinate system}
        \ControlFlowTok{if}\NormalTok{ np.linalg.det(eigenvectors) }\OperatorTok{\textless{}} \DecValTok{0}\NormalTok{:}
\NormalTok{            eigenvectors[:, }\DecValTok{2}\NormalTok{] }\OperatorTok{*=} \OperatorTok{{-}}\DecValTok{1}

        \CommentTok{\# Convert rotation matrix to quaternion}
\NormalTok{        rotation\_matrix }\OperatorTok{=}\NormalTok{ eigenvectors}
\NormalTok{        quaternion }\OperatorTok{=} \VariableTok{self}\NormalTok{.rotation\_matrix\_to\_quaternion(rotation\_matrix)}

        \CommentTok{\# Create Pose message}
\NormalTok{        pose }\OperatorTok{=}\NormalTok{ Pose()}
\NormalTok{        pose.position.x }\OperatorTok{=}\NormalTok{ centroid[}\DecValTok{0}\NormalTok{]}
\NormalTok{        pose.position.y }\OperatorTok{=}\NormalTok{ centroid[}\DecValTok{1}\NormalTok{]}
\NormalTok{        pose.position.z }\OperatorTok{=}\NormalTok{ centroid[}\DecValTok{2}\NormalTok{]}
\NormalTok{        pose.orientation.x }\OperatorTok{=}\NormalTok{ quaternion[}\DecValTok{0}\NormalTok{]}
\NormalTok{        pose.orientation.y }\OperatorTok{=}\NormalTok{ quaternion[}\DecValTok{1}\NormalTok{]}
\NormalTok{        pose.orientation.z }\OperatorTok{=}\NormalTok{ quaternion[}\DecValTok{2}\NormalTok{]}
\NormalTok{        pose.orientation.w }\OperatorTok{=}\NormalTok{ quaternion[}\DecValTok{3}\NormalTok{]}

        \ControlFlowTok{return}\NormalTok{ pose}

    \AttributeTok{@staticmethod}
    \KeywordTok{def}\NormalTok{ rotation\_matrix\_to\_quaternion(R: np.ndarray) }\OperatorTok{{-}\textgreater{}}\NormalTok{ np.ndarray:}
        \CommentTok{"""Convert 3x3 rotation matrix to quaternion [x, y, z, w]."""}
\NormalTok{        trace }\OperatorTok{=}\NormalTok{ np.trace(R)}
        \ControlFlowTok{if}\NormalTok{ trace }\OperatorTok{\textgreater{}} \DecValTok{0}\NormalTok{:}
\NormalTok{            s }\OperatorTok{=} \FloatTok{0.5} \OperatorTok{/}\NormalTok{ np.sqrt(trace }\OperatorTok{+} \FloatTok{1.0}\NormalTok{)}
\NormalTok{            w }\OperatorTok{=} \FloatTok{0.25} \OperatorTok{/}\NormalTok{ s}
\NormalTok{            x }\OperatorTok{=}\NormalTok{ (R[}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{] }\OperatorTok{{-}}\NormalTok{ R[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{]) }\OperatorTok{*}\NormalTok{ s}
\NormalTok{            y }\OperatorTok{=}\NormalTok{ (R[}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{] }\OperatorTok{{-}}\NormalTok{ R[}\DecValTok{2}\NormalTok{, }\DecValTok{0}\NormalTok{]) }\OperatorTok{*}\NormalTok{ s}
\NormalTok{            z }\OperatorTok{=}\NormalTok{ (R[}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{] }\OperatorTok{{-}}\NormalTok{ R[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{]) }\OperatorTok{*}\NormalTok{ s}
        \ControlFlowTok{else}\NormalTok{:}
            \CommentTok{\# ... (full implementation omitted for brevity)}
            \ControlFlowTok{pass}
        \ControlFlowTok{return}\NormalTok{ np.array([x, y, z, w])}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{grasp-planning-subsystem}{%
\subsection{4. Grasp Planning
Subsystem}\label{grasp-planning-subsystem}}

\hypertarget{architecture-1}{%
\subsubsection{4.1 Architecture}\label{architecture-1}}

\begin{verbatim}
┌──────────────────────┐
│ Grasp Synthesizer    │ ──> Generates candidate grasps
└──────────────────────┘
         │
         ▼
┌──────────────────────┐
│ Grasp Evaluator      │ ──> Scores and ranks grasps
└──────────────────────┘
         │
         ▼
┌──────────────────────┐
│ Collision Checker    │ ──> Validates grasp feasibility
└──────────────────────┘
\end{verbatim}

\hypertarget{grasp-synthesizer-service}{%
\subsubsection{4.2 Grasp Synthesizer
Service}\label{grasp-synthesizer-service}}

\textbf{Package:} \texttt{grasp\_synthesizer} \textbf{Service Name:}
\texttt{compute\_grasps} \textbf{Service Type:}
\texttt{robot\_interfaces/srv/ComputeGrasps}

\hypertarget{service-definition}{%
\paragraph{4.2.1 Service Definition}\label{service-definition}}

\begin{verbatim}
# robot_interfaces/srv/ComputeGrasps.srv
# Request
geometry_msgs/Pose object_pose
float32 object_width   # meters
float32 object_depth   # meters
float32 object_height  # meters
string object_shape    # "box" | "cylinder" | "sphere" | "unknown"
---
# Response
Grasp[] grasps
bool success
string message
\end{verbatim}

\begin{verbatim}
# robot_interfaces/msg/Grasp.msg
geometry_msgs/PoseStamped pose       # Grasp pose (TCP frame)
float32 quality                      # Grasp quality score [0, 1]
float32 approach_distance            # Pre-grasp offset (meters)
geometry_msgs/Vector3 approach_direction
float32 gripper_width                # Target gripper opening (meters)
float32 force                        # Target gripping force (Newtons)
\end{verbatim}

\hypertarget{class-design-3}{%
\paragraph{4.2.2 Class Design}\label{class-design-3}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ GraspSynthesizer(Node):}
    \KeywordTok{def} \FunctionTok{\_\_init\_\_}\NormalTok{(}\VariableTok{self}\NormalTok{):}
        \BuiltInTok{super}\NormalTok{().}\FunctionTok{\_\_init\_\_}\NormalTok{(}\StringTok{\textquotesingle{}grasp\_synthesizer\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# Service}
        \VariableTok{self}\NormalTok{.srv }\OperatorTok{=} \VariableTok{self}\NormalTok{.create\_service(}
\NormalTok{            ComputeGrasps, }\StringTok{\textquotesingle{}compute\_grasps\textquotesingle{}}\NormalTok{, }\VariableTok{self}\NormalTok{.compute\_grasps\_callback)}

        \CommentTok{\# Parameters}
        \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}num\_candidates\textquotesingle{}}\NormalTok{, }\DecValTok{20}\NormalTok{)}
        \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}gripper\_max\_width\textquotesingle{}}\NormalTok{, }\FloatTok{0.085}\NormalTok{)  }\CommentTok{\# Robotiq 2F{-}85}
        \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}gripper\_min\_width\textquotesingle{}}\NormalTok{, }\FloatTok{0.0}\NormalTok{)}
        \VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}friction\_coefficient\textquotesingle{}}\NormalTok{, }\FloatTok{0.5}\NormalTok{)}

    \KeywordTok{def}\NormalTok{ compute\_grasps\_callback(}\VariableTok{self}\NormalTok{, request, response):}
        \CommentTok{"""Generate antipodal grasp candidates."""}
\NormalTok{        object\_pose }\OperatorTok{=}\NormalTok{ request.object\_pose}
\NormalTok{        shape }\OperatorTok{=}\NormalTok{ request.object\_shape}

        \ControlFlowTok{if}\NormalTok{ shape }\OperatorTok{==} \StringTok{"box"}\NormalTok{:}
\NormalTok{            grasps }\OperatorTok{=} \VariableTok{self}\NormalTok{.generate\_box\_grasps(request)}
        \ControlFlowTok{elif}\NormalTok{ shape }\OperatorTok{==} \StringTok{"cylinder"}\NormalTok{:}
\NormalTok{            grasps }\OperatorTok{=} \VariableTok{self}\NormalTok{.generate\_cylinder\_grasps(request)}
        \ControlFlowTok{else}\NormalTok{:}
\NormalTok{            grasps }\OperatorTok{=} \VariableTok{self}\NormalTok{.generate\_generic\_grasps(request)}

        \CommentTok{\# Sort by quality}
\NormalTok{        grasps.sort(key}\OperatorTok{=}\KeywordTok{lambda}\NormalTok{ g: g.quality, reverse}\OperatorTok{=}\VariableTok{True}\NormalTok{)}

        \CommentTok{\# Return top candidates}
\NormalTok{        num\_candidates }\OperatorTok{=} \VariableTok{self}\NormalTok{.get\_parameter(}\StringTok{\textquotesingle{}num\_candidates\textquotesingle{}}\NormalTok{).value}
\NormalTok{        response.grasps }\OperatorTok{=}\NormalTok{ grasps[:num\_candidates]}
\NormalTok{        response.success }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(response.grasps) }\OperatorTok{\textgreater{}} \DecValTok{0}
\NormalTok{        response.message }\OperatorTok{=} \SpecialStringTok{f"Generated }\SpecialCharTok{\{}\BuiltInTok{len}\NormalTok{(response.grasps)}\SpecialCharTok{\}}\SpecialStringTok{ grasps"}

        \ControlFlowTok{return}\NormalTok{ response}

    \KeywordTok{def}\NormalTok{ generate\_box\_grasps(}\VariableTok{self}\NormalTok{, request) }\OperatorTok{{-}\textgreater{}}\NormalTok{ List[Grasp]:}
        \CommentTok{"""Generate grasps for box{-}shaped objects."""}
\NormalTok{        grasps }\OperatorTok{=}\NormalTok{ []}
\NormalTok{        width }\OperatorTok{=}\NormalTok{ request.object\_width}
\NormalTok{        depth }\OperatorTok{=}\NormalTok{ request.object\_depth}
\NormalTok{        height }\OperatorTok{=}\NormalTok{ request.object\_height}

        \CommentTok{\# Grasp from top (along Z{-}axis)}
        \ControlFlowTok{for}\NormalTok{ angle }\KeywordTok{in}\NormalTok{ np.linspace(}\DecValTok{0}\NormalTok{, }\DecValTok{2}\OperatorTok{*}\NormalTok{np.pi, }\DecValTok{8}\NormalTok{, endpoint}\OperatorTok{=}\VariableTok{False}\NormalTok{):}
\NormalTok{            grasp }\OperatorTok{=}\NormalTok{ Grasp()}
\NormalTok{            grasp.pose.header.frame\_id }\OperatorTok{=} \StringTok{"base\_link"}
\NormalTok{            grasp.pose.pose }\OperatorTok{=} \VariableTok{self}\NormalTok{.compute\_grasp\_pose(}
\NormalTok{                request.object\_pose, approach}\OperatorTok{=}\StringTok{"top"}\NormalTok{, rotation}\OperatorTok{=}\NormalTok{angle)}
\NormalTok{            grasp.quality }\OperatorTok{=} \VariableTok{self}\NormalTok{.evaluate\_grasp\_quality(grasp, request)}
\NormalTok{            grasp.approach\_distance }\OperatorTok{=} \FloatTok{0.1}  \CommentTok{\# 10 cm pre{-}grasp}
\NormalTok{            grasp.gripper\_width }\OperatorTok{=} \BuiltInTok{min}\NormalTok{(}\BuiltInTok{max}\NormalTok{(width, depth), }\VariableTok{self}\NormalTok{.get\_parameter(}\StringTok{\textquotesingle{}gripper\_max\_width\textquotesingle{}}\NormalTok{).value)}
\NormalTok{            grasp.force }\OperatorTok{=} \FloatTok{20.0}  \CommentTok{\# Newtons}
\NormalTok{            grasps.append(grasp)}

        \CommentTok{\# Grasp from sides}
        \CommentTok{\# ... (additional grasp generation logic)}

        \ControlFlowTok{return}\NormalTok{ grasps}

    \KeywordTok{def}\NormalTok{ evaluate\_grasp\_quality(}\VariableTok{self}\NormalTok{, grasp: Grasp, request) }\OperatorTok{{-}\textgreater{}} \BuiltInTok{float}\NormalTok{:}
        \CommentTok{"""}
\CommentTok{        Compute grasp quality metric (Ferrari{-}Canny metric).}

\CommentTok{        Quality = min\_wrench / object\_weight}
\CommentTok{        where min\_wrench is the minimum wrench that can be resisted.}
\CommentTok{        """}
        \CommentTok{\# Simplified quality metric based on geometry}
        \CommentTok{\# Full implementation would use force closure analysis}

\NormalTok{        gripper\_width }\OperatorTok{=}\NormalTok{ grasp.gripper\_width}
\NormalTok{        object\_width }\OperatorTok{=}\NormalTok{ request.object\_width}

        \CommentTok{\# Penalize if object is too wide for gripper}
        \ControlFlowTok{if}\NormalTok{ gripper\_width }\OperatorTok{\textgreater{}} \VariableTok{self}\NormalTok{.get\_parameter(}\StringTok{\textquotesingle{}gripper\_max\_width\textquotesingle{}}\NormalTok{).value:}
            \ControlFlowTok{return} \FloatTok{0.0}

        \CommentTok{\# Higher quality for centered grasps}
\NormalTok{        width\_ratio }\OperatorTok{=}\NormalTok{ gripper\_width }\OperatorTok{/} \VariableTok{self}\NormalTok{.get\_parameter(}\StringTok{\textquotesingle{}gripper\_max\_width\textquotesingle{}}\NormalTok{).value}
\NormalTok{        quality }\OperatorTok{=} \FloatTok{1.0} \OperatorTok{{-}} \BuiltInTok{abs}\NormalTok{(width\_ratio }\OperatorTok{{-}} \FloatTok{0.5}\NormalTok{) }\OperatorTok{*} \FloatTok{0.5}

        \ControlFlowTok{return} \BuiltInTok{max}\NormalTok{(}\FloatTok{0.0}\NormalTok{, }\BuiltInTok{min}\NormalTok{(}\FloatTok{1.0}\NormalTok{, quality))}
\end{Highlighting}
\end{Shaded}

\hypertarget{collision-checker}{%
\subsubsection{4.3 Collision Checker}\label{collision-checker}}

\textbf{Package:} \texttt{grasp\_evaluator} \textbf{Node Name:}
\texttt{collision\_checker\_node}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ CollisionChecker }\OperatorTok{\{}
\KeywordTok{public}\OperatorTok{:}
\NormalTok{    CollisionChecker}\OperatorTok{(}\AttributeTok{const}\NormalTok{ planning\_scene}\OperatorTok{::}\NormalTok{PlanningScenePtr}\OperatorTok{\&}\NormalTok{ scene}\OperatorTok{)}
        \OperatorTok{:} \VariableTok{planning\_scene\_}\OperatorTok{(}\NormalTok{scene}\OperatorTok{)} \OperatorTok{\{\}}

    \DataTypeTok{bool}\NormalTok{ isGraspValid}\OperatorTok{(}\AttributeTok{const}\NormalTok{ Grasp}\OperatorTok{\&}\NormalTok{ grasp}\OperatorTok{)} \OperatorTok{\{}
        \CommentTok{// Set robot state to grasp pose}
\NormalTok{        robot\_state}\OperatorTok{::}\NormalTok{RobotState}\OperatorTok{\&}\NormalTok{ state }\OperatorTok{=} \VariableTok{planning\_scene\_}\OperatorTok{{-}\textgreater{}}\NormalTok{getCurrentStateNonConst}\OperatorTok{();}

        \CommentTok{// Convert grasp pose to joint positions (IK)}
        \AttributeTok{const}\NormalTok{ robot\_model}\OperatorTok{::}\NormalTok{JointModelGroup}\OperatorTok{*}\NormalTok{ jmg }\OperatorTok{=}
\NormalTok{            state}\OperatorTok{.}\NormalTok{getJointModelGroup}\OperatorTok{(}\StringTok{"manipulator"}\OperatorTok{);}

        \DataTypeTok{bool}\NormalTok{ ik\_success }\OperatorTok{=}\NormalTok{ state}\OperatorTok{.}\NormalTok{setFromIK}\OperatorTok{(}\NormalTok{jmg}\OperatorTok{,}\NormalTok{ grasp}\OperatorTok{.}\NormalTok{pose}\OperatorTok{.}\NormalTok{pose}\OperatorTok{);}
        \ControlFlowTok{if} \OperatorTok{(!}\NormalTok{ik\_success}\OperatorTok{)} \OperatorTok{\{}
            \ControlFlowTok{return} \KeywordTok{false}\OperatorTok{;}  \CommentTok{// Unreachable}
        \OperatorTok{\}}

        \CommentTok{// Check self{-}collision}
\NormalTok{        collision\_detection}\OperatorTok{::}\NormalTok{CollisionRequest req}\OperatorTok{;}
\NormalTok{        collision\_detection}\OperatorTok{::}\NormalTok{CollisionResult res}\OperatorTok{;}
        \VariableTok{planning\_scene\_}\OperatorTok{{-}\textgreater{}}\NormalTok{checkSelfCollision}\OperatorTok{(}\NormalTok{req}\OperatorTok{,}\NormalTok{ res}\OperatorTok{,}\NormalTok{ state}\OperatorTok{);}
        \ControlFlowTok{if} \OperatorTok{(}\NormalTok{res}\OperatorTok{.}\NormalTok{collision}\OperatorTok{)} \OperatorTok{\{}
            \ControlFlowTok{return} \KeywordTok{false}\OperatorTok{;}
        \OperatorTok{\}}

        \CommentTok{// Check environment collision}
        \VariableTok{planning\_scene\_}\OperatorTok{{-}\textgreater{}}\NormalTok{checkCollision}\OperatorTok{(}\NormalTok{req}\OperatorTok{,}\NormalTok{ res}\OperatorTok{,}\NormalTok{ state}\OperatorTok{);}
        \ControlFlowTok{if} \OperatorTok{(}\NormalTok{res}\OperatorTok{.}\NormalTok{collision}\OperatorTok{)} \OperatorTok{\{}
            \ControlFlowTok{return} \KeywordTok{false}\OperatorTok{;}
        \OperatorTok{\}}

        \ControlFlowTok{return} \KeywordTok{true}\OperatorTok{;}
    \OperatorTok{\}}

\KeywordTok{private}\OperatorTok{:}
\NormalTok{    planning\_scene}\OperatorTok{::}\NormalTok{PlanningScenePtr }\VariableTok{planning\_scene\_}\OperatorTok{;}
\OperatorTok{\};}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{motion-planning-subsystem}{%
\subsection{5. Motion Planning
Subsystem}\label{motion-planning-subsystem}}

\hypertarget{moveit2-configuration}{%
\subsubsection{5.1 MoveIt2 Configuration}\label{moveit2-configuration}}

\textbf{Package:} \texttt{moveit\_config} \textbf{Files:} -
\texttt{config/ur5e.srdf} - Semantic Robot Description Format -
\texttt{config/ompl\_planning.yaml} - OMPL planner configuration -
\texttt{config/kinematics.yaml} - IK solver configuration -
\texttt{config/joint\_limits.yaml} - Joint velocity/acceleration limits

\hypertarget{ompl-planner-configuration}{%
\paragraph{5.1.1 OMPL Planner
Configuration}\label{ompl-planner-configuration}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# config/ompl\_planning.yaml}
\FunctionTok{planning\_plugin}\KeywordTok{:}\AttributeTok{ ompl\_interface/OMPLPlanner}
\FunctionTok{request\_adapters}\KeywordTok{: }\CharTok{\textgreater{}{-}}
\NormalTok{  default\_planner\_request\_adapters/AddTimeOptimalParameterization}
\NormalTok{  default\_planner\_request\_adapters/FixWorkspaceBounds}
\NormalTok{  default\_planner\_request\_adapters/FixStartStateBounds}
\NormalTok{  default\_planner\_request\_adapters/FixStartStateCollision}
\NormalTok{  default\_planner\_request\_adapters/FixStartStatePathConstraints}

\FunctionTok{start\_state\_max\_bounds\_error}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.1}

\FunctionTok{planner\_configs}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{RRTConnect}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{type}\KeywordTok{:}\AttributeTok{ geometric::RRTConnect}
\AttributeTok{    }\FunctionTok{range}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.0}\CommentTok{  \# Auto{-}detect}

\AttributeTok{  }\FunctionTok{RRTstar}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{type}\KeywordTok{:}\AttributeTok{ geometric::RRTstar}
\AttributeTok{    }\FunctionTok{range}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.0}
\AttributeTok{    }\FunctionTok{goal\_bias}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.05}
\AttributeTok{    }\FunctionTok{rewire\_factor}\KeywordTok{:}\AttributeTok{ }\FloatTok{1.1}

\AttributeTok{  }\FunctionTok{PRM}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{type}\KeywordTok{:}\AttributeTok{ geometric::PRM}
\AttributeTok{    }\FunctionTok{max\_nearest\_neighbors}\KeywordTok{:}\AttributeTok{ }\DecValTok{10}

\FunctionTok{manipulator}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{default\_planner\_config}\KeywordTok{:}\AttributeTok{ RRTConnect}
\AttributeTok{  }\FunctionTok{planner\_configs}\KeywordTok{:}
\AttributeTok{    }\KeywordTok{{-}}\AttributeTok{ RRTConnect}
\AttributeTok{    }\KeywordTok{{-}}\AttributeTok{ RRTstar}
\AttributeTok{    }\KeywordTok{{-}}\AttributeTok{ PRM}
\AttributeTok{  }\FunctionTok{projection\_evaluator}\KeywordTok{:}\AttributeTok{ joints(shoulder\_pan\_joint,shoulder\_lift\_joint,elbow\_joint)}
\AttributeTok{  }\FunctionTok{longest\_valid\_segment\_fraction}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.005}
\end{Highlighting}
\end{Shaded}

\hypertarget{kinematics-configuration}{%
\paragraph{5.1.2 Kinematics
Configuration}\label{kinematics-configuration}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# config/kinematics.yaml}
\FunctionTok{manipulator}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{kinematics\_solver}\KeywordTok{:}\AttributeTok{ kdl\_kinematics\_plugin/KDLKinematicsPlugin}
\AttributeTok{  }\FunctionTok{kinematics\_solver\_search\_resolution}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.005}
\AttributeTok{  }\FunctionTok{kinematics\_solver\_timeout}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.05}
\AttributeTok{  }\FunctionTok{kinematics\_solver\_attempts}\KeywordTok{:}\AttributeTok{ }\DecValTok{3}
\end{Highlighting}
\end{Shaded}

\hypertarget{motion-planning-action-server}{%
\subsubsection{5.2 Motion Planning Action
Server}\label{motion-planning-action-server}}

\textbf{Package:} \texttt{motion\_planning} \textbf{Action Name:}
\texttt{/plan\_and\_execute} \textbf{Action Type:}
\texttt{moveit\_msgs/action/MoveGroup}

\hypertarget{custom-action-definition}{%
\paragraph{5.2.1 Custom Action
Definition}\label{custom-action-definition}}

\begin{verbatim}
# robot_interfaces/action/PickPlace.action
# Goal
geometry_msgs/PoseStamped pick_pose
geometry_msgs/PoseStamped place_pose
float32 approach_distance  # Pre-grasp offset
float32 retreat_distance   # Post-grasp lift
---
# Result
bool success
string message
moveit_msgs/RobotTrajectory executed_trajectory
float32 execution_time
---
# Feedback
string status  # "planning_pick" | "executing_pick" | "planning_place" | "executing_place"
float32 progress  # 0.0 to 1.0
\end{verbatim}

\hypertarget{pick-and-place-server}{%
\paragraph{5.2.2 Pick and Place Server}\label{pick-and-place-server}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ PickPlaceServer }\OperatorTok{:} \KeywordTok{public}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{Node }\OperatorTok{\{}
\KeywordTok{public}\OperatorTok{:}
    \KeywordTok{using}\NormalTok{ PickPlace }\OperatorTok{=}\NormalTok{ robot\_interfaces}\OperatorTok{::}\NormalTok{action}\OperatorTok{::}\NormalTok{PickPlace}\OperatorTok{;}
    \KeywordTok{using}\NormalTok{ GoalHandle }\OperatorTok{=}\NormalTok{ rclcpp\_action}\OperatorTok{::}\NormalTok{ServerGoalHandle}\OperatorTok{\textless{}}\NormalTok{PickPlace}\OperatorTok{\textgreater{};}

\NormalTok{    PickPlaceServer}\OperatorTok{(}\AttributeTok{const}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{NodeOptions}\OperatorTok{\&}\NormalTok{ options}\OperatorTok{)}
        \OperatorTok{:}\NormalTok{ Node}\OperatorTok{(}\StringTok{"pick\_place\_server"}\OperatorTok{,}\NormalTok{ options}\OperatorTok{)} \OperatorTok{\{}

        \CommentTok{// MoveIt interface}
        \VariableTok{move\_group\_} \OperatorTok{=} \BuiltInTok{std::}\NormalTok{make\_shared}\OperatorTok{\textless{}}\NormalTok{moveit}\OperatorTok{::}\NormalTok{planning\_interface}\OperatorTok{::}\NormalTok{MoveGroupInterface}\OperatorTok{\textgreater{}(}
\NormalTok{            shared\_from\_this}\OperatorTok{(),} \StringTok{"manipulator"}\OperatorTok{);}

        \CommentTok{// Action server}
        \VariableTok{action\_server\_} \OperatorTok{=}\NormalTok{ rclcpp\_action}\OperatorTok{::}\NormalTok{create\_server}\OperatorTok{\textless{}}\NormalTok{PickPlace}\OperatorTok{\textgreater{}(}
            \KeywordTok{this}\OperatorTok{,} \StringTok{"pick\_place"}\OperatorTok{,}
            \BuiltInTok{std::}\NormalTok{bind}\OperatorTok{(\&}\NormalTok{PickPlaceServer}\OperatorTok{::}\NormalTok{handle\_goal}\OperatorTok{,} \KeywordTok{this}\OperatorTok{,}\NormalTok{ \_1}\OperatorTok{,}\NormalTok{ \_2}\OperatorTok{),}
            \BuiltInTok{std::}\NormalTok{bind}\OperatorTok{(\&}\NormalTok{PickPlaceServer}\OperatorTok{::}\NormalTok{handle\_cancel}\OperatorTok{,} \KeywordTok{this}\OperatorTok{,}\NormalTok{ \_1}\OperatorTok{),}
            \BuiltInTok{std::}\NormalTok{bind}\OperatorTok{(\&}\NormalTok{PickPlaceServer}\OperatorTok{::}\NormalTok{handle\_accepted}\OperatorTok{,} \KeywordTok{this}\OperatorTok{,}\NormalTok{ \_1}\OperatorTok{));}
    \OperatorTok{\}}

\KeywordTok{private}\OperatorTok{:}
    \DataTypeTok{void}\NormalTok{ execute}\OperatorTok{(}\AttributeTok{const} \BuiltInTok{std::}\NormalTok{shared\_ptr}\OperatorTok{\textless{}}\NormalTok{GoalHandle}\OperatorTok{\textgreater{}}\NormalTok{ goal\_handle}\OperatorTok{)} \OperatorTok{\{}
        \KeywordTok{auto}\NormalTok{ goal }\OperatorTok{=}\NormalTok{ goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{get\_goal}\OperatorTok{();}
        \KeywordTok{auto}\NormalTok{ result }\OperatorTok{=} \BuiltInTok{std::}\NormalTok{make\_shared}\OperatorTok{\textless{}}\NormalTok{PickPlace}\OperatorTok{::}\NormalTok{Result}\OperatorTok{\textgreater{}();}

        \CommentTok{// Feedback}
        \KeywordTok{auto}\NormalTok{ feedback }\OperatorTok{=} \BuiltInTok{std::}\NormalTok{make\_shared}\OperatorTok{\textless{}}\NormalTok{PickPlace}\OperatorTok{::}\NormalTok{Feedback}\OperatorTok{\textgreater{}();}

        \CommentTok{// Step 1: Plan pick motion}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{status }\OperatorTok{=} \StringTok{"planning\_pick"}\OperatorTok{;}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{progress }\OperatorTok{=} \FloatTok{0.1}\OperatorTok{;}
\NormalTok{        goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{publish\_feedback}\OperatorTok{(}\NormalTok{feedback}\OperatorTok{);}

\NormalTok{        moveit}\OperatorTok{::}\NormalTok{planning\_interface}\OperatorTok{::}\NormalTok{MoveGroupInterface}\OperatorTok{::}\NormalTok{Plan pick\_plan}\OperatorTok{;}
        \DataTypeTok{bool}\NormalTok{ pick\_success }\OperatorTok{=}\NormalTok{ planPick}\OperatorTok{(}\NormalTok{goal}\OperatorTok{{-}\textgreater{}}\NormalTok{pick\_pose}\OperatorTok{,}\NormalTok{ goal}\OperatorTok{{-}\textgreater{}}\NormalTok{approach\_distance}\OperatorTok{,}\NormalTok{ pick\_plan}\OperatorTok{);}

        \ControlFlowTok{if} \OperatorTok{(!}\NormalTok{pick\_success}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{            result}\OperatorTok{{-}\textgreater{}}\NormalTok{success }\OperatorTok{=} \KeywordTok{false}\OperatorTok{;}
\NormalTok{            result}\OperatorTok{{-}\textgreater{}}\NormalTok{message }\OperatorTok{=} \StringTok{"Pick planning failed"}\OperatorTok{;}
\NormalTok{            goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{abort}\OperatorTok{(}\NormalTok{result}\OperatorTok{);}
            \ControlFlowTok{return}\OperatorTok{;}
        \OperatorTok{\}}

        \CommentTok{// Step 2: Execute pick}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{status }\OperatorTok{=} \StringTok{"executing\_pick"}\OperatorTok{;}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{progress }\OperatorTok{=} \FloatTok{0.3}\OperatorTok{;}
\NormalTok{        goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{publish\_feedback}\OperatorTok{(}\NormalTok{feedback}\OperatorTok{);}

\NormalTok{        moveit}\OperatorTok{::}\NormalTok{core}\OperatorTok{::}\NormalTok{MoveItErrorCode exec\_result }\OperatorTok{=} \VariableTok{move\_group\_}\OperatorTok{{-}\textgreater{}}\NormalTok{execute}\OperatorTok{(}\NormalTok{pick\_plan}\OperatorTok{);}
        \ControlFlowTok{if} \OperatorTok{(}\NormalTok{exec\_result }\OperatorTok{!=}\NormalTok{ moveit}\OperatorTok{::}\NormalTok{core}\OperatorTok{::}\NormalTok{MoveItErrorCode}\OperatorTok{::}\NormalTok{SUCCESS}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{            result}\OperatorTok{{-}\textgreater{}}\NormalTok{success }\OperatorTok{=} \KeywordTok{false}\OperatorTok{;}
\NormalTok{            result}\OperatorTok{{-}\textgreater{}}\NormalTok{message }\OperatorTok{=} \StringTok{"Pick execution failed"}\OperatorTok{;}
\NormalTok{            goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{abort}\OperatorTok{(}\NormalTok{result}\OperatorTok{);}
            \ControlFlowTok{return}\OperatorTok{;}
        \OperatorTok{\}}

        \CommentTok{// Step 3: Close gripper (via action client to gripper controller)}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{progress }\OperatorTok{=} \FloatTok{0.5}\OperatorTok{;}
\NormalTok{        goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{publish\_feedback}\OperatorTok{(}\NormalTok{feedback}\OperatorTok{);}
\NormalTok{        closeGripper}\OperatorTok{(}\NormalTok{goal}\OperatorTok{{-}\textgreater{}}\NormalTok{pick\_pose}\OperatorTok{);}  \CommentTok{// Blocking call}

        \CommentTok{// Step 4: Retreat}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{progress }\OperatorTok{=} \FloatTok{0.6}\OperatorTok{;}
\NormalTok{        retreat}\OperatorTok{(}\NormalTok{goal}\OperatorTok{{-}\textgreater{}}\NormalTok{retreat\_distance}\OperatorTok{);}

        \CommentTok{// Step 5: Plan place motion}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{status }\OperatorTok{=} \StringTok{"planning\_place"}\OperatorTok{;}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{progress }\OperatorTok{=} \FloatTok{0.7}\OperatorTok{;}
\NormalTok{        goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{publish\_feedback}\OperatorTok{(}\NormalTok{feedback}\OperatorTok{);}

\NormalTok{        moveit}\OperatorTok{::}\NormalTok{planning\_interface}\OperatorTok{::}\NormalTok{MoveGroupInterface}\OperatorTok{::}\NormalTok{Plan place\_plan}\OperatorTok{;}
        \DataTypeTok{bool}\NormalTok{ place\_success }\OperatorTok{=}\NormalTok{ planPlace}\OperatorTok{(}\NormalTok{goal}\OperatorTok{{-}\textgreater{}}\NormalTok{place\_pose}\OperatorTok{,}\NormalTok{ place\_plan}\OperatorTok{);}

        \CommentTok{// Step 6: Execute place}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{status }\OperatorTok{=} \StringTok{"executing\_place"}\OperatorTok{;}
\NormalTok{        feedback}\OperatorTok{{-}\textgreater{}}\NormalTok{progress }\OperatorTok{=} \FloatTok{0.9}\OperatorTok{;}
\NormalTok{        goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{publish\_feedback}\OperatorTok{(}\NormalTok{feedback}\OperatorTok{);}

        \VariableTok{move\_group\_}\OperatorTok{{-}\textgreater{}}\NormalTok{execute}\OperatorTok{(}\NormalTok{place\_plan}\OperatorTok{);}

        \CommentTok{// Step 7: Open gripper}
\NormalTok{        openGripper}\OperatorTok{();}

        \CommentTok{// Success}
\NormalTok{        result}\OperatorTok{{-}\textgreater{}}\NormalTok{success }\OperatorTok{=} \KeywordTok{true}\OperatorTok{;}
\NormalTok{        result}\OperatorTok{{-}\textgreater{}}\NormalTok{message }\OperatorTok{=} \StringTok{"Pick and place completed"}\OperatorTok{;}
\NormalTok{        result}\OperatorTok{{-}\textgreater{}}\NormalTok{execution\_time }\OperatorTok{=} \CommentTok{/* compute duration */}\OperatorTok{;}
\NormalTok{        goal\_handle}\OperatorTok{{-}\textgreater{}}\NormalTok{succeed}\OperatorTok{(}\NormalTok{result}\OperatorTok{);}
    \OperatorTok{\}}

    \DataTypeTok{bool}\NormalTok{ planPick}\OperatorTok{(}\AttributeTok{const}\NormalTok{ geometry\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{PoseStamped}\OperatorTok{\&}\NormalTok{ target}\OperatorTok{,}
                  \DataTypeTok{double}\NormalTok{ approach\_distance}\OperatorTok{,}
\NormalTok{                  moveit}\OperatorTok{::}\NormalTok{planning\_interface}\OperatorTok{::}\NormalTok{MoveGroupInterface}\OperatorTok{::}\NormalTok{Plan}\OperatorTok{\&}\NormalTok{ plan}\OperatorTok{)} \OperatorTok{\{}
        \CommentTok{// Compute pre{-}grasp pose (offset along approach direction)}
\NormalTok{        geometry\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{PoseStamped pre\_grasp }\OperatorTok{=}\NormalTok{ target}\OperatorTok{;}
\NormalTok{        pre\_grasp}\OperatorTok{.}\NormalTok{pose}\OperatorTok{.}\NormalTok{position}\OperatorTok{.}\NormalTok{z }\OperatorTok{+=}\NormalTok{ approach\_distance}\OperatorTok{;}

        \CommentTok{// Plan to pre{-}grasp}
        \VariableTok{move\_group\_}\OperatorTok{{-}\textgreater{}}\NormalTok{setPoseTarget}\OperatorTok{(}\NormalTok{pre\_grasp}\OperatorTok{);}
        \DataTypeTok{bool}\NormalTok{ success }\OperatorTok{=} \OperatorTok{(}\VariableTok{move\_group\_}\OperatorTok{{-}\textgreater{}}\NormalTok{plan}\OperatorTok{(}\NormalTok{plan}\OperatorTok{)} \OperatorTok{==}\NormalTok{ moveit}\OperatorTok{::}\NormalTok{core}\OperatorTok{::}\NormalTok{MoveItErrorCode}\OperatorTok{::}\NormalTok{SUCCESS}\OperatorTok{);}

        \ControlFlowTok{if} \OperatorTok{(!}\NormalTok{success}\OperatorTok{)} \ControlFlowTok{return} \KeywordTok{false}\OperatorTok{;}

        \CommentTok{// Append Cartesian path from pre{-}grasp to grasp}
        \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\NormalTok{geometry\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{Pose}\OperatorTok{\textgreater{}}\NormalTok{ waypoints }\OperatorTok{=} \OperatorTok{\{}\NormalTok{target}\OperatorTok{.}\NormalTok{pose}\OperatorTok{\};}
\NormalTok{        moveit\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{RobotTrajectory cartesian\_traj}\OperatorTok{;}
        \DataTypeTok{double}\NormalTok{ fraction }\OperatorTok{=} \VariableTok{move\_group\_}\OperatorTok{{-}\textgreater{}}\NormalTok{computeCartesianPath}\OperatorTok{(}
\NormalTok{            waypoints}\OperatorTok{,} \FloatTok{0.01} \CommentTok{/* eef\_step */}\OperatorTok{,} \FloatTok{0.0} \CommentTok{/* jump\_threshold */}\OperatorTok{,}\NormalTok{ cartesian\_traj}\OperatorTok{);}

        \ControlFlowTok{if} \OperatorTok{(}\NormalTok{fraction }\OperatorTok{\textless{}} \FloatTok{0.95}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{            RCLCPP\_WARN}\OperatorTok{(}\NormalTok{get\_logger}\OperatorTok{(),} \StringTok{"Cartesian path only }\SpecialCharTok{\%.2f\%\%}\StringTok{ complete"}\OperatorTok{,}\NormalTok{ fraction }\OperatorTok{*} \DecValTok{100}\OperatorTok{);}
            \ControlFlowTok{return} \KeywordTok{false}\OperatorTok{;}
        \OperatorTok{\}}

        \CommentTok{// Merge trajectories}
        \CommentTok{// ... (trajectory merging logic)}

        \ControlFlowTok{return} \KeywordTok{true}\OperatorTok{;}
    \OperatorTok{\}}

\NormalTok{    moveit}\OperatorTok{::}\NormalTok{planning\_interface}\OperatorTok{::}\NormalTok{MoveGroupInterface}\OperatorTok{::}\NormalTok{SharedPtr }\VariableTok{move\_group\_}\OperatorTok{;}
\NormalTok{    rclcpp\_action}\OperatorTok{::}\NormalTok{Server}\OperatorTok{\textless{}}\NormalTok{PickPlace}\OperatorTok{\textgreater{}::}\NormalTok{SharedPtr }\VariableTok{action\_server\_}\OperatorTok{;}
\OperatorTok{\};}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{control-subsystem}{%
\subsection{6. Control Subsystem}\label{control-subsystem}}

\hypertarget{ros2_control-configuration}{%
\subsubsection{6.1 ros2\_control
Configuration}\label{ros2_control-configuration}}

\textbf{Package:} \texttt{control} \textbf{File:}
\texttt{config/ur5e\_controllers.yaml}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{controller\_manager}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{ros\_\_parameters}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{update\_rate}\KeywordTok{:}\AttributeTok{ }\DecValTok{1000}\CommentTok{  \# Hz (1 kHz control loop)}

\AttributeTok{    }\FunctionTok{joint\_state\_broadcaster}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{type}\KeywordTok{:}\AttributeTok{ joint\_state\_broadcaster/JointStateBroadcaster}

\AttributeTok{    }\FunctionTok{joint\_trajectory\_controller}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{type}\KeywordTok{:}\AttributeTok{ joint\_trajectory\_controller/JointTrajectoryController}

\AttributeTok{    }\FunctionTok{forward\_position\_controller}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{type}\KeywordTok{:}\AttributeTok{ forward\_command\_controller/ForwardCommandController}

\FunctionTok{joint\_trajectory\_controller}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{ros\_\_parameters}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{joints}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ shoulder\_pan\_joint}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ shoulder\_lift\_joint}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ elbow\_joint}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ wrist\_1\_joint}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ wrist\_2\_joint}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ wrist\_3\_joint}

\AttributeTok{    }\FunctionTok{command\_interfaces}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ position}

\AttributeTok{    }\FunctionTok{state\_interfaces}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ position}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ velocity}

\AttributeTok{    }\FunctionTok{state\_publish\_rate}\KeywordTok{:}\AttributeTok{ }\FloatTok{100.0}
\AttributeTok{    }\FunctionTok{action\_monitor\_rate}\KeywordTok{:}\AttributeTok{ }\FloatTok{20.0}

\AttributeTok{    }\FunctionTok{allow\_partial\_joints\_goal}\KeywordTok{:}\AttributeTok{ }\CharTok{false}
\AttributeTok{    }\FunctionTok{allow\_integration\_in\_goal\_trajectories}\KeywordTok{:}\AttributeTok{ }\CharTok{true}

\AttributeTok{    }\FunctionTok{constraints}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{stopped\_velocity\_tolerance}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.01}
\AttributeTok{      }\FunctionTok{goal\_time}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.5}
\AttributeTok{      }\FunctionTok{shoulder\_pan\_joint}\KeywordTok{:}
\AttributeTok{        }\FunctionTok{trajectory}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.05}
\AttributeTok{        }\FunctionTok{goal}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.01}
\CommentTok{      \# ... (similar for other joints)}
\end{Highlighting}
\end{Shaded}

\hypertarget{hardware-interface}{%
\subsubsection{6.2 Hardware Interface}\label{hardware-interface}}

\textbf{Package:} \texttt{hardware\_interface} \textbf{File:}
\texttt{src/ur\_hardware\_interface.cpp}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ URHardwareInterface }\OperatorTok{:} \KeywordTok{public}\NormalTok{ hardware\_interface}\OperatorTok{::}\NormalTok{SystemInterface }\OperatorTok{\{}
\KeywordTok{public}\OperatorTok{:}
\NormalTok{    hardware\_interface}\OperatorTok{::}\NormalTok{CallbackReturn on\_init}\OperatorTok{(}
        \AttributeTok{const}\NormalTok{ hardware\_interface}\OperatorTok{::}\NormalTok{HardwareInfo}\OperatorTok{\&}\NormalTok{ info}\OperatorTok{)} \KeywordTok{override} \OperatorTok{\{}

        \CommentTok{// Store hardware info}
        \VariableTok{info\_} \OperatorTok{=}\NormalTok{ info}\OperatorTok{;}

        \CommentTok{// Initialize joint states}
        \VariableTok{joint\_positions\_}\OperatorTok{.}\NormalTok{resize}\OperatorTok{(}\VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{.}\NormalTok{size}\OperatorTok{(),} \FloatTok{0.0}\OperatorTok{);}
        \VariableTok{joint\_velocities\_}\OperatorTok{.}\NormalTok{resize}\OperatorTok{(}\VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{.}\NormalTok{size}\OperatorTok{(),} \FloatTok{0.0}\OperatorTok{);}
        \VariableTok{joint\_efforts\_}\OperatorTok{.}\NormalTok{resize}\OperatorTok{(}\VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{.}\NormalTok{size}\OperatorTok{(),} \FloatTok{0.0}\OperatorTok{);}
        \VariableTok{joint\_position\_commands\_}\OperatorTok{.}\NormalTok{resize}\OperatorTok{(}\VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{.}\NormalTok{size}\OperatorTok{(),} \FloatTok{0.0}\OperatorTok{);}

        \CommentTok{// Connect to robot (TCP/IP socket)}
        \VariableTok{robot\_ip\_} \OperatorTok{=} \VariableTok{info\_}\OperatorTok{.}\NormalTok{hardware\_parameters}\OperatorTok{[}\StringTok{"robot\_ip"}\OperatorTok{];}
        \VariableTok{robot\_port\_} \OperatorTok{=} \BuiltInTok{std::}\NormalTok{stoi}\OperatorTok{(}\VariableTok{info\_}\OperatorTok{.}\NormalTok{hardware\_parameters}\OperatorTok{[}\StringTok{"robot\_port"}\OperatorTok{]);}

        \ControlFlowTok{return}\NormalTok{ hardware\_interface}\OperatorTok{::}\NormalTok{CallbackReturn}\OperatorTok{::}\NormalTok{SUCCESS}\OperatorTok{;}
    \OperatorTok{\}}

    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\NormalTok{hardware\_interface}\OperatorTok{::}\NormalTok{StateInterface}\OperatorTok{\textgreater{}}\NormalTok{ export\_state\_interfaces}\OperatorTok{()} \KeywordTok{override} \OperatorTok{\{}
        \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\NormalTok{hardware\_interface}\OperatorTok{::}\NormalTok{StateInterface}\OperatorTok{\textgreater{}}\NormalTok{ state\_interfaces}\OperatorTok{;}
        \ControlFlowTok{for} \OperatorTok{(}\DataTypeTok{size\_t}\NormalTok{ i }\OperatorTok{=} \DecValTok{0}\OperatorTok{;}\NormalTok{ i }\OperatorTok{\textless{}} \VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{.}\NormalTok{size}\OperatorTok{();} \OperatorTok{++}\NormalTok{i}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{            state\_interfaces}\OperatorTok{.}\NormalTok{emplace\_back}\OperatorTok{(}
                \VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{[}\NormalTok{i}\OperatorTok{].}\NormalTok{name}\OperatorTok{,}\NormalTok{ hardware\_interface}\OperatorTok{::}\NormalTok{HW\_IF\_POSITION}\OperatorTok{,} \OperatorTok{\&}\VariableTok{joint\_positions\_}\OperatorTok{[}\NormalTok{i}\OperatorTok{]);}
\NormalTok{            state\_interfaces}\OperatorTok{.}\NormalTok{emplace\_back}\OperatorTok{(}
                \VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{[}\NormalTok{i}\OperatorTok{].}\NormalTok{name}\OperatorTok{,}\NormalTok{ hardware\_interface}\OperatorTok{::}\NormalTok{HW\_IF\_VELOCITY}\OperatorTok{,} \OperatorTok{\&}\VariableTok{joint\_velocities\_}\OperatorTok{[}\NormalTok{i}\OperatorTok{]);}
\NormalTok{            state\_interfaces}\OperatorTok{.}\NormalTok{emplace\_back}\OperatorTok{(}
                \VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{[}\NormalTok{i}\OperatorTok{].}\NormalTok{name}\OperatorTok{,}\NormalTok{ hardware\_interface}\OperatorTok{::}\NormalTok{HW\_IF\_EFFORT}\OperatorTok{,} \OperatorTok{\&}\VariableTok{joint\_efforts\_}\OperatorTok{[}\NormalTok{i}\OperatorTok{]);}
        \OperatorTok{\}}
        \ControlFlowTok{return}\NormalTok{ state\_interfaces}\OperatorTok{;}
    \OperatorTok{\}}

    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\NormalTok{hardware\_interface}\OperatorTok{::}\NormalTok{CommandInterface}\OperatorTok{\textgreater{}}\NormalTok{ export\_command\_interfaces}\OperatorTok{()} \KeywordTok{override} \OperatorTok{\{}
        \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\NormalTok{hardware\_interface}\OperatorTok{::}\NormalTok{CommandInterface}\OperatorTok{\textgreater{}}\NormalTok{ command\_interfaces}\OperatorTok{;}
        \ControlFlowTok{for} \OperatorTok{(}\DataTypeTok{size\_t}\NormalTok{ i }\OperatorTok{=} \DecValTok{0}\OperatorTok{;}\NormalTok{ i }\OperatorTok{\textless{}} \VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{.}\NormalTok{size}\OperatorTok{();} \OperatorTok{++}\NormalTok{i}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{            command\_interfaces}\OperatorTok{.}\NormalTok{emplace\_back}\OperatorTok{(}
                \VariableTok{info\_}\OperatorTok{.}\NormalTok{joints}\OperatorTok{[}\NormalTok{i}\OperatorTok{].}\NormalTok{name}\OperatorTok{,}\NormalTok{ hardware\_interface}\OperatorTok{::}\NormalTok{HW\_IF\_POSITION}\OperatorTok{,}
                \OperatorTok{\&}\VariableTok{joint\_position\_commands\_}\OperatorTok{[}\NormalTok{i}\OperatorTok{]);}
        \OperatorTok{\}}
        \ControlFlowTok{return}\NormalTok{ command\_interfaces}\OperatorTok{;}
    \OperatorTok{\}}

\NormalTok{    hardware\_interface}\OperatorTok{::}\DataTypeTok{return\_type}\NormalTok{ read}\OperatorTok{(}
        \AttributeTok{const}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{Time}\OperatorTok{\&}\NormalTok{ time}\OperatorTok{,} \AttributeTok{const}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{Duration}\OperatorTok{\&}\NormalTok{ period}\OperatorTok{)} \KeywordTok{override} \OperatorTok{\{}

        \CommentTok{// Read actual joint positions from robot}
        \VariableTok{ur\_driver\_}\OperatorTok{{-}\textgreater{}}\NormalTok{readJointStates}\OperatorTok{(}\VariableTok{joint\_positions\_}\OperatorTok{,} \VariableTok{joint\_velocities\_}\OperatorTok{,} \VariableTok{joint\_efforts\_}\OperatorTok{);}

        \ControlFlowTok{return}\NormalTok{ hardware\_interface}\OperatorTok{::}\DataTypeTok{return\_type}\OperatorTok{::}\NormalTok{OK}\OperatorTok{;}
    \OperatorTok{\}}

\NormalTok{    hardware\_interface}\OperatorTok{::}\DataTypeTok{return\_type}\NormalTok{ write}\OperatorTok{(}
        \AttributeTok{const}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{Time}\OperatorTok{\&}\NormalTok{ time}\OperatorTok{,} \AttributeTok{const}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{Duration}\OperatorTok{\&}\NormalTok{ period}\OperatorTok{)} \KeywordTok{override} \OperatorTok{\{}

        \CommentTok{// Send joint position commands to robot}
        \VariableTok{ur\_driver\_}\OperatorTok{{-}\textgreater{}}\NormalTok{writeJointCommands}\OperatorTok{(}\VariableTok{joint\_position\_commands\_}\OperatorTok{);}

        \ControlFlowTok{return}\NormalTok{ hardware\_interface}\OperatorTok{::}\DataTypeTok{return\_type}\OperatorTok{::}\NormalTok{OK}\OperatorTok{;}
    \OperatorTok{\}}

\KeywordTok{private}\OperatorTok{:}
    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}} \VariableTok{joint\_positions\_}\OperatorTok{;}
    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}} \VariableTok{joint\_velocities\_}\OperatorTok{;}
    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}} \VariableTok{joint\_efforts\_}\OperatorTok{;}
    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}} \VariableTok{joint\_position\_commands\_}\OperatorTok{;}

    \BuiltInTok{std::}\NormalTok{unique\_ptr}\OperatorTok{\textless{}}\NormalTok{URDriver}\OperatorTok{\textgreater{}} \VariableTok{ur\_driver\_}\OperatorTok{;}
    \BuiltInTok{std::}\NormalTok{string }\VariableTok{robot\_ip\_}\OperatorTok{;}
    \DataTypeTok{int} \VariableTok{robot\_port\_}\OperatorTok{;}
\OperatorTok{\};}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{task-orchestration-subsystem}{%
\subsection{7. Task Orchestration
Subsystem}\label{task-orchestration-subsystem}}

\hypertarget{behavior-tree-design}{%
\subsubsection{7.1 Behavior Tree Design}\label{behavior-tree-design}}

\textbf{Package:} \texttt{task\_orchestration} \textbf{File:}
\texttt{behavior\_trees/pick\_place.xml}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\textless{}}\KeywordTok{root}\OtherTok{ main\_tree\_to\_execute=}\StringTok{"PickPlaceTree"}\NormalTok{\textgreater{}}
\NormalTok{    \textless{}}\KeywordTok{BehaviorTree}\OtherTok{ ID=}\StringTok{"PickPlaceTree"}\NormalTok{\textgreater{}}
\NormalTok{        \textless{}}\KeywordTok{Sequence}\OtherTok{ name=}\StringTok{"MainSequence"}\NormalTok{\textgreater{}}

            \CommentTok{\textless{}!{-}{-} Initialize {-}{-}\textgreater{}}
\NormalTok{            \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"InitializeSystem"}\NormalTok{ /\textgreater{}}

            \CommentTok{\textless{}!{-}{-} Main loop {-}{-}\textgreater{}}
\NormalTok{            \textless{}}\KeywordTok{RepeatUntilFailure}\OtherTok{ num\_cycles=}\StringTok{"1000"}\NormalTok{\textgreater{}}
\NormalTok{                \textless{}}\KeywordTok{Sequence}\OtherTok{ name=}\StringTok{"PickPlaceLoop"}\NormalTok{\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Wait for trigger {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Condition}\OtherTok{ ID=}\StringTok{"WaitForTrigger"}\NormalTok{ /\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Scan workspace {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"CaptureImage"}\NormalTok{ /\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Detect objects {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"DetectObjects"}\OtherTok{ output=}\StringTok{"\{detections\}"}\NormalTok{ /\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Check if objects found {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Condition}\OtherTok{ ID=}\StringTok{"ObjectsDetected"}\OtherTok{ objects=}\StringTok{"\{detections\}"}\NormalTok{ /\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Select object to pick {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"SelectObject"}
\OtherTok{                            objects=}\StringTok{"\{detections\}"}
\OtherTok{                            selected=}\StringTok{"\{target\_object\}"}\NormalTok{ /\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Estimate pose {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"EstimatePose"}
\OtherTok{                            object=}\StringTok{"\{target\_object\}"}
\OtherTok{                            pose=}\StringTok{"\{object\_pose\}"}\NormalTok{ /\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Plan grasp {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"PlanGrasp"}
\OtherTok{                            pose=}\StringTok{"\{object\_pose\}"}
\OtherTok{                            grasp=}\StringTok{"\{best\_grasp\}"}\NormalTok{ /\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Execute pick with retry {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{RetryUntilSuccessful}\OtherTok{ num\_attempts=}\StringTok{"3"}\NormalTok{\textgreater{}}
\NormalTok{                        \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"ExecutePick"}\OtherTok{ grasp=}\StringTok{"\{best\_grasp\}"}\NormalTok{ /\textgreater{}}
\NormalTok{                    \textless{}/}\KeywordTok{RetryUntilSuccessful}\NormalTok{\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Execute place {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"ExecutePlace"}\OtherTok{ target=}\StringTok{"\{place\_pose\}"}\NormalTok{ /\textgreater{}}

                    \CommentTok{\textless{}!{-}{-} Update metrics {-}{-}\textgreater{}}
\NormalTok{                    \textless{}}\KeywordTok{Action}\OtherTok{ ID=}\StringTok{"LogSuccess"}\NormalTok{ /\textgreater{}}

\NormalTok{                \textless{}/}\KeywordTok{Sequence}\NormalTok{\textgreater{}}
\NormalTok{            \textless{}/}\KeywordTok{RepeatUntilFailure}\NormalTok{\textgreater{}}

\NormalTok{        \textless{}/}\KeywordTok{Sequence}\NormalTok{\textgreater{}}
\NormalTok{    \textless{}/}\KeywordTok{BehaviorTree}\NormalTok{\textgreater{}}
\NormalTok{\textless{}/}\KeywordTok{root}\NormalTok{\textgreater{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{behavior-tree-node-implementations}{%
\subsubsection{7.2 Behavior Tree Node
Implementations}\label{behavior-tree-node-implementations}}

\hypertarget{detectobjects-action-node}{%
\paragraph{7.2.1 DetectObjects Action
Node}\label{detectobjects-action-node}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ DetectObjectsAction }\OperatorTok{:} \KeywordTok{public}\NormalTok{ BT}\OperatorTok{::}\NormalTok{SyncActionNode }\OperatorTok{\{}
\KeywordTok{public}\OperatorTok{:}
\NormalTok{    DetectObjectsAction}\OperatorTok{(}\AttributeTok{const} \BuiltInTok{std::}\NormalTok{string}\OperatorTok{\&}\NormalTok{ name}\OperatorTok{,} \AttributeTok{const}\NormalTok{ BT}\OperatorTok{::}\NormalTok{NodeConfiguration}\OperatorTok{\&}\NormalTok{ config}\OperatorTok{)}
        \OperatorTok{:}\NormalTok{ BT}\OperatorTok{::}\NormalTok{SyncActionNode}\OperatorTok{(}\NormalTok{name}\OperatorTok{,}\NormalTok{ config}\OperatorTok{)} \OperatorTok{\{}

        \CommentTok{// ROS2 node}
        \VariableTok{node\_} \OperatorTok{=}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{Node}\OperatorTok{::}\NormalTok{make\_shared}\OperatorTok{(}\StringTok{"detect\_objects\_bt\_node"}\OperatorTok{);}

        \CommentTok{// Service client}
        \VariableTok{client\_} \OperatorTok{=} \VariableTok{node\_}\OperatorTok{{-}\textgreater{}}\NormalTok{create\_client}\OperatorTok{\textless{}}\NormalTok{vision\_interfaces}\OperatorTok{::}\NormalTok{srv}\OperatorTok{::}\NormalTok{DetectObjects}\OperatorTok{\textgreater{}(}\StringTok{"/vision/detect\_objects"}\OperatorTok{);}
    \OperatorTok{\}}

    \AttributeTok{static}\NormalTok{ BT}\OperatorTok{::}\NormalTok{PortsList providedPorts}\OperatorTok{()} \OperatorTok{\{}
        \ControlFlowTok{return} \OperatorTok{\{}\NormalTok{ BT}\OperatorTok{::}\NormalTok{OutputPort}\OperatorTok{\textless{}}\BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\NormalTok{Detection}\OperatorTok{\textgreater{}\textgreater{}(}\StringTok{"output"}\OperatorTok{)} \OperatorTok{\};}
    \OperatorTok{\}}

\NormalTok{    BT}\OperatorTok{::}\NormalTok{NodeStatus tick}\OperatorTok{()} \KeywordTok{override} \OperatorTok{\{}
        \CommentTok{// Call vision service}
        \KeywordTok{auto}\NormalTok{ request }\OperatorTok{=} \BuiltInTok{std::}\NormalTok{make\_shared}\OperatorTok{\textless{}}\NormalTok{vision\_interfaces}\OperatorTok{::}\NormalTok{srv}\OperatorTok{::}\NormalTok{DetectObjects}\OperatorTok{::}\NormalTok{Request}\OperatorTok{\textgreater{}();}

        \ControlFlowTok{if} \OperatorTok{(!}\VariableTok{client\_}\OperatorTok{{-}\textgreater{}}\NormalTok{wait\_for\_service}\OperatorTok{(}\BuiltInTok{std::}\NormalTok{chrono::seconds}\OperatorTok{(}\DecValTok{1}\OperatorTok{)))} \OperatorTok{\{}
            \ControlFlowTok{return}\NormalTok{ BT}\OperatorTok{::}\NormalTok{NodeStatus}\OperatorTok{::}\NormalTok{FAILURE}\OperatorTok{;}
        \OperatorTok{\}}

        \KeywordTok{auto}\NormalTok{ future }\OperatorTok{=} \VariableTok{client\_}\OperatorTok{{-}\textgreater{}}\NormalTok{async\_send\_request}\OperatorTok{(}\NormalTok{request}\OperatorTok{);}

        \ControlFlowTok{if} \OperatorTok{(}\NormalTok{rclcpp}\OperatorTok{::}\NormalTok{spin\_until\_future\_complete}\OperatorTok{(}\VariableTok{node\_}\OperatorTok{,}\NormalTok{ future}\OperatorTok{)} \OperatorTok{!=}
\NormalTok{            rclcpp}\OperatorTok{::}\NormalTok{FutureReturnCode}\OperatorTok{::}\NormalTok{SUCCESS}\OperatorTok{)} \OperatorTok{\{}
            \ControlFlowTok{return}\NormalTok{ BT}\OperatorTok{::}\NormalTok{NodeStatus}\OperatorTok{::}\NormalTok{FAILURE}\OperatorTok{;}
        \OperatorTok{\}}

        \KeywordTok{auto}\NormalTok{ response }\OperatorTok{=}\NormalTok{ future}\OperatorTok{.}\NormalTok{get}\OperatorTok{();}

        \ControlFlowTok{if} \OperatorTok{(}\NormalTok{response}\OperatorTok{{-}\textgreater{}}\NormalTok{detections}\OperatorTok{.}\NormalTok{empty}\OperatorTok{())} \OperatorTok{\{}
            \ControlFlowTok{return}\NormalTok{ BT}\OperatorTok{::}\NormalTok{NodeStatus}\OperatorTok{::}\NormalTok{FAILURE}\OperatorTok{;}
        \OperatorTok{\}}

        \CommentTok{// Set output port}
\NormalTok{        setOutput}\OperatorTok{(}\StringTok{"output"}\OperatorTok{,}\NormalTok{ response}\OperatorTok{{-}\textgreater{}}\NormalTok{detections}\OperatorTok{);}

        \ControlFlowTok{return}\NormalTok{ BT}\OperatorTok{::}\NormalTok{NodeStatus}\OperatorTok{::}\NormalTok{SUCCESS}\OperatorTok{;}
    \OperatorTok{\}}

\KeywordTok{private}\OperatorTok{:}
\NormalTok{    rclcpp}\OperatorTok{::}\NormalTok{Node}\OperatorTok{::}\NormalTok{SharedPtr }\VariableTok{node\_}\OperatorTok{;}
\NormalTok{    rclcpp}\OperatorTok{::}\NormalTok{Client}\OperatorTok{\textless{}}\NormalTok{vision\_interfaces}\OperatorTok{::}\NormalTok{srv}\OperatorTok{::}\NormalTok{DetectObjects}\OperatorTok{\textgreater{}::}\NormalTok{SharedPtr }\VariableTok{client\_}\OperatorTok{;}
\OperatorTok{\};}
\end{Highlighting}
\end{Shaded}

\hypertarget{state-machine-alternative-to-bt}{%
\subsubsection{7.3 State Machine (Alternative to
BT)}\label{state-machine-alternative-to-bt}}

\textbf{Package:} \texttt{task\_orchestration} \textbf{File:}
\texttt{src/state\_machine.cpp}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{enum} \KeywordTok{class}\NormalTok{ SystemState }\OperatorTok{\{}
\NormalTok{    IDLE}\OperatorTok{,}
\NormalTok{    SCANNING}\OperatorTok{,}
\NormalTok{    DETECTING}\OperatorTok{,}
\NormalTok{    PLANNING\_GRASP}\OperatorTok{,}
\NormalTok{    EXECUTING\_PICK}\OperatorTok{,}
\NormalTok{    EXECUTING\_PLACE}\OperatorTok{,}
\NormalTok{    ERROR}\OperatorTok{,}
\NormalTok{    EMERGENCY\_STOP}
\OperatorTok{\};}

\KeywordTok{class}\NormalTok{ TaskStateMachine }\OperatorTok{:} \KeywordTok{public}\NormalTok{ rclcpp}\OperatorTok{::}\NormalTok{Node }\OperatorTok{\{}
\KeywordTok{public}\OperatorTok{:}
\NormalTok{    TaskStateMachine}\OperatorTok{()} \OperatorTok{:}\NormalTok{ Node}\OperatorTok{(}\StringTok{"task\_state\_machine"}\OperatorTok{),} \VariableTok{current\_state\_}\OperatorTok{(}\NormalTok{SystemState}\OperatorTok{::}\NormalTok{IDLE}\OperatorTok{)} \OperatorTok{\{}
        \CommentTok{// State transition timer}
        \VariableTok{timer\_} \OperatorTok{=}\NormalTok{ create\_wall\_timer}\OperatorTok{(}
            \BuiltInTok{std::}\NormalTok{chrono::milliseconds}\OperatorTok{(}\DecValTok{100}\OperatorTok{),}
            \BuiltInTok{std::}\NormalTok{bind}\OperatorTok{(\&}\NormalTok{TaskStateMachine}\OperatorTok{::}\NormalTok{update}\OperatorTok{,} \KeywordTok{this}\OperatorTok{));}
    \OperatorTok{\}}

    \DataTypeTok{void}\NormalTok{ update}\OperatorTok{()} \OperatorTok{\{}
        \ControlFlowTok{switch} \OperatorTok{(}\VariableTok{current\_state\_}\OperatorTok{)} \OperatorTok{\{}
            \ControlFlowTok{case}\NormalTok{ SystemState}\OperatorTok{::}\NormalTok{IDLE}\OperatorTok{:}
\NormalTok{                handleIdle}\OperatorTok{();}
                \ControlFlowTok{break}\OperatorTok{;}
            \ControlFlowTok{case}\NormalTok{ SystemState}\OperatorTok{::}\NormalTok{SCANNING}\OperatorTok{:}
\NormalTok{                handleScanning}\OperatorTok{();}
                \ControlFlowTok{break}\OperatorTok{;}
            \ControlFlowTok{case}\NormalTok{ SystemState}\OperatorTok{::}\NormalTok{DETECTING}\OperatorTok{:}
\NormalTok{                handleDetecting}\OperatorTok{();}
                \ControlFlowTok{break}\OperatorTok{;}
            \CommentTok{// ... (other states)}
        \OperatorTok{\}}
    \OperatorTok{\}}

    \DataTypeTok{void}\NormalTok{ handleIdle}\OperatorTok{()} \OperatorTok{\{}
        \ControlFlowTok{if} \OperatorTok{(}\VariableTok{trigger\_received\_}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{            transition}\OperatorTok{(}\NormalTok{SystemState}\OperatorTok{::}\NormalTok{SCANNING}\OperatorTok{);}
        \OperatorTok{\}}
    \OperatorTok{\}}

    \DataTypeTok{void}\NormalTok{ handleScanning}\OperatorTok{()} \OperatorTok{\{}
        \CommentTok{// Capture image}
        \KeywordTok{auto}\NormalTok{ future }\OperatorTok{=} \VariableTok{vision\_client\_}\OperatorTok{{-}\textgreater{}}\NormalTok{async\_send\_request}\OperatorTok{(}\CommentTok{/* request */}\OperatorTok{);}

        \CommentTok{// Wait for response (non{-}blocking)}
        \ControlFlowTok{if} \OperatorTok{(}\NormalTok{future}\OperatorTok{.}\NormalTok{wait\_for}\OperatorTok{(}\BuiltInTok{std::}\NormalTok{chrono::seconds}\OperatorTok{(}\DecValTok{0}\OperatorTok{))} \OperatorTok{==} \BuiltInTok{std::}\NormalTok{future\_status::ready}\OperatorTok{)} \OperatorTok{\{}
            \KeywordTok{auto}\NormalTok{ response }\OperatorTok{=}\NormalTok{ future}\OperatorTok{.}\NormalTok{get}\OperatorTok{();}
            \ControlFlowTok{if} \OperatorTok{(}\NormalTok{response}\OperatorTok{{-}\textgreater{}}\NormalTok{success}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{                transition}\OperatorTok{(}\NormalTok{SystemState}\OperatorTok{::}\NormalTok{DETECTING}\OperatorTok{);}
            \OperatorTok{\}} \ControlFlowTok{else} \OperatorTok{\{}
\NormalTok{                transition}\OperatorTok{(}\NormalTok{SystemState}\OperatorTok{::}\NormalTok{ERROR}\OperatorTok{);}
            \OperatorTok{\}}
        \OperatorTok{\}}
    \OperatorTok{\}}

    \DataTypeTok{void}\NormalTok{ transition}\OperatorTok{(}\NormalTok{SystemState new\_state}\OperatorTok{)} \OperatorTok{\{}
\NormalTok{        RCLCPP\_INFO}\OperatorTok{(}\NormalTok{get\_logger}\OperatorTok{(),} \StringTok{"State transition: }\SpecialCharTok{\%s}\StringTok{ {-}\textgreater{} }\SpecialCharTok{\%s}\StringTok{"}\OperatorTok{,}
\NormalTok{                    stateToString}\OperatorTok{(}\VariableTok{current\_state\_}\OperatorTok{).}\NormalTok{c\_str}\OperatorTok{(),}
\NormalTok{                    stateToString}\OperatorTok{(}\NormalTok{new\_state}\OperatorTok{).}\NormalTok{c\_str}\OperatorTok{());}
        \VariableTok{current\_state\_} \OperatorTok{=}\NormalTok{ new\_state}\OperatorTok{;}
\NormalTok{        publishState}\OperatorTok{();}
    \OperatorTok{\}}

    \DataTypeTok{void}\NormalTok{ publishState}\OperatorTok{()} \OperatorTok{\{}
\NormalTok{        std\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{String msg}\OperatorTok{;}
\NormalTok{        msg}\OperatorTok{.}\NormalTok{data }\OperatorTok{=}\NormalTok{ stateToString}\OperatorTok{(}\VariableTok{current\_state\_}\OperatorTok{);}
        \VariableTok{state\_pub\_}\OperatorTok{{-}\textgreater{}}\NormalTok{publish}\OperatorTok{(}\NormalTok{msg}\OperatorTok{);}
    \OperatorTok{\}}

    \BuiltInTok{std::}\NormalTok{string stateToString}\OperatorTok{(}\NormalTok{SystemState state}\OperatorTok{)} \OperatorTok{\{}
        \AttributeTok{static} \AttributeTok{const} \BuiltInTok{std::}\NormalTok{map}\OperatorTok{\textless{}}\NormalTok{SystemState}\OperatorTok{,} \BuiltInTok{std::}\NormalTok{string}\OperatorTok{\textgreater{}}\NormalTok{ state\_names }\OperatorTok{=} \OperatorTok{\{}
            \OperatorTok{\{}\NormalTok{SystemState}\OperatorTok{::}\NormalTok{IDLE}\OperatorTok{,} \StringTok{"IDLE"}\OperatorTok{\},}
            \OperatorTok{\{}\NormalTok{SystemState}\OperatorTok{::}\NormalTok{SCANNING}\OperatorTok{,} \StringTok{"SCANNING"}\OperatorTok{\},}
            \OperatorTok{\{}\NormalTok{SystemState}\OperatorTok{::}\NormalTok{DETECTING}\OperatorTok{,} \StringTok{"DETECTING"}\OperatorTok{\},}
            \CommentTok{// ...}
        \OperatorTok{\};}
        \ControlFlowTok{return}\NormalTok{ state\_names}\OperatorTok{.}\NormalTok{at}\OperatorTok{(}\NormalTok{state}\OperatorTok{);}
    \OperatorTok{\}}

\KeywordTok{private}\OperatorTok{:}
\NormalTok{    SystemState }\VariableTok{current\_state\_}\OperatorTok{;}
\NormalTok{    rclcpp}\OperatorTok{::}\NormalTok{TimerBase}\OperatorTok{::}\NormalTok{SharedPtr }\VariableTok{timer\_}\OperatorTok{;}
\NormalTok{    rclcpp}\OperatorTok{::}\NormalTok{Publisher}\OperatorTok{\textless{}}\NormalTok{std\_msgs}\OperatorTok{::}\NormalTok{msg}\OperatorTok{::}\NormalTok{String}\OperatorTok{\textgreater{}::}\NormalTok{SharedPtr }\VariableTok{state\_pub\_}\OperatorTok{;}
    \DataTypeTok{bool} \VariableTok{trigger\_received\_} \OperatorTok{=} \KeywordTok{false}\OperatorTok{;}
\OperatorTok{\};}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{monitoring-subsystem}{%
\subsection{8. Monitoring Subsystem}\label{monitoring-subsystem}}

\hypertarget{metrics-collector}{%
\subsubsection{8.1 Metrics Collector}\label{metrics-collector}}

\textbf{Package:} \texttt{monitoring} \textbf{Node Name:}
\texttt{metrics\_collector\_node}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ MetricsCollector(Node):}
    \KeywordTok{def} \FunctionTok{\_\_init\_\_}\NormalTok{(}\VariableTok{self}\NormalTok{):}
        \BuiltInTok{super}\NormalTok{().}\FunctionTok{\_\_init\_\_}\NormalTok{(}\StringTok{\textquotesingle{}metrics\_collector\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# Prometheus metrics}
        \VariableTok{self}\NormalTok{.pick\_success\_counter }\OperatorTok{=}\NormalTok{ Counter(}
            \StringTok{\textquotesingle{}pick\_success\_total\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Total successful picks\textquotesingle{}}\NormalTok{)}
        \VariableTok{self}\NormalTok{.pick\_failure\_counter }\OperatorTok{=}\NormalTok{ Counter(}
            \StringTok{\textquotesingle{}pick\_failure\_total\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Total failed picks\textquotesingle{}}\NormalTok{)}
        \VariableTok{self}\NormalTok{.cycle\_time\_histogram }\OperatorTok{=}\NormalTok{ Histogram(}
            \StringTok{\textquotesingle{}cycle\_time\_seconds\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Pick{-}place cycle time\textquotesingle{}}\NormalTok{)}
        \VariableTok{self}\NormalTok{.grasp\_quality\_gauge }\OperatorTok{=}\NormalTok{ Gauge(}
            \StringTok{\textquotesingle{}grasp\_quality\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Current grasp quality score\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# InfluxDB client}
        \VariableTok{self}\NormalTok{.influx\_client }\OperatorTok{=}\NormalTok{ InfluxDBClient(}
\NormalTok{            url}\OperatorTok{=}\VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}influxdb\_url\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}http://localhost:8086\textquotesingle{}}\NormalTok{).value,}
\NormalTok{            token}\OperatorTok{=}\VariableTok{self}\NormalTok{.declare\_parameter(}\StringTok{\textquotesingle{}influxdb\_token\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{).value,}
\NormalTok{            org}\OperatorTok{=}\StringTok{\textquotesingle{}robotics\textquotesingle{}}\NormalTok{)}
        \VariableTok{self}\NormalTok{.write\_api }\OperatorTok{=} \VariableTok{self}\NormalTok{.influx\_client.write\_api(write\_options}\OperatorTok{=}\NormalTok{SYNCHRONOUS)}

        \CommentTok{\# Subscribers}
        \VariableTok{self}\NormalTok{.create\_subscription(}
\NormalTok{            TaskStatus, }\StringTok{\textquotesingle{}/orchestrator/status\textquotesingle{}}\NormalTok{, }\VariableTok{self}\NormalTok{.status\_callback, }\DecValTok{10}\NormalTok{)}
        \VariableTok{self}\NormalTok{.create\_subscription(}
\NormalTok{            Grasp, }\StringTok{\textquotesingle{}/grasp/selected\textquotesingle{}}\NormalTok{, }\VariableTok{self}\NormalTok{.grasp\_callback, }\DecValTok{10}\NormalTok{)}

        \CommentTok{\# Start Prometheus HTTP server}
\NormalTok{        start\_http\_server(}\DecValTok{8000}\NormalTok{)}

        \VariableTok{self}\NormalTok{.cycle\_start\_time }\OperatorTok{=} \VariableTok{None}

    \KeywordTok{def}\NormalTok{ status\_callback(}\VariableTok{self}\NormalTok{, msg: TaskStatus):}
        \CommentTok{"""Track task status and cycle time."""}
        \ControlFlowTok{if}\NormalTok{ msg.state }\OperatorTok{==} \StringTok{"EXECUTING\_PICK"}\NormalTok{:}
            \VariableTok{self}\NormalTok{.cycle\_start\_time }\OperatorTok{=} \VariableTok{self}\NormalTok{.get\_clock().now()}

        \ControlFlowTok{elif}\NormalTok{ msg.state }\OperatorTok{==} \StringTok{"COMPLETED"}\NormalTok{:}
            \ControlFlowTok{if} \VariableTok{self}\NormalTok{.cycle\_start\_time:}
\NormalTok{                duration }\OperatorTok{=}\NormalTok{ (}\VariableTok{self}\NormalTok{.get\_clock().now() }\OperatorTok{{-}} \VariableTok{self}\NormalTok{.cycle\_start\_time).nanoseconds }\OperatorTok{/} \FloatTok{1e9}
                \VariableTok{self}\NormalTok{.cycle\_time\_histogram.observe(duration)}

                \CommentTok{\# Write to InfluxDB}
\NormalTok{                point }\OperatorTok{=}\NormalTok{ Point(}\StringTok{"cycle\_time"}\NormalTok{) }\OperatorTok{\textbackslash{}}
\NormalTok{                    .tag(}\StringTok{"robot\_id"}\NormalTok{, }\StringTok{"robot\_01"}\NormalTok{) }\OperatorTok{\textbackslash{}}
\NormalTok{                    .field(}\StringTok{"duration"}\NormalTok{, duration) }\OperatorTok{\textbackslash{}}
\NormalTok{                    .time(datetime.utcnow(), WritePrecision.NS)}
                \VariableTok{self}\NormalTok{.write\_api.write(bucket}\OperatorTok{=}\StringTok{"metrics"}\NormalTok{, record}\OperatorTok{=}\NormalTok{point)}

            \VariableTok{self}\NormalTok{.pick\_success\_counter.inc()}

        \ControlFlowTok{elif}\NormalTok{ msg.state }\OperatorTok{==} \StringTok{"ERROR"}\NormalTok{:}
            \VariableTok{self}\NormalTok{.pick\_failure\_counter.inc()}

    \KeywordTok{def}\NormalTok{ grasp\_callback(}\VariableTok{self}\NormalTok{, msg: Grasp):}
        \CommentTok{"""Track grasp quality."""}
        \VariableTok{self}\NormalTok{.grasp\_quality\_gauge.}\BuiltInTok{set}\NormalTok{(msg.quality)}
\end{Highlighting}
\end{Shaded}

\hypertarget{database-schema}{%
\subsubsection{8.2 Database Schema}\label{database-schema}}

\hypertarget{postgresql-schema-operational-data}{%
\paragraph{8.2.1 PostgreSQL Schema (Operational
Data)}\label{postgresql-schema-operational-data}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{{-}{-} Database: robotics\_db}

\CommentTok{{-}{-} Table: picks}
\KeywordTok{CREATE} \KeywordTok{TABLE}\NormalTok{ picks (}
    \KeywordTok{id}\NormalTok{ SERIAL }\KeywordTok{PRIMARY} \KeywordTok{KEY}\NormalTok{,}
    \DataTypeTok{timestamp} \DataTypeTok{TIMESTAMP} \KeywordTok{NOT} \KeywordTok{NULL} \KeywordTok{DEFAULT}\NormalTok{ NOW(),}
\NormalTok{    robot\_id }\DataTypeTok{VARCHAR}\NormalTok{(}\DecValTok{50}\NormalTok{) }\KeywordTok{NOT} \KeywordTok{NULL}\NormalTok{,}
\NormalTok{    object\_id }\DataTypeTok{VARCHAR}\NormalTok{(}\DecValTok{100}\NormalTok{),}
\NormalTok{    object\_class }\DataTypeTok{VARCHAR}\NormalTok{(}\DecValTok{50}\NormalTok{),}
\NormalTok{    pick\_pose JSONB,  }\CommentTok{{-}{-} \{x, y, z, qx, qy, qz, qw\}}
\NormalTok{    place\_pose JSONB,}
\NormalTok{    grasp\_quality }\DataTypeTok{FLOAT}\NormalTok{,}
\NormalTok{    cycle\_time }\DataTypeTok{FLOAT}\NormalTok{,  }\CommentTok{{-}{-} seconds}
\NormalTok{    success }\DataTypeTok{BOOLEAN}\NormalTok{,}
\NormalTok{    error\_code }\DataTypeTok{VARCHAR}\NormalTok{(}\DecValTok{100}\NormalTok{),}
\NormalTok{    error\_message TEXT}
\NormalTok{);}

\KeywordTok{CREATE} \KeywordTok{INDEX}\NormalTok{ idx\_picks\_timestamp }\KeywordTok{ON}\NormalTok{ picks(}\DataTypeTok{timestamp} \KeywordTok{DESC}\NormalTok{);}
\KeywordTok{CREATE} \KeywordTok{INDEX}\NormalTok{ idx\_picks\_robot\_id }\KeywordTok{ON}\NormalTok{ picks(robot\_id);}
\KeywordTok{CREATE} \KeywordTok{INDEX}\NormalTok{ idx\_picks\_success }\KeywordTok{ON}\NormalTok{ picks(success);}

\CommentTok{{-}{-} Table: system\_health}
\KeywordTok{CREATE} \KeywordTok{TABLE}\NormalTok{ system\_health (}
    \KeywordTok{id}\NormalTok{ SERIAL }\KeywordTok{PRIMARY} \KeywordTok{KEY}\NormalTok{,}
    \DataTypeTok{timestamp} \DataTypeTok{TIMESTAMP} \KeywordTok{NOT} \KeywordTok{NULL} \KeywordTok{DEFAULT}\NormalTok{ NOW(),}
\NormalTok{    robot\_id }\DataTypeTok{VARCHAR}\NormalTok{(}\DecValTok{50}\NormalTok{) }\KeywordTok{NOT} \KeywordTok{NULL}\NormalTok{,}
\NormalTok{    cpu\_percent }\DataTypeTok{FLOAT}\NormalTok{,}
\NormalTok{    memory\_percent }\DataTypeTok{FLOAT}\NormalTok{,}
\NormalTok{    disk\_percent }\DataTypeTok{FLOAT}\NormalTok{,}
\NormalTok{    gpu\_percent }\DataTypeTok{FLOAT}\NormalTok{,}
\NormalTok{    gpu\_memory\_mb }\DataTypeTok{FLOAT}\NormalTok{,}
\NormalTok{    temperature\_celsius }\DataTypeTok{FLOAT}
\NormalTok{);}

\CommentTok{{-}{-} Table: calibrations}
\KeywordTok{CREATE} \KeywordTok{TABLE}\NormalTok{ calibrations (}
    \KeywordTok{id}\NormalTok{ SERIAL }\KeywordTok{PRIMARY} \KeywordTok{KEY}\NormalTok{,}
    \DataTypeTok{timestamp} \DataTypeTok{TIMESTAMP} \KeywordTok{NOT} \KeywordTok{NULL} \KeywordTok{DEFAULT}\NormalTok{ NOW(),}
\NormalTok{    robot\_id }\DataTypeTok{VARCHAR}\NormalTok{(}\DecValTok{50}\NormalTok{) }\KeywordTok{NOT} \KeywordTok{NULL}\NormalTok{,}
\NormalTok{    calibration\_type }\DataTypeTok{VARCHAR}\NormalTok{(}\DecValTok{50}\NormalTok{),  }\CommentTok{{-}{-} \textquotesingle{}hand\_eye\textquotesingle{} | \textquotesingle{}tcp\textquotesingle{} | \textquotesingle{}workspace\textquotesingle{}}
    \KeywordTok{parameters}\NormalTok{ JSONB,}
\NormalTok{    reprojection\_error }\DataTypeTok{FLOAT}\NormalTok{,}
\NormalTok{    notes TEXT}
\NormalTok{);}
\end{Highlighting}
\end{Shaded}

\hypertarget{influxdb-schema-time-series-data}{%
\paragraph{8.2.2 InfluxDB Schema (Time-Series
Data)}\label{influxdb-schema-time-series-data}}

\begin{verbatim}
# Measurement: cycle_time
# Tags: robot_id, object_class
# Fields: duration (float, seconds)

# Measurement: joint_states
# Tags: robot_id, joint_name
# Fields: position (float, radians), velocity (float, rad/s), effort (float, Nm)

# Measurement: vision_latency
# Tags: robot_id, stage (detect | pose_estimate)
# Fields: latency_ms (float)

# Measurement: force_torque
# Tags: robot_id
# Fields: fx, fy, fz, tx, ty, tz (float, Newtons/Nm)
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{data-structures}{%
\subsection{9. Data Structures}\label{data-structures}}

\hypertarget{custom-ros2-messages}{%
\subsubsection{9.1 Custom ROS2 Messages}\label{custom-ros2-messages}}

\textbf{Package:} \texttt{robot\_msgs}

\hypertarget{objectdetection}{%
\paragraph{9.1.1 ObjectDetection}\label{objectdetection}}

\begin{verbatim}
# robot_msgs/msg/ObjectDetection.msg
std_msgs/Header header
string object_id
string class_name
float32 confidence
geometry_msgs/BoundingBox2D bbox
sensor_msgs/PointCloud2 pointcloud
\end{verbatim}

\hypertarget{graspcandidate}{%
\paragraph{9.1.2 GraspCandidate}\label{graspcandidate}}

\begin{verbatim}
# robot_msgs/msg/GraspCandidate.msg
geometry_msgs/PoseStamped pose
float32 quality            # [0, 1]
float32 gripper_width      # meters
float32 force              # Newtons
geometry_msgs/Vector3 approach_direction
float32[] grasp_matrix     # 6x6 wrench matrix (flattened)
\end{verbatim}

\hypertarget{taskstatus}{%
\paragraph{9.1.3 TaskStatus}\label{taskstatus}}

\begin{verbatim}
# robot_msgs/msg/TaskStatus.msg
std_msgs/Header header
string state               # IDLE | SCANNING | DETECTING | PLANNING | EXECUTING_PICK | EXECUTING_PLACE | ERROR
string message
float32 progress           # [0, 1]
int32 picks_completed
int32 picks_failed
float32 average_cycle_time
\end{verbatim}

\hypertarget{configuration-data-structures}{%
\subsubsection{9.2 Configuration Data
Structures}\label{configuration-data-structures}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Workspace configuration (config/workspace.yaml)}
\FunctionTok{workspace}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{pick\_zone}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{min}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\FloatTok{0.3}\KeywordTok{,}\AttributeTok{ }\FloatTok{{-}0.4}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.0}\KeywordTok{]}\CommentTok{   \# [x, y, z] in meters}
\AttributeTok{    }\FunctionTok{max}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\FloatTok{0.7}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.4}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.3}\KeywordTok{]}
\AttributeTok{  }\FunctionTok{place\_zone}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{min}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\FloatTok{{-}0.3}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.3}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.0}\KeywordTok{]}
\AttributeTok{    }\FunctionTok{max}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\FloatTok{0.1}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.7}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.3}\KeywordTok{]}
\AttributeTok{  }\FunctionTok{safety\_zone}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{type}\KeywordTok{:}\AttributeTok{ }\StringTok{"cylinder"}
\AttributeTok{    }\FunctionTok{center}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\FloatTok{0.0}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.0}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.0}\KeywordTok{]}
\AttributeTok{    }\FunctionTok{radius}\KeywordTok{:}\AttributeTok{ }\FloatTok{1.5}\CommentTok{  \# meters}
\AttributeTok{    }\FunctionTok{height}\KeywordTok{:}\AttributeTok{ }\FloatTok{2.0}

\FunctionTok{objects}\KeywordTok{:}
\AttributeTok{  }\KeywordTok{{-}}\AttributeTok{ }\FunctionTok{class\_name}\KeywordTok{:}\AttributeTok{ }\StringTok{"red\_cube"}
\AttributeTok{    }\FunctionTok{shape}\KeywordTok{:}\AttributeTok{ }\StringTok{"box"}
\AttributeTok{    }\FunctionTok{dimensions}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\FloatTok{0.05}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.05}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.05}\KeywordTok{]}\CommentTok{  \# [width, depth, height]}
\AttributeTok{    }\FunctionTok{weight}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.2}\CommentTok{  \# kg}
\AttributeTok{  }\KeywordTok{{-}}\AttributeTok{ }\FunctionTok{class\_name}\KeywordTok{:}\AttributeTok{ }\StringTok{"blue\_cylinder"}
\AttributeTok{    }\FunctionTok{shape}\KeywordTok{:}\AttributeTok{ }\StringTok{"cylinder"}
\AttributeTok{    }\FunctionTok{dimensions}\KeywordTok{:}\AttributeTok{ }\KeywordTok{[}\FloatTok{0.04}\KeywordTok{,}\AttributeTok{ }\FloatTok{0.08}\KeywordTok{]}\CommentTok{  \# [radius, height]}
\AttributeTok{    }\FunctionTok{weight}\KeywordTok{:}\AttributeTok{ }\FloatTok{0.15}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{algorithms}{%
\subsection{10. Algorithms}\label{algorithms}}

\hypertarget{inverse-kinematics-analytical-for-ur5e}{%
\subsubsection{10.1 Inverse Kinematics (Analytical for
UR5e)}\label{inverse-kinematics-analytical-for-ur5e}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ UR5eAnalyticalIK }\OperatorTok{\{}
\KeywordTok{public}\OperatorTok{:}
    \CommentTok{/**}
\CommentTok{     * Compute all IK solutions for a given target pose.}
\CommentTok{     *}
\CommentTok{     * }\AnnotationTok{@param}\CommentTok{ }\CommentVarTok{target\_pose}\CommentTok{ Target end{-}effector pose (4x4 homogeneous matrix)}
\CommentTok{     * }\AnnotationTok{@return}\CommentTok{ Vector of joint solutions (each 6 DOF)}
\CommentTok{     */}
    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\BuiltInTok{std::}\NormalTok{array}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{,} \DecValTok{6}\OperatorTok{\textgreater{}\textgreater{}}\NormalTok{ solve}\OperatorTok{(}\AttributeTok{const}\NormalTok{ Eigen}\OperatorTok{::}\NormalTok{Matrix4d}\OperatorTok{\&}\NormalTok{ target\_pose}\OperatorTok{)} \OperatorTok{\{}
        \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\BuiltInTok{std::}\NormalTok{array}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{,} \DecValTok{6}\OperatorTok{\textgreater{}\textgreater{}}\NormalTok{ solutions}\OperatorTok{;}

        \CommentTok{// DH parameters for UR5e}
        \AttributeTok{const} \DataTypeTok{double}\NormalTok{ d1 }\OperatorTok{=} \FloatTok{0.1625}\OperatorTok{;}
        \AttributeTok{const} \DataTypeTok{double}\NormalTok{ a2 }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{0.425}\OperatorTok{;}
        \AttributeTok{const} \DataTypeTok{double}\NormalTok{ a3 }\OperatorTok{=} \OperatorTok{{-}}\FloatTok{0.3922}\OperatorTok{;}
        \AttributeTok{const} \DataTypeTok{double}\NormalTok{ d4 }\OperatorTok{=} \FloatTok{0.1333}\OperatorTok{;}
        \AttributeTok{const} \DataTypeTok{double}\NormalTok{ d5 }\OperatorTok{=} \FloatTok{0.0997}\OperatorTok{;}
        \AttributeTok{const} \DataTypeTok{double}\NormalTok{ d6 }\OperatorTok{=} \FloatTok{0.0996}\OperatorTok{;}

        \CommentTok{// Extract target position and orientation}
\NormalTok{        Eigen}\OperatorTok{::}\NormalTok{Vector3d p\_target }\OperatorTok{=}\NormalTok{ target\_pose}\OperatorTok{.}\NormalTok{block}\OperatorTok{\textless{}}\DecValTok{3}\OperatorTok{,} \DecValTok{1}\OperatorTok{\textgreater{}(}\DecValTok{0}\OperatorTok{,} \DecValTok{3}\OperatorTok{);}
\NormalTok{        Eigen}\OperatorTok{::}\NormalTok{Matrix3d R\_target }\OperatorTok{=}\NormalTok{ target\_pose}\OperatorTok{.}\NormalTok{block}\OperatorTok{\textless{}}\DecValTok{3}\OperatorTok{,} \DecValTok{3}\OperatorTok{\textgreater{}(}\DecValTok{0}\OperatorTok{,} \DecValTok{0}\OperatorTok{);}

        \CommentTok{// Solve for theta1 (2 solutions)}
        \DataTypeTok{double}\NormalTok{ p05\_x }\OperatorTok{=}\NormalTok{ p\_target}\OperatorTok{.}\NormalTok{x}\OperatorTok{()} \OperatorTok{{-}}\NormalTok{ d6 }\OperatorTok{*}\NormalTok{ R\_target}\OperatorTok{(}\DecValTok{0}\OperatorTok{,} \DecValTok{2}\OperatorTok{);}
        \DataTypeTok{double}\NormalTok{ p05\_y }\OperatorTok{=}\NormalTok{ p\_target}\OperatorTok{.}\NormalTok{y}\OperatorTok{()} \OperatorTok{{-}}\NormalTok{ d6 }\OperatorTok{*}\NormalTok{ R\_target}\OperatorTok{(}\DecValTok{1}\OperatorTok{,} \DecValTok{2}\OperatorTok{);}

        \ControlFlowTok{for} \OperatorTok{(}\DataTypeTok{int}\NormalTok{ i }\OperatorTok{=} \DecValTok{0}\OperatorTok{;}\NormalTok{ i }\OperatorTok{\textless{}} \DecValTok{2}\OperatorTok{;} \OperatorTok{++}\NormalTok{i}\OperatorTok{)} \OperatorTok{\{}
            \DataTypeTok{double}\NormalTok{ theta1 }\OperatorTok{=} \BuiltInTok{std::}\NormalTok{atan2}\OperatorTok{(}\NormalTok{p05\_y}\OperatorTok{,}\NormalTok{ p05\_x}\OperatorTok{)} \OperatorTok{+} \BuiltInTok{std::}\NormalTok{acos}\OperatorTok{(}\NormalTok{d4 }\OperatorTok{/} \BuiltInTok{std::}\NormalTok{hypot}\OperatorTok{(}\NormalTok{p05\_x}\OperatorTok{,}\NormalTok{ p05\_y}\OperatorTok{));}
            \ControlFlowTok{if} \OperatorTok{(}\NormalTok{i }\OperatorTok{==} \DecValTok{1}\OperatorTok{)}\NormalTok{ theta1 }\OperatorTok{+=}\NormalTok{ M\_PI}\OperatorTok{;}

            \CommentTok{// Solve for theta5 (2 solutions per theta1)}
            \ControlFlowTok{for} \OperatorTok{(}\DataTypeTok{int}\NormalTok{ j }\OperatorTok{=} \DecValTok{0}\OperatorTok{;}\NormalTok{ j }\OperatorTok{\textless{}} \DecValTok{2}\OperatorTok{;} \OperatorTok{++}\NormalTok{j}\OperatorTok{)} \OperatorTok{\{}
                \DataTypeTok{double}\NormalTok{ theta5 }\OperatorTok{=} \BuiltInTok{std::}\NormalTok{acos}\OperatorTok{((}\NormalTok{p\_target}\OperatorTok{.}\NormalTok{x}\OperatorTok{()} \OperatorTok{*} \BuiltInTok{std::}\NormalTok{sin}\OperatorTok{(}\NormalTok{theta1}\OperatorTok{)} \OperatorTok{{-}}
\NormalTok{                                          p\_target}\OperatorTok{.}\NormalTok{y}\OperatorTok{()} \OperatorTok{*} \BuiltInTok{std::}\NormalTok{cos}\OperatorTok{(}\NormalTok{theta1}\OperatorTok{)} \OperatorTok{{-}}\NormalTok{ d4}\OperatorTok{)} \OperatorTok{/}\NormalTok{ d6}\OperatorTok{);}
                \ControlFlowTok{if} \OperatorTok{(}\NormalTok{j }\OperatorTok{==} \DecValTok{1}\OperatorTok{)}\NormalTok{ theta5 }\OperatorTok{=} \OperatorTok{{-}}\NormalTok{theta5}\OperatorTok{;}

                \CommentTok{// Solve for theta6}
                \DataTypeTok{double}\NormalTok{ theta6 }\OperatorTok{=} \CommentTok{/* ... */}\OperatorTok{;}

                \CommentTok{// Solve for theta2, theta3, theta4 (closed{-}form)}
                \CommentTok{// ... (full derivation omitted)}

                \BuiltInTok{std::}\NormalTok{array}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{,} \DecValTok{6}\OperatorTok{\textgreater{}}\NormalTok{ solution }\OperatorTok{=} \OperatorTok{\{}\NormalTok{theta1}\OperatorTok{,}\NormalTok{ theta2}\OperatorTok{,}\NormalTok{ theta3}\OperatorTok{,}\NormalTok{ theta4}\OperatorTok{,}\NormalTok{ theta5}\OperatorTok{,}\NormalTok{ theta6}\OperatorTok{\};}

                \CommentTok{// Validate solution (joint limits, workspace)}
                \ControlFlowTok{if} \OperatorTok{(}\NormalTok{isValid}\OperatorTok{(}\NormalTok{solution}\OperatorTok{))} \OperatorTok{\{}
\NormalTok{                    solutions}\OperatorTok{.}\NormalTok{push\_back}\OperatorTok{(}\NormalTok{solution}\OperatorTok{);}
                \OperatorTok{\}}
            \OperatorTok{\}}
        \OperatorTok{\}}

        \ControlFlowTok{return}\NormalTok{ solutions}\OperatorTok{;}  \CommentTok{// Up to 8 solutions}
    \OperatorTok{\}}

\KeywordTok{private}\OperatorTok{:}
    \DataTypeTok{bool}\NormalTok{ isValid}\OperatorTok{(}\AttributeTok{const} \BuiltInTok{std::}\NormalTok{array}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{,} \DecValTok{6}\OperatorTok{\textgreater{}\&}\NormalTok{ joints}\OperatorTok{)} \OperatorTok{\{}
        \CommentTok{// Check joint limits}
        \AttributeTok{const} \BuiltInTok{std::}\NormalTok{array}\OperatorTok{\textless{}}\BuiltInTok{std::}\NormalTok{pair}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{,} \DataTypeTok{double}\OperatorTok{\textgreater{},} \DecValTok{6}\OperatorTok{\textgreater{}}\NormalTok{ limits }\OperatorTok{=} \OperatorTok{\{}
            \OperatorTok{\{{-}}\DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{,} \DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{\},}  \CommentTok{// shoulder\_pan}
            \OperatorTok{\{{-}}\DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{,} \DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{\},}  \CommentTok{// shoulder\_lift}
            \OperatorTok{\{{-}}\NormalTok{M\_PI}\OperatorTok{,}\NormalTok{ M\_PI}\OperatorTok{\},}      \CommentTok{// elbow}
            \OperatorTok{\{{-}}\DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{,} \DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{\},}  \CommentTok{// wrist\_1}
            \OperatorTok{\{{-}}\DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{,} \DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{\},}  \CommentTok{// wrist\_2}
            \OperatorTok{\{{-}}\DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{,} \DecValTok{2}\OperatorTok{*}\NormalTok{M\_PI}\OperatorTok{\}}   \CommentTok{// wrist\_3}
        \OperatorTok{\};}

        \ControlFlowTok{for} \OperatorTok{(}\DataTypeTok{size\_t}\NormalTok{ i }\OperatorTok{=} \DecValTok{0}\OperatorTok{;}\NormalTok{ i }\OperatorTok{\textless{}} \DecValTok{6}\OperatorTok{;} \OperatorTok{++}\NormalTok{i}\OperatorTok{)} \OperatorTok{\{}
            \ControlFlowTok{if} \OperatorTok{(}\NormalTok{joints}\OperatorTok{[}\NormalTok{i}\OperatorTok{]} \OperatorTok{\textless{}}\NormalTok{ limits}\OperatorTok{[}\NormalTok{i}\OperatorTok{].}\NormalTok{first }\OperatorTok{||}\NormalTok{ joints}\OperatorTok{[}\NormalTok{i}\OperatorTok{]} \OperatorTok{\textgreater{}}\NormalTok{ limits}\OperatorTok{[}\NormalTok{i}\OperatorTok{].}\NormalTok{second}\OperatorTok{)} \OperatorTok{\{}
                \ControlFlowTok{return} \KeywordTok{false}\OperatorTok{;}
            \OperatorTok{\}}
        \OperatorTok{\}}
        \ControlFlowTok{return} \KeywordTok{true}\OperatorTok{;}
    \OperatorTok{\}}
\OperatorTok{\};}
\end{Highlighting}
\end{Shaded}

\hypertarget{trajectory-smoothing-cubic-spline}{%
\subsubsection{10.2 Trajectory Smoothing (Cubic
Spline)}\label{trajectory-smoothing-cubic-spline}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ smooth\_trajectory(waypoints: List[np.ndarray], dt: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.01}\NormalTok{) }\OperatorTok{{-}\textgreater{}}\NormalTok{ np.ndarray:}
    \CommentTok{"""}
\CommentTok{    Generate smooth trajectory using cubic splines.}

\CommentTok{    Args:}
\CommentTok{        waypoints: List of joint configurations (each 6 DOF)}
\CommentTok{        dt: Time step (seconds)}

\CommentTok{    Returns:}
\CommentTok{        Smoothed trajectory as (N, 6) array}
\CommentTok{    """}
\NormalTok{    n\_joints }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(waypoints[}\DecValTok{0}\NormalTok{])}
\NormalTok{    n\_waypoints }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(waypoints)}

    \CommentTok{\# Create time stamps for waypoints (assume unit spacing)}
\NormalTok{    t\_waypoints }\OperatorTok{=}\NormalTok{ np.arange(n\_waypoints)}

    \CommentTok{\# Interpolate each joint independently}
\NormalTok{    smooth\_traj }\OperatorTok{=}\NormalTok{ []}
    \ControlFlowTok{for}\NormalTok{ joint\_idx }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(n\_joints):}
\NormalTok{        joint\_waypoints }\OperatorTok{=}\NormalTok{ [wp[joint\_idx] }\ControlFlowTok{for}\NormalTok{ wp }\KeywordTok{in}\NormalTok{ waypoints]}

        \CommentTok{\# Cubic spline interpolation}
\NormalTok{        cs }\OperatorTok{=}\NormalTok{ CubicSpline(t\_waypoints, joint\_waypoints, bc\_type}\OperatorTok{=}\StringTok{\textquotesingle{}clamped\textquotesingle{}}\NormalTok{)}

        \CommentTok{\# Evaluate at fine time steps}
\NormalTok{        t\_fine }\OperatorTok{=}\NormalTok{ np.arange(}\DecValTok{0}\NormalTok{, n\_waypoints }\OperatorTok{{-}} \DecValTok{1}\NormalTok{, dt)}
\NormalTok{        joint\_traj }\OperatorTok{=}\NormalTok{ cs(t\_fine)}

\NormalTok{        smooth\_traj.append(joint\_traj)}

    \CommentTok{\# Transpose to (N, 6) shape}
    \ControlFlowTok{return}\NormalTok{ np.array(smooth\_traj).T}
\end{Highlighting}
\end{Shaded}

\hypertarget{force-closure-check}{%
\subsubsection{10.3 Force Closure Check}\label{force-closure-check}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ check\_force\_closure(contact\_points: np.ndarray,}
\NormalTok{                        normals: np.ndarray,}
\NormalTok{                        friction\_coeff: }\BuiltInTok{float} \OperatorTok{=} \FloatTok{0.5}\NormalTok{) }\OperatorTok{{-}\textgreater{}} \BuiltInTok{bool}\NormalTok{:}
    \CommentTok{"""}
\CommentTok{    Check if grasp achieves force closure.}

\CommentTok{    Args:}
\CommentTok{        contact\_points: (N, 3) array of contact point positions}
\CommentTok{        normals: (N, 3) array of contact normals}
\CommentTok{        friction\_coeff: Friction coefficient}

\CommentTok{    Returns:}
\CommentTok{        True if force closure is satisfied}
\CommentTok{    """}
\NormalTok{    n\_contacts }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(contact\_points)}

    \ControlFlowTok{if}\NormalTok{ n\_contacts }\OperatorTok{\textless{}} \DecValTok{4}\NormalTok{:}
        \ControlFlowTok{return} \VariableTok{False}  \CommentTok{\# Need at least 4 contacts for 3D force closure}

    \CommentTok{\# Build grasp matrix G (6 x 3N)}
    \CommentTok{\# Each contact contributes 3 columns (normal force + 2 tangential forces)}
\NormalTok{    G }\OperatorTok{=}\NormalTok{ []}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(n\_contacts):}
\NormalTok{        r }\OperatorTok{=}\NormalTok{ contact\_points[i]  }\CommentTok{\# Position vector}
\NormalTok{        n }\OperatorTok{=}\NormalTok{ normals[i]         }\CommentTok{\# Normal vector}

        \CommentTok{\# Tangent vectors (perpendicular to normal)}
\NormalTok{        t1 }\OperatorTok{=}\NormalTok{ np.array([}\OperatorTok{{-}}\NormalTok{n[}\DecValTok{1}\NormalTok{], n[}\DecValTok{0}\NormalTok{], }\DecValTok{0}\NormalTok{])}
\NormalTok{        t1 }\OperatorTok{/=}\NormalTok{ np.linalg.norm(t1)}
\NormalTok{        t2 }\OperatorTok{=}\NormalTok{ np.cross(n, t1)}

        \CommentTok{\# Force columns (normal + friction cone)}
        \ControlFlowTok{for}\NormalTok{ direction }\KeywordTok{in}\NormalTok{ [n, t1 }\OperatorTok{*}\NormalTok{ friction\_coeff, t2 }\OperatorTok{*}\NormalTok{ friction\_coeff]:}
\NormalTok{            force\_col }\OperatorTok{=}\NormalTok{ direction}
\NormalTok{            torque\_col }\OperatorTok{=}\NormalTok{ np.cross(r, direction)}
\NormalTok{            wrench\_col }\OperatorTok{=}\NormalTok{ np.hstack([force\_col, torque\_col])}
\NormalTok{            G.append(wrench\_col)}

\NormalTok{    G }\OperatorTok{=}\NormalTok{ np.array(G).T  }\CommentTok{\# Shape: (6, 3N)}

    \CommentTok{\# Check if G has full rank (rank = 6)}
\NormalTok{    rank }\OperatorTok{=}\NormalTok{ np.linalg.matrix\_rank(G)}

    \ControlFlowTok{return}\NormalTok{ rank }\OperatorTok{==} \DecValTok{6}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{ros2-node-specifications}{%
\subsection{11. ROS2 Node
Specifications}\label{ros2-node-specifications}}

\hypertarget{vision-pipeline-nodes}{%
\subsubsection{11.1 Vision Pipeline Nodes}\label{vision-pipeline-nodes}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1087}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1739}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1957}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1957}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1522}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1739}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Node}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Executable}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Topics (Pub)}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Topics (Sub)}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Services}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Parameters}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{realsense\_driver} & \texttt{camera\_driver} &
\texttt{/camera/color/image\_raw}\texttt{/camera/depth/image\_rect\_raw}\texttt{/camera/color/camera\_info}
& - & - & \texttt{width}, \texttt{height}, \texttt{fps},
\texttt{serial\_number} \\
\texttt{image\_processor} & \texttt{image\_preprocessor} &
\texttt{/vision/preprocessed/image} & \texttt{/camera/color/image\_raw}
& - & \texttt{denoise}, \texttt{enhance\_contrast} \\
\texttt{yolo\_detector} & \texttt{object\_detector} &
\texttt{/vision/detections}\texttt{/vision/debug/detections} &
\texttt{/vision/preprocessed/image} & - & \texttt{model\_path},
\texttt{confidence\_threshold}, \texttt{use\_tensorrt} \\
\texttt{pose\_estimator} & \texttt{pose\_estimator} &
\texttt{/vision/object\_poses}\texttt{/vision/object\_pointclouds} &
\texttt{/vision/detections}\texttt{/camera/depth/image\_rect\_raw}\texttt{/camera/depth/camera\_info}
& - & \texttt{method} (pca \textbar{} icp \textbar{} pvnet) \\
\end{longtable}

\hypertarget{grasp-planning-nodes}{%
\subsubsection{11.2 Grasp Planning Nodes}\label{grasp-planning-nodes}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1205}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1928}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2771}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2169}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1928}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Node}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Executable}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Services (Server)}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Topics (Sub)}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Parameters}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{grasp\_synthesizer} & \texttt{grasp\_planner} &
\texttt{/compute\_grasps} & \texttt{/vision/object\_poses} &
\texttt{num\_candidates}, \texttt{gripper\_max\_width} \\
\texttt{grasp\_evaluator} & \texttt{grasp\_ranker} &
\texttt{/rank\_grasps} & - & \texttt{quality\_metric} (ferrari\_canny
\textbar{} volume) \\
\end{longtable}

\hypertarget{motion-planning-nodes}{%
\subsubsection{11.3 Motion Planning Nodes}\label{motion-planning-nodes}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1220}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1951}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2683}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2195}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1951}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Node}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Executable}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Actions (Server)}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Topics (Pub)}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Parameters}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{pick\_place\_server} & \texttt{motion\_planner} &
\texttt{/pick\_place} & \texttt{/planned\_path} (visualization) &
\texttt{planner} (rrtconnect \textbar{} rrtstar) \\
\texttt{collision\_objects} & \texttt{scene\_manager} & - &
\texttt{/planning\_scene} & \texttt{workspace\_bounds} \\
\end{longtable}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{database-schema-1}{%
\subsection{12. Database Schema}\label{database-schema-1}}

(Covered in Section 8.2)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{api-specifications}{%
\subsection{13. API Specifications}\label{api-specifications}}

\hypertarget{rest-api-fastapi-backend}{%
\subsubsection{13.1 REST API (FastAPI
Backend)}\label{rest-api-fastapi-backend}}

\textbf{Base URL:} \texttt{http://localhost:8080/api/v1}

\hypertarget{endpoints}{%
\paragraph{13.1.1 Endpoints}\label{endpoints}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1600}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1867}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2267}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.2400}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 8\tabcolsep) * \real{0.1867}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Method}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Endpoint}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Description}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Request Body}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Response}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\texttt{GET} & \texttt{/system/status} & Get system status & - &
\texttt{\{"state":\ "IDLE",\ "uptime":\ 3600,\ "picks\_today":\ 120\}} \\
\texttt{POST} & \texttt{/system/start} & Start system & - &
\texttt{\{"success":\ true\}} \\
\texttt{POST} & \texttt{/system/stop} & Stop system & - &
\texttt{\{"success":\ true\}} \\
\texttt{POST} & \texttt{/system/estop} & Emergency stop & - &
\texttt{\{"success":\ true\}} \\
\texttt{GET} & \texttt{/picks} & Get pick history & Query:
\texttt{?limit=100\&offset=0} &
\texttt{{[}\{id,\ timestamp,\ success,\ ...\}{]}} \\
\texttt{GET} & \texttt{/picks/\{id\}} & Get pick details & - &
\texttt{\{id,\ object\_class,\ cycle\_time,\ ...\}} \\
\texttt{GET} & \texttt{/metrics} & Get metrics summary & - &
\texttt{\{success\_rate,\ avg\_cycle\_time,\ uptime\}} \\
\texttt{POST} & \texttt{/calibration/hand-eye} & Start calibration &
\texttt{\{"num\_poses":\ 10\}} &
\texttt{\{calibration\_id:\ "abc123"\}} \\
\texttt{GET} & \texttt{/config} & Get configuration & - &
\texttt{\{workspace,\ objects,\ ...\}} \\
\texttt{PUT} & \texttt{/config} & Update configuration &
\texttt{\{workspace:\ \{...\}\}} & \texttt{\{"success":\ true\}} \\
\end{longtable}

\hypertarget{fastapi-implementation}{%
\paragraph{13.1.2 FastAPI Implementation}\label{fastapi-implementation}}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ fastapi }\ImportTok{import}\NormalTok{ FastAPI, HTTPException}
\ImportTok{from}\NormalTok{ pydantic }\ImportTok{import}\NormalTok{ BaseModel}
\ImportTok{from}\NormalTok{ typing }\ImportTok{import}\NormalTok{ List, Optional}

\NormalTok{app }\OperatorTok{=}\NormalTok{ FastAPI(title}\OperatorTok{=}\StringTok{"Robot Control API"}\NormalTok{, version}\OperatorTok{=}\StringTok{"1.0.0"}\NormalTok{)}

\KeywordTok{class}\NormalTok{ SystemStatus(BaseModel):}
\NormalTok{    state: }\BuiltInTok{str}
\NormalTok{    uptime: }\BuiltInTok{float}
\NormalTok{    picks\_today: }\BuiltInTok{int}
\NormalTok{    success\_rate: }\BuiltInTok{float}

\KeywordTok{class}\NormalTok{ PickRecord(BaseModel):}
    \BuiltInTok{id}\NormalTok{: }\BuiltInTok{int}
\NormalTok{    timestamp: }\BuiltInTok{str}
\NormalTok{    object\_class: }\BuiltInTok{str}
\NormalTok{    cycle\_time: }\BuiltInTok{float}
\NormalTok{    success: }\BuiltInTok{bool}
\NormalTok{    error\_message: Optional[}\BuiltInTok{str}\NormalTok{] }\OperatorTok{=} \VariableTok{None}

\AttributeTok{@app.get}\NormalTok{(}\StringTok{"/api/v1/system/status"}\NormalTok{, response\_model}\OperatorTok{=}\NormalTok{SystemStatus)}
\ControlFlowTok{async} \KeywordTok{def}\NormalTok{ get\_system\_status():}
    \CommentTok{"""Get current system status."""}
    \CommentTok{\# Query database or ROS2 topic}
\NormalTok{    status }\OperatorTok{=}\NormalTok{ query\_system\_status()}
    \ControlFlowTok{return}\NormalTok{ SystemStatus(}\OperatorTok{**}\NormalTok{status)}

\AttributeTok{@app.post}\NormalTok{(}\StringTok{"/api/v1/system/start"}\NormalTok{)}
\ControlFlowTok{async} \KeywordTok{def}\NormalTok{ start\_system():}
    \CommentTok{"""Start the robotic system."""}
    \CommentTok{\# Publish ROS2 message to start system}
\NormalTok{    success }\OperatorTok{=}\NormalTok{ publish\_ros\_command(}\StringTok{"START"}\NormalTok{)}
    \ControlFlowTok{if} \KeywordTok{not}\NormalTok{ success:}
        \ControlFlowTok{raise}\NormalTok{ HTTPException(status\_code}\OperatorTok{=}\DecValTok{500}\NormalTok{, detail}\OperatorTok{=}\StringTok{"Failed to start system"}\NormalTok{)}
    \ControlFlowTok{return}\NormalTok{ \{}\StringTok{"success"}\NormalTok{: }\VariableTok{True}\NormalTok{\}}

\AttributeTok{@app.get}\NormalTok{(}\StringTok{"/api/v1/picks"}\NormalTok{, response\_model}\OperatorTok{=}\NormalTok{List[PickRecord])}
\ControlFlowTok{async} \KeywordTok{def}\NormalTok{ get\_picks(limit: }\BuiltInTok{int} \OperatorTok{=} \DecValTok{100}\NormalTok{, offset: }\BuiltInTok{int} \OperatorTok{=} \DecValTok{0}\NormalTok{):}
    \CommentTok{"""Get pick history with pagination."""}
\NormalTok{    picks }\OperatorTok{=}\NormalTok{ query\_database(}
        \StringTok{"SELECT * FROM picks ORDER BY timestamp DESC LIMIT }\SpecialCharTok{\%s}\StringTok{ OFFSET }\SpecialCharTok{\%s}\StringTok{"}\NormalTok{,}
\NormalTok{        (limit, offset))}
    \ControlFlowTok{return}\NormalTok{ [PickRecord(}\OperatorTok{**}\NormalTok{p) }\ControlFlowTok{for}\NormalTok{ p }\KeywordTok{in}\NormalTok{ picks]}
\end{Highlighting}
\end{Shaded}

\hypertarget{grpc-api-performance-critical-operations}{%
\subsubsection{13.2 gRPC API (Performance-Critical
Operations)}\label{grpc-api-performance-critical-operations}}

\textbf{Proto File:}
\texttt{robot\_interfaces/proto/robot\_control.proto}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{syntax = }\StringTok{"proto3"}\NormalTok{;}

\KeywordTok{package}\NormalTok{ robot\_control;}

\NormalTok{service RobotController \{}
\NormalTok{    rpc GetJointStates(Empty) returns (JointStates);}
\NormalTok{    rpc MoveJoints(JointPositions) returns (MoveResponse);}
\NormalTok{    rpc ExecuteGrasp(GraspPose) returns (GraspResponse);}
\NormalTok{    rpc StreamMetrics(Empty) returns (stream Metrics);}
\NormalTok{\}}

\KeywordTok{message}\NormalTok{ JointStates \{}
    \KeywordTok{repeated} \DataTypeTok{double}\NormalTok{ positions = }\DecValTok{1}\NormalTok{;  }\CommentTok{// 6 DOF}
    \KeywordTok{repeated} \DataTypeTok{double}\NormalTok{ velocities = }\DecValTok{2}\NormalTok{;}
    \KeywordTok{repeated} \DataTypeTok{double}\NormalTok{ efforts = }\DecValTok{3}\NormalTok{;}
    \DataTypeTok{int64}\NormalTok{ timestamp = }\DecValTok{4}\NormalTok{;}
\NormalTok{\}}

\KeywordTok{message}\NormalTok{ JointPositions \{}
    \KeywordTok{repeated} \DataTypeTok{double}\NormalTok{ positions = }\DecValTok{1}\NormalTok{;}
    \DataTypeTok{double}\NormalTok{ max\_velocity = }\DecValTok{2}\NormalTok{;}
    \DataTypeTok{double}\NormalTok{ max\_acceleration = }\DecValTok{3}\NormalTok{;}
\NormalTok{\}}

\KeywordTok{message}\NormalTok{ MoveResponse \{}
    \DataTypeTok{bool}\NormalTok{ success = }\DecValTok{1}\NormalTok{;}
    \DataTypeTok{string} \KeywordTok{message}\NormalTok{ = }\DecValTok{2}\NormalTok{;}
    \DataTypeTok{double}\NormalTok{ execution\_time = }\DecValTok{3}\NormalTok{;}
\NormalTok{\}}

\KeywordTok{message}\NormalTok{ Metrics \{}
    \DataTypeTok{double}\NormalTok{ cycle\_time = }\DecValTok{1}\NormalTok{;}
    \DataTypeTok{double}\NormalTok{ success\_rate = }\DecValTok{2}\NormalTok{;}
    \DataTypeTok{int32}\NormalTok{ picks\_today = }\DecValTok{3}\NormalTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{state-machines}{%
\subsection{14. State Machines}\label{state-machines}}

(Covered in Section 7.3)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{error-handling}{%
\subsection{15. Error Handling}\label{error-handling}}

\hypertarget{error-hierarchy}{%
\subsubsection{15.1 Error Hierarchy}\label{error-hierarchy}}

\begin{verbatim}
RobotError
├── VisionError
│   ├── CameraConnectionError
│   ├── ObjectNotDetectedError
│   └── PoseEstimationError
├── PlanningError
│   ├── IKFailureError
│   ├── CollisionError
│   └── PathPlanningTimeoutError
├── ExecutionError
│   ├── TrajectoryExecutionError
│   ├── GraspFailureError
│   └── ControllerError
├── HardwareError
│   ├── RobotCommunicationError
│   ├── GripperError
│   └── SensorError
└── SafetyError
    ├── CollisionDetectedError
    ├── ForceExceededError
    └── EmergencyStopError
\end{verbatim}

\hypertarget{error-recovery-strategies}{%
\subsubsection{15.2 Error Recovery
Strategies}\label{error-recovery-strategies}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ ErrorRecovery:}
    \CommentTok{"""Centralized error recovery manager."""}

    \KeywordTok{def}\NormalTok{ handle\_error(}\VariableTok{self}\NormalTok{, error: RobotError) }\OperatorTok{{-}\textgreater{}} \BuiltInTok{bool}\NormalTok{:}
        \CommentTok{"""}
\CommentTok{        Handle error with appropriate recovery strategy.}

\CommentTok{        Returns:}
\CommentTok{            True if recovery successful, False otherwise}
\CommentTok{        """}
        \ControlFlowTok{if} \BuiltInTok{isinstance}\NormalTok{(error, GraspFailureError):}
            \ControlFlowTok{return} \VariableTok{self}\NormalTok{.retry\_grasp\_with\_adjustment()}

        \ControlFlowTok{elif} \BuiltInTok{isinstance}\NormalTok{(error, ObjectNotDetectedError):}
            \ControlFlowTok{return} \VariableTok{self}\NormalTok{.adjust\_lighting\_and\_retry()}

        \ControlFlowTok{elif} \BuiltInTok{isinstance}\NormalTok{(error, IKFailureError):}
            \ControlFlowTok{return} \VariableTok{self}\NormalTok{.replan\_with\_different\_approach()}

        \ControlFlowTok{elif} \BuiltInTok{isinstance}\NormalTok{(error, SafetyError):}
            \VariableTok{self}\NormalTok{.emergency\_stop()}
            \ControlFlowTok{return} \VariableTok{False}

        \ControlFlowTok{else}\NormalTok{:}
            \VariableTok{self}\NormalTok{.log\_error(error)}
            \ControlFlowTok{return} \VariableTok{False}

    \KeywordTok{def}\NormalTok{ retry\_grasp\_with\_adjustment(}\VariableTok{self}\NormalTok{) }\OperatorTok{{-}\textgreater{}} \BuiltInTok{bool}\NormalTok{:}
        \CommentTok{"""Retry grasp with increased force or different approach."""}
        \ControlFlowTok{for}\NormalTok{ attempt }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\DecValTok{3}\NormalTok{):}
            \CommentTok{\# Increase force by 10\%}
\NormalTok{            force }\OperatorTok{=} \VariableTok{self}\NormalTok{.current\_grasp.force }\OperatorTok{*} \FloatTok{1.1}

            \CommentTok{\# Retry}
\NormalTok{            success }\OperatorTok{=} \VariableTok{self}\NormalTok{.execute\_grasp(force}\OperatorTok{=}\NormalTok{force)}
            \ControlFlowTok{if}\NormalTok{ success:}
                \ControlFlowTok{return} \VariableTok{True}

        \ControlFlowTok{return} \VariableTok{False}
\end{Highlighting}
\end{Shaded}

\hypertarget{logging-and-alerting}{%
\subsubsection{15.3 Logging and Alerting}\label{logging-and-alerting}}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ logging}
\ImportTok{from}\NormalTok{ logging.handlers }\ImportTok{import}\NormalTok{ RotatingFileHandler}

\CommentTok{\# Configure logging}
\NormalTok{logger }\OperatorTok{=}\NormalTok{ logging.getLogger(}\StringTok{\textquotesingle{}robot\_system\textquotesingle{}}\NormalTok{)}
\NormalTok{logger.setLevel(logging.DEBUG)}

\CommentTok{\# File handler (rotating, max 10 MB, keep 5 backups)}
\NormalTok{fh }\OperatorTok{=}\NormalTok{ RotatingFileHandler(}
    \StringTok{\textquotesingle{}/var/log/robot/system.log\textquotesingle{}}\NormalTok{, maxBytes}\OperatorTok{=}\DecValTok{10}\OperatorTok{*}\DecValTok{1024}\OperatorTok{*}\DecValTok{1024}\NormalTok{, backupCount}\OperatorTok{=}\DecValTok{5}\NormalTok{)}
\NormalTok{fh.setLevel(logging.DEBUG)}

\CommentTok{\# Console handler}
\NormalTok{ch }\OperatorTok{=}\NormalTok{ logging.StreamHandler()}
\NormalTok{ch.setLevel(logging.INFO)}

\CommentTok{\# Formatter}
\NormalTok{formatter }\OperatorTok{=}\NormalTok{ logging.Formatter(}
    \StringTok{\textquotesingle{}}\SpecialCharTok{\%(asctime)s}\StringTok{ {-} }\SpecialCharTok{\%(name)s}\StringTok{ {-} }\SpecialCharTok{\%(levelname)s}\StringTok{ {-} }\SpecialCharTok{\%(message)s}\StringTok{\textquotesingle{}}\NormalTok{)}
\NormalTok{fh.setFormatter(formatter)}
\NormalTok{ch.setFormatter(formatter)}

\NormalTok{logger.addHandler(fh)}
\NormalTok{logger.addHandler(ch)}

\CommentTok{\# Usage}
\NormalTok{logger.info(}\StringTok{"System started"}\NormalTok{)}
\NormalTok{logger.warning(}\StringTok{"Object detection confidence low: 0.45"}\NormalTok{)}
\NormalTok{logger.error(}\StringTok{"Grasp execution failed"}\NormalTok{, exc\_info}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\NormalTok{logger.critical(}\StringTok{"Safety limit exceeded: Force = 200N"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{performance-optimization-1}{%
\subsection{16. Performance
Optimization}\label{performance-optimization-1}}

\hypertarget{latency-budget}{%
\subsubsection{16.1 Latency Budget}\label{latency-budget}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.2885}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3654}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3462}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Component}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Target Latency}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Optimization}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\textbf{Image Capture} & \textless10 ms & Hardware trigger,
pre-allocated buffers \\
\textbf{Object Detection} & \textless50 ms & TensorRT FP16, batch
inference \\
\textbf{Pose Estimation} & \textless30 ms & GPU-accelerated PCA,
downsampled point cloud \\
\textbf{Grasp Planning} & \textless200 ms & Cached grasp database,
parallel candidate evaluation \\
\textbf{Motion Planning} & \textless300 ms & RRT* with early
termination, warm-start IK \\
\textbf{Trajectory Execution} & \textless1000 ms & Time-optimal
parameterization \\
\textbf{Total Cycle Time} & \textless2000 ms & \textbf{Achieved: 1620
ms} \\
\end{longtable}

\hypertarget{cpugpu-optimization}{%
\subsubsection{16.2 CPU/GPU Optimization}\label{cpugpu-optimization}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{// CUDA kernel for parallel grasp quality evaluation}
\NormalTok{\_\_global\_\_ }\DataTypeTok{void}\NormalTok{ evaluateGraspsKernel}\OperatorTok{(}
    \AttributeTok{const}\NormalTok{ Grasp}\OperatorTok{*}\NormalTok{ grasps}\OperatorTok{,} \DataTypeTok{float}\OperatorTok{*}\NormalTok{ qualities}\OperatorTok{,} \DataTypeTok{int}\NormalTok{ n\_grasps}\OperatorTok{)} \OperatorTok{\{}

    \DataTypeTok{int}\NormalTok{ idx }\OperatorTok{=}\NormalTok{ blockIdx}\OperatorTok{.}\NormalTok{x }\OperatorTok{*}\NormalTok{ blockDim}\OperatorTok{.}\NormalTok{x }\OperatorTok{+}\NormalTok{ threadIdx}\OperatorTok{.}\NormalTok{x}\OperatorTok{;}
    \ControlFlowTok{if} \OperatorTok{(}\NormalTok{idx }\OperatorTok{\textgreater{}=}\NormalTok{ n\_grasps}\OperatorTok{)} \ControlFlowTok{return}\OperatorTok{;}

    \CommentTok{// Compute grasp quality metric in parallel}
\NormalTok{    qualities}\OperatorTok{[}\NormalTok{idx}\OperatorTok{]} \OperatorTok{=}\NormalTok{ computeFerrariCanny}\OperatorTok{(}\NormalTok{grasps}\OperatorTok{[}\NormalTok{idx}\OperatorTok{]);}
\OperatorTok{\}}

\DataTypeTok{void}\NormalTok{ evaluateGraspsParallel}\OperatorTok{(}
    \AttributeTok{const} \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\NormalTok{Grasp}\OperatorTok{\textgreater{}\&}\NormalTok{ grasps}\OperatorTok{,} \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{float}\OperatorTok{\textgreater{}\&}\NormalTok{ qualities}\OperatorTok{)} \OperatorTok{\{}

    \DataTypeTok{int}\NormalTok{ n }\OperatorTok{=}\NormalTok{ grasps}\OperatorTok{.}\NormalTok{size}\OperatorTok{();}

    \CommentTok{// Allocate device memory}
\NormalTok{    Grasp}\OperatorTok{*}\NormalTok{ d\_grasps}\OperatorTok{;}
    \DataTypeTok{float}\OperatorTok{*}\NormalTok{ d\_qualities}\OperatorTok{;}
\NormalTok{    cudaMalloc}\OperatorTok{(\&}\NormalTok{d\_grasps}\OperatorTok{,}\NormalTok{ n }\OperatorTok{*} \KeywordTok{sizeof}\OperatorTok{(}\NormalTok{Grasp}\OperatorTok{));}
\NormalTok{    cudaMalloc}\OperatorTok{(\&}\NormalTok{d\_qualities}\OperatorTok{,}\NormalTok{ n }\OperatorTok{*} \KeywordTok{sizeof}\OperatorTok{(}\DataTypeTok{float}\OperatorTok{));}

    \CommentTok{// Copy to device}
\NormalTok{    cudaMemcpy}\OperatorTok{(}\NormalTok{d\_grasps}\OperatorTok{,}\NormalTok{ grasps}\OperatorTok{.}\NormalTok{data}\OperatorTok{(),}\NormalTok{ n }\OperatorTok{*} \KeywordTok{sizeof}\OperatorTok{(}\NormalTok{Grasp}\OperatorTok{),}\NormalTok{ cudaMemcpyHostToDevice}\OperatorTok{);}

    \CommentTok{// Launch kernel}
    \DataTypeTok{int}\NormalTok{ blockSize }\OperatorTok{=} \DecValTok{256}\OperatorTok{;}
    \DataTypeTok{int}\NormalTok{ numBlocks }\OperatorTok{=} \OperatorTok{(}\NormalTok{n }\OperatorTok{+}\NormalTok{ blockSize }\OperatorTok{{-}} \DecValTok{1}\OperatorTok{)} \OperatorTok{/}\NormalTok{ blockSize}\OperatorTok{;}
\NormalTok{    evaluateGraspsKernel}\OperatorTok{\textless{}\textless{}\textless{}}\NormalTok{numBlocks}\OperatorTok{,}\NormalTok{ blockSize}\OperatorTok{\textgreater{}\textgreater{}\textgreater{}(}\NormalTok{d\_grasps}\OperatorTok{,}\NormalTok{ d\_qualities}\OperatorTok{,}\NormalTok{ n}\OperatorTok{);}

    \CommentTok{// Copy back}
\NormalTok{    qualities}\OperatorTok{.}\NormalTok{resize}\OperatorTok{(}\NormalTok{n}\OperatorTok{);}
\NormalTok{    cudaMemcpy}\OperatorTok{(}\NormalTok{qualities}\OperatorTok{.}\NormalTok{data}\OperatorTok{(),}\NormalTok{ d\_qualities}\OperatorTok{,}\NormalTok{ n }\OperatorTok{*} \KeywordTok{sizeof}\OperatorTok{(}\DataTypeTok{float}\OperatorTok{),}\NormalTok{ cudaMemcpyDeviceToHost}\OperatorTok{);}

    \CommentTok{// Free}
\NormalTok{    cudaFree}\OperatorTok{(}\NormalTok{d\_grasps}\OperatorTok{);}
\NormalTok{    cudaFree}\OperatorTok{(}\NormalTok{d\_qualities}\OperatorTok{);}
\OperatorTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{testing-hooks}{%
\subsection{17. Testing Hooks}\label{testing-hooks}}

\hypertarget{mock-interfaces}{%
\subsubsection{17.1 Mock Interfaces}\label{mock-interfaces}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{// Virtual interface for robot driver (allows mocking)}
\KeywordTok{class}\NormalTok{ IRobotDriver }\OperatorTok{\{}
\KeywordTok{public}\OperatorTok{:}
    \KeywordTok{virtual} \OperatorTok{\textasciitilde{}}\NormalTok{IRobotDriver}\OperatorTok{()} \OperatorTok{=} \ControlFlowTok{default}\OperatorTok{;}
    \KeywordTok{virtual} \DataTypeTok{void}\NormalTok{ moveJoints}\OperatorTok{(}\AttributeTok{const} \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}\&}\NormalTok{ positions}\OperatorTok{)} \OperatorTok{=} \DecValTok{0}\OperatorTok{;}
    \KeywordTok{virtual} \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}}\NormalTok{ getJointPositions}\OperatorTok{()} \OperatorTok{=} \DecValTok{0}\OperatorTok{;}
\OperatorTok{\};}

\CommentTok{// Real implementation}
\KeywordTok{class}\NormalTok{ URRobotDriver }\OperatorTok{:} \KeywordTok{public}\NormalTok{ IRobotDriver }\OperatorTok{\{}
    \DataTypeTok{void}\NormalTok{ moveJoints}\OperatorTok{(}\AttributeTok{const} \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}\&}\NormalTok{ positions}\OperatorTok{)} \KeywordTok{override} \OperatorTok{\{}
        \CommentTok{// Send to real robot via TCP/IP}
    \OperatorTok{\}}
\OperatorTok{\};}

\CommentTok{// Mock for testing}
\KeywordTok{class}\NormalTok{ MockRobotDriver }\OperatorTok{:} \KeywordTok{public}\NormalTok{ IRobotDriver }\OperatorTok{\{}
    \DataTypeTok{void}\NormalTok{ moveJoints}\OperatorTok{(}\AttributeTok{const} \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}\&}\NormalTok{ positions}\OperatorTok{)} \KeywordTok{override} \OperatorTok{\{}
        \VariableTok{last\_commanded\_positions\_} \OperatorTok{=}\NormalTok{ positions}\OperatorTok{;}
    \OperatorTok{\}}

    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}} \VariableTok{last\_commanded\_positions\_}\OperatorTok{;}
\OperatorTok{\};}

\CommentTok{// Usage in tests}
\NormalTok{TEST}\OperatorTok{(}\NormalTok{MotionPlannerTest}\OperatorTok{,}\NormalTok{ TestJointMove}\OperatorTok{)} \OperatorTok{\{}
    \KeywordTok{auto}\NormalTok{ mock\_driver }\OperatorTok{=} \BuiltInTok{std::}\NormalTok{make\_shared}\OperatorTok{\textless{}}\NormalTok{MockRobotDriver}\OperatorTok{\textgreater{}();}
\NormalTok{    MotionPlanner planner}\OperatorTok{(}\NormalTok{mock\_driver}\OperatorTok{);}

    \BuiltInTok{std::}\NormalTok{vector}\OperatorTok{\textless{}}\DataTypeTok{double}\OperatorTok{\textgreater{}}\NormalTok{ target }\OperatorTok{=} \OperatorTok{\{}\DecValTok{0}\OperatorTok{,} \OperatorTok{{-}}\FloatTok{1.57}\OperatorTok{,} \DecValTok{0}\OperatorTok{,} \OperatorTok{{-}}\FloatTok{1.57}\OperatorTok{,} \DecValTok{0}\OperatorTok{,} \DecValTok{0}\OperatorTok{\};}
\NormalTok{    planner}\OperatorTok{.}\NormalTok{moveToJointPositions}\OperatorTok{(}\NormalTok{target}\OperatorTok{);}

\NormalTok{    EXPECT\_EQ}\OperatorTok{(}\NormalTok{mock\_driver}\OperatorTok{{-}\textgreater{}}\VariableTok{last\_commanded\_positions\_}\OperatorTok{,}\NormalTok{ target}\OperatorTok{);}
\OperatorTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{dependency-injection}{%
\subsubsection{17.2 Dependency Injection}\label{dependency-injection}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{class}\NormalTok{ VisionPipeline:}
    \KeywordTok{def} \FunctionTok{\_\_init\_\_}\NormalTok{(}\VariableTok{self}\NormalTok{, detector}\OperatorTok{=}\VariableTok{None}\NormalTok{, pose\_estimator}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
        \VariableTok{self}\NormalTok{.detector }\OperatorTok{=}\NormalTok{ detector }\KeywordTok{or}\NormalTok{ YOLODetector()}
        \VariableTok{self}\NormalTok{.pose\_estimator }\OperatorTok{=}\NormalTok{ pose\_estimator }\KeywordTok{or}\NormalTok{ PCABasedPoseEstimator()}

    \KeywordTok{def}\NormalTok{ process\_image(}\VariableTok{self}\NormalTok{, image):}
\NormalTok{        detections }\OperatorTok{=} \VariableTok{self}\NormalTok{.detector.detect(image)}
\NormalTok{        poses }\OperatorTok{=} \VariableTok{self}\NormalTok{.pose\_estimator.estimate(detections)}
        \ControlFlowTok{return}\NormalTok{ poses}

\CommentTok{\# Test with mock detector}
\KeywordTok{class}\NormalTok{ MockDetector:}
    \KeywordTok{def}\NormalTok{ detect(}\VariableTok{self}\NormalTok{, image):}
        \ControlFlowTok{return}\NormalTok{ [Detection(class\_name}\OperatorTok{=}\StringTok{"cube"}\NormalTok{, bbox}\OperatorTok{=}\NormalTok{[}\DecValTok{100}\NormalTok{, }\DecValTok{100}\NormalTok{, }\DecValTok{200}\NormalTok{, }\DecValTok{200}\NormalTok{])]}

\KeywordTok{def}\NormalTok{ test\_vision\_pipeline():}
\NormalTok{    pipeline }\OperatorTok{=}\NormalTok{ VisionPipeline(detector}\OperatorTok{=}\NormalTok{MockDetector())}
\NormalTok{    poses }\OperatorTok{=}\NormalTok{ pipeline.process\_image(dummy\_image)}
    \ControlFlowTok{assert} \BuiltInTok{len}\NormalTok{(poses) }\OperatorTok{==} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{deployment-configuration}{%
\subsection{18. Deployment
Configuration}\label{deployment-configuration}}

\hypertarget{docker-compose}{%
\subsubsection{18.1 Docker Compose}\label{docker-compose}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# docker{-}compose.yml}
\FunctionTok{version}\KeywordTok{:}\AttributeTok{ }\StringTok{\textquotesingle{}3.8\textquotesingle{}}

\FunctionTok{services}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{vision}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{image}\KeywordTok{:}\AttributeTok{ robotics/vision:latest}
\AttributeTok{    }\FunctionTok{runtime}\KeywordTok{:}\AttributeTok{ nvidia}\CommentTok{  \# GPU support}
\AttributeTok{    }\FunctionTok{devices}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ /dev/video0:/dev/video0}\CommentTok{  \# Camera}
\AttributeTok{    }\FunctionTok{environment}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ ROS\_DOMAIN\_ID=42}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ CUDA\_VISIBLE\_DEVICES=0}
\AttributeTok{    }\FunctionTok{volumes}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ ./models:/models:ro}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ ./config:/config:ro}
\AttributeTok{    }\FunctionTok{networks}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ robot\_net}
\AttributeTok{    }\FunctionTok{restart}\KeywordTok{:}\AttributeTok{ unless{-}stopped}

\AttributeTok{  }\FunctionTok{motion\_planning}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{image}\KeywordTok{:}\AttributeTok{ robotics/motion\_planning:latest}
\AttributeTok{    }\FunctionTok{environment}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ ROS\_DOMAIN\_ID=42}
\AttributeTok{    }\FunctionTok{volumes}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ ./config:/config:ro}
\AttributeTok{    }\FunctionTok{networks}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ robot\_net}
\AttributeTok{    }\FunctionTok{restart}\KeywordTok{:}\AttributeTok{ unless{-}stopped}

\AttributeTok{  }\FunctionTok{orchestrator}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{image}\KeywordTok{:}\AttributeTok{ robotics/orchestrator:latest}
\AttributeTok{    }\FunctionTok{environment}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ ROS\_DOMAIN\_ID=42}
\AttributeTok{    }\FunctionTok{networks}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ robot\_net}
\AttributeTok{    }\FunctionTok{restart}\KeywordTok{:}\AttributeTok{ unless{-}stopped}

\AttributeTok{  }\FunctionTok{database}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{image}\KeywordTok{:}\AttributeTok{ postgres:15}
\AttributeTok{    }\FunctionTok{environment}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ POSTGRES\_DB=robotics\_db}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ POSTGRES\_USER=robot}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ POSTGRES\_PASSWORD=$\{DB\_PASSWORD\}}
\AttributeTok{    }\FunctionTok{volumes}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ db\_data:/var/lib/postgresql/data}
\AttributeTok{    }\FunctionTok{networks}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ robot\_net}

\AttributeTok{  }\FunctionTok{grafana}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{image}\KeywordTok{:}\AttributeTok{ grafana/grafana:10.0.0}
\AttributeTok{    }\FunctionTok{ports}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ }\StringTok{"3000:3000"}
\AttributeTok{    }\FunctionTok{volumes}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ grafana\_data:/var/lib/grafana}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ ./dashboards:/etc/grafana/provisioning/dashboards:ro}
\AttributeTok{    }\FunctionTok{networks}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ robot\_net}

\FunctionTok{networks}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{robot\_net}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{driver}\KeywordTok{:}\AttributeTok{ bridge}

\FunctionTok{volumes}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{db\_data}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{grafana\_data}\KeywordTok{:}
\end{Highlighting}
\end{Shaded}

\hypertarget{kubernetes-deployment}{%
\subsubsection{18.2 Kubernetes Deployment}\label{kubernetes-deployment}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# k8s/deployment.yaml}
\FunctionTok{apiVersion}\KeywordTok{:}\AttributeTok{ apps/v1}
\FunctionTok{kind}\KeywordTok{:}\AttributeTok{ Deployment}
\FunctionTok{metadata}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{name}\KeywordTok{:}\AttributeTok{ vision{-}pipeline}
\FunctionTok{spec}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{replicas}\KeywordTok{:}\AttributeTok{ }\DecValTok{1}
\AttributeTok{  }\FunctionTok{selector}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{matchLabels}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{app}\KeywordTok{:}\AttributeTok{ vision}
\AttributeTok{  }\FunctionTok{template}\KeywordTok{:}
\AttributeTok{    }\FunctionTok{metadata}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{labels}\KeywordTok{:}
\AttributeTok{        }\FunctionTok{app}\KeywordTok{:}\AttributeTok{ vision}
\AttributeTok{    }\FunctionTok{spec}\KeywordTok{:}
\AttributeTok{      }\FunctionTok{containers}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ }\FunctionTok{name}\KeywordTok{:}\AttributeTok{ vision}
\AttributeTok{        }\FunctionTok{image}\KeywordTok{:}\AttributeTok{ robotics/vision:latest}
\AttributeTok{        }\FunctionTok{resources}\KeywordTok{:}
\AttributeTok{          }\FunctionTok{limits}\KeywordTok{:}
\AttributeTok{            }\FunctionTok{nvidia.com/gpu}\KeywordTok{:}\AttributeTok{ }\DecValTok{1}
\AttributeTok{        }\FunctionTok{env}\KeywordTok{:}
\AttributeTok{        }\KeywordTok{{-}}\AttributeTok{ }\FunctionTok{name}\KeywordTok{:}\AttributeTok{ ROS\_DOMAIN\_ID}
\AttributeTok{          }\FunctionTok{value}\KeywordTok{:}\AttributeTok{ }\StringTok{"42"}
\AttributeTok{        }\FunctionTok{volumeMounts}\KeywordTok{:}
\AttributeTok{        }\KeywordTok{{-}}\AttributeTok{ }\FunctionTok{name}\KeywordTok{:}\AttributeTok{ models}
\AttributeTok{          }\FunctionTok{mountPath}\KeywordTok{:}\AttributeTok{ /models}
\AttributeTok{          }\FunctionTok{readOnly}\KeywordTok{:}\AttributeTok{ }\CharTok{true}
\AttributeTok{      }\FunctionTok{volumes}\KeywordTok{:}
\AttributeTok{      }\KeywordTok{{-}}\AttributeTok{ }\FunctionTok{name}\KeywordTok{:}\AttributeTok{ models}
\AttributeTok{        }\FunctionTok{persistentVolumeClaim}\KeywordTok{:}
\AttributeTok{          }\FunctionTok{claimName}\KeywordTok{:}\AttributeTok{ models{-}pvc}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{summary}{%
\subsection{19. Summary}\label{summary}}

This Low-Level Design provides comprehensive technical specifications
for implementing all subsystems:

\hypertarget{key-deliverables}{%
\subsubsection{19.1 Key Deliverables}\label{key-deliverables}}

✅ \textbf{Vision Subsystem:} Camera driver, object detector (YOLOv8 +
TensorRT), pose estimator (PCA) ✅ \textbf{Grasp Planning:} Antipodal
grasp synthesis, force closure validation, collision checking ✅
\textbf{Motion Planning:} MoveIt2 integration, pick-place action server,
trajectory optimization ✅ \textbf{Control:} ros2\_control hardware
interface, 1 kHz control loop, safety limits ✅ \textbf{Orchestration:}
Behavior tree implementation, state machine, error recovery ✅
\textbf{Monitoring:} Prometheus/InfluxDB metrics, PostgreSQL operational
DB, REST/gRPC APIs

\hypertarget{performance-targets}{%
\subsubsection{19.2 Performance Targets}\label{performance-targets}}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.2727}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.2727}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.4545}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
\textbf{Metric}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Target}
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
\textbf{Implementation}
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
\textbf{Cycle Time} & \textless2 sec & Optimized pipeline, TensorRT
inference, parallel processing \\
\textbf{Vision Latency} & \textless50 ms & GPU acceleration, FP16
precision \\
\textbf{Motion Planning} & \textless300 ms & RRT* with warm-start,
simplified collision meshes \\
\textbf{Control Frequency} & 1 kHz & RT-Linux, FIFO scheduling,
pre-allocated memory \\
\textbf{Success Rate} & \textgreater99\% & Robust grasp planning,
adaptive error recovery \\
\end{longtable}

\hypertarget{next-steps}{%
\subsubsection{19.3 Next Steps}\label{next-steps}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Implementation:} Use this LLD as blueprint for coding
\item
  \textbf{Unit Testing:} Implement test cases with 80\%+ coverage
\item
  \textbf{Integration Testing:} Validate subsystem interfaces
\item
  \textbf{Performance Profiling:} Measure and optimize latency
  bottlenecks
\item
  \textbf{Documentation:} Generate API docs from code (Doxygen/Sphinx)
\end{enumerate}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{Document Status:} ✅ v1.0 Complete \textbf{Next Document:} C4
Model Diagrams (architectural visualizations) \textbf{Dependencies:}
High-Level Design (08), Technical Stack (05), Problem Statement (04)

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\end{document}
